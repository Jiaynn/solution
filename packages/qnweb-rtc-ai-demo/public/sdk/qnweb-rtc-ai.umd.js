!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("crypto")):"function"==typeof define&&define.amd?define(["exports","crypto"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).QNRTCAI={},e.require$$0)}(this,function(a,e){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var p=n(e),o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}a((c=c.apply(e,o||[])).next())})}function c(n,i){var a,o,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=i.call(n,c)}catch(e){t=[6,e],o=0}finally{a=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}var m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var i,u;function d(e){if(u[e])return u[e].exports;var t=u[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,d),t.l=!0,t.exports}i=[function(n,e,t){var f;function p(t){return["image/png","image/jpeg","image/gif"].some(e=>e===t)}t.r(e),t.d(e,"canvastoDataURL",function(){return m}),t.d(e,"canvastoFile",function(){return a}),t.d(e,"dataURLtoFile",function(){return g}),t.d(e,"dataURLtoImage",function(){return v}),t.d(e,"downloadFile",function(){return o}),t.d(e,"filetoDataURL",function(){return y}),t.d(e,"imagetoCanvas",function(){return b}),t.d(e,"urltoBlob",function(){return u}),t.d(e,"urltoImage",function(){return d}),t.d(e,"compress",function(){return l}),t.d(e,"compressAccurately",function(){return h}),t.d(e,"EImageType",function(){return f}),(t=f=f||{}).PNG="image/png",t.JPEG="image/jpeg",t.GIF="image/gif";var i=function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}a((c=c.apply(e,o||[])).next())})};function m(e,t=.92,r=f.JPEG){return i(this,void 0,void 0,function*(){return p(r)||(r=f.JPEG),e.toDataURL(r,t)})}function a(e,r=.92,n=f.JPEG){return new Promise(t=>e.toBlob(e=>t(e),n,r))}var s=function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}a((c=c.apply(e,o||[])).next())})};function g(a,o){return s(this,void 0,void 0,function*(){const e=a.split(",");let t=e[0].match(/:(.*?);/)[1];const r=atob(e[1]);let n=r.length;const i=new Uint8Array(n);for(;n--;)i[n]=r.charCodeAt(n);return p(o)&&(t=o),new Blob([i],{type:t})})}function v(n){return new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("dataURLtoImage(): dataURL is illegal")),r.src=n})}function o(e,t){const r=document.createElement("a"),n=(r.href=window.URL.createObjectURL(e),r.download=t||Date.now().toString(36),document.body.appendChild(r),document.createEvent("MouseEvents"));n.initEvent("click",!1,!1),r.dispatchEvent(n),document.body.removeChild(r)}function y(r){return new Promise(t=>{const e=new FileReader;e.onloadend=e=>t(e.target.result),e.readAsDataURL(r)})}var c=function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}a((c=c.apply(e,o||[])).next())})};function b(a,o={}){return c(this,void 0,void 0,function*(){const t=Object.assign({},o),e=document.createElement("canvas"),r=e.getContext("2d");let n,i;for(const a in t)Object.prototype.hasOwnProperty.call(t,a)&&(t[a]=Number(t[a]));if(t.scale){const o=0<t.scale&&t.scale<10?t.scale:1;i=a.width*o,n=a.height*o}else i=t.width||t.height*a.width/a.height||a.width,n=t.height||t.width*a.height/a.width||a.height;switch([5,6,7,8].some(e=>e===t.orientation)?(e.height=i,e.width=n):(e.height=n,e.width=i),t.orientation){case 3:r.rotate(180*Math.PI/180),r.drawImage(a,-e.width,-e.height,e.width,e.height);break;case 6:r.rotate(90*Math.PI/180),r.drawImage(a,0,-e.width,e.height,e.width);break;case 8:r.rotate(270*Math.PI/180),r.drawImage(a,-e.height,0,e.height,e.width);break;case 2:r.translate(e.width,0),r.scale(-1,1),r.drawImage(a,0,0,e.width,e.height);break;case 4:r.translate(e.width,0),r.scale(-1,1),r.rotate(180*Math.PI/180),r.drawImage(a,-e.width,-e.height,e.width,e.height);break;case 5:r.translate(e.width,0),r.scale(-1,1),r.rotate(90*Math.PI/180),r.drawImage(a,0,-e.width,e.height,e.width);break;case 7:r.translate(e.width,0),r.scale(-1,1),r.rotate(270*Math.PI/180),r.drawImage(a,-e.height,0,e.height,e.width);break;default:r.drawImage(a,0,0,e.width,e.height)}return e})}function u(e){return fetch(e).then(e=>e.blob())}function d(n){return new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("urltoImage(): Image failed to load, please check the image URL")),r.src=n})}var r=function(e,o,s,c){return new(s=s||Promise)(function(r,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}a((c=c.apply(e,o||[])).next())})};function l(i,a={}){return r(this,void 0,void 0,function*(){if(!(i instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if((a="object"!=typeof a?Object.assign({quality:a}):a).quality=Number(a.quality),Number.isNaN(a.quality))return i;const e=yield y(i);let t=e.split(",")[0].match(/:(.*?);/)[1],r=f.JPEG;p(a.type)&&(r=a.type,t=a.type);var n=yield g(yield m(yield b(yield v(e),Object.assign({},a)),a.quality,r),t);return n.size>i.size?i:n})}function h(l,h={}){return r(this,void 0,void 0,function*(){if(!(l instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if((h="object"!=typeof h?Object.assign({size:h}):h).size=Number(h.size),Number.isNaN(h.size))return l;if(1024*h.size>l.size)return l;h.accuracy=Number(h.accuracy),(!h.accuracy||h.accuracy<.8||.99<h.accuracy)&&(h.accuracy=.95);const t=h.size*(2-h.accuracy)*1024,r=1024*h.size,n=h.size*h.accuracy*1024,e=yield y(l);let i=e.split(",")[0].match(/:(.*?);/)[1],a=f.JPEG;p(h.type)&&(a=h.type,i=h.type);var d=yield b(yield v(e),Object.assign({},h));let o,s=.5;const c=[null,null];for(let e=1;e<=7;e++){const h=.75*(o=yield m(d,s,a)).length;if(7===e){(t<h||n>h)&&(o=[o,...c].filter(e=>e).sort((e,t)=>Math.abs(.75*e.length-r)-Math.abs(.75*t.length-r))[0]);break}if(t<h)c[1]=o,s-=Math.pow(.5,e+1);else{if(!(n>h))break;c[0]=o,s+=Math.pow(.5,e+1)}}var u=yield g(o,i);return u.size>l.size?l:u})}}],u={},d.m=i,d.c=u,d.d=function(e,t,r){d.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},d.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.t=function(t,e){if(1&e&&(t=d(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(d.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)d.d(r,n,function(e){return t[e]}.bind(null,n));return r},d.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return d.d(t,"a",t),t},d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.p="";var h=d(d.s=0);function f(){this.cache={token:null}}f.prototype.get=function(e){return this.cache[e]},f.prototype.set=function(e,t){this.cache[e]=t};var g=new f;function v(e,t){var r=t.debug,t=function(e,t){var r={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}(t,["debug"]),r=r?{request:t||{},debug:r}:{request:t||{}};return fetch("https://ap-open-z0.qiniuapi.com/dora-sdk/api"+e,{headers:{Authorization:g.get("token"),"Content-Type":"application/json"},body:JSON.stringify(r),method:"POST"}).then(function(e){return e.json()})}var y,k={voice_type:1,voice_encode:1,voice_sample:16e3,needvad:1,need_partial:1,maxsil:10,need_words:0,model_type:0,voice_id:void 0,force_final:0,vad_sil_thres:.5},_=((e=y=y||{})[e.CLOSED=0]="CLOSED",e[e.PROCESSING=1]="PROCESSING",e[e.OPENED=2]="OPENED",R.prototype.initWebSocket=function(i,a){return s(this,void 0,void 0,function(){var t,r,n=this;return c(this,function(e){switch(e.label){case 0:return this.status=y.PROCESSING,g.cache.signCallback?[4,g.cache.signCallback(i)]:[3,2];case 1:return r=e.sent(),[3,3];case 2:r=null,e.label=3;case 3:return t=r,this.ws=new WebSocket(i+"&token=".concat(t)),this.on("open",function(){console.info("roomlog websocket open"),n.status=y.OPENED,a&&a()}),this.on("close",function(){console.info("roomlog websocket close"),n.status=y.CLOSED}),[2]}})})},R.prototype.on=function(e,t){var r;this.listeners.push({event:e,callback:t}),null!==(r=this.ws)&&void 0!==r&&r.addEventListener(e,t)},R.prototype.send=function(e){var t;this.status===y.OPENED&&null!==(t=this.ws)&&void 0!==t&&t.send(e)},R.prototype.sendEOS=function(){this.ws&&this.status===y.OPENED&&this.send("EOS")},R.prototype.close=function(){var e;this.ws&&this.status===y.OPENED&&(this.status=y.CLOSED,null!==(e=this.ws)&&void 0!==e&&e.close())},R.prototype.destroy=function(){var n=this;this.listeners.map(function(e){var t,r=e.event,e=e.callback;null!==(t=n.ws)&&void 0!==t&&t.removeEventListener(r,e)})},R);function R(e,t){this.status=y.CLOSED;var r=e.query,r=void 0===r?k:r,e=e.baseUrl,e=void 0===e?"wss://wz-rt-asr.service-z0.qiniuapp.com/asr":e,r=Object.entries(o(o(o({},k),r),{e:Math.floor(Date.now()/1e3)})).filter(function(e){return void 0!==e[1]&&null!==e[1]}).map(function(e){var t=e[0],e=e[1];return"".concat(t,"=").concat(e)}).join("&"),e=e+"?"+encodeURI(r);this.listeners=[],this.initWebSocket(e,t)}var E,I,P,A,M,e={exports:{}};e.exports=function(u){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),!(n=!(n=!(n="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:n)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:n)&&void 0!==m&&m.crypto?m.crypto:n))try{n=p.default}catch(e){}var c=Object.create||function(e){return t.prototype=e,e=new t,t.prototype=null,e};function t(){}var e={},r=e.lib={},i=r.Base={extend:function(e){var t=c(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},d=r.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a++){var o=r[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=o<<24-(n+a)%4*8}else for(var s=0;s<i;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=u.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new d.init(t,e)}}),a=e.enc={},l=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var a=t[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new d.init(r,t/2)}},o=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var a=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new d.init(r,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(o.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return o.parse(unescape(encodeURIComponent(e)))}},s=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t,r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,o=i/(4*a),s=(o=e?u.ceil(o):u.max((0|o)-this._minBufferSize,0))*a,e=u.min(4*s,i);if(s){for(var c=0;c<s;c+=a)this._doProcessBlock(n,c);t=n.splice(0,s),r.sigBytes-=e}return new d.init(t,e)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(r.Hasher=s.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){s.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new f.HMAC.init(r,t).finalize(e)}}}),e.algo={});return e}(Math),N=(L=U=e.exports).lib,E=N.WordArray,I=N.Hasher,N=L.algo,P=[],N=N.SHA1=I.extend({_doReset:function(){this._hash=new E.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],c=0;c<80;c++){c<16?P[c]=0|e[t+c]:(u=P[c-3]^P[c-8]^P[c-14]^P[c-16],P[c]=u<<1|u>>>31);var u=(n<<5|n>>>27)+s+P[c];u+=c<20?1518500249+(i&a|~i&o):c<40?1859775393+(i^a^o):c<60?(i&a|i&o|a&o)-1894007588:(i^a^o)-899497514,s=o,o=a,a=i<<30|i>>>2,i=n,n=u}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+o|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=Math.floor(r/4294967296),t[15+(64+n>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=I.clone.call(this);return e._hash=this._hash.clone(),e}}),L.SHA1=I._createHelper(N),L.HmacSHA1=I._createHmacHelper(N),U.SHA1,N=(L=e.exports).lib.Base,A=L.enc.Utf8,L.algo.HMAC=N.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=A.parse(t));for(var r=e.blockSize,n=4*r,e=((t=t.sigBytes>n?e.finalize(t):t).clamp(),this._oKey=t.clone()),t=this._iKey=t.clone(),i=e.words,a=t.words,o=0;o<r;o++)i[o]^=1549556828,a[o]^=909522486;e.sigBytes=t.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}}),e.exports.HmacSHA1;function D(e,t,r){for(var n,i,a=[],o=0,s=0;s<t;s++)s%4&&(n=r[e.charCodeAt(s-1)]<<s%4*2,i=r[e.charCodeAt(s)]>>>6-s%4*2,a[o>>>2]|=(n|i)<<24-o%4*8,o++);return M.create(a,o)}M=(U=e.exports).lib.WordArray,U.enc.Base64={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=this._map,i=(e.clamp(),[]),a=0;a<r;a+=3)for(var o=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<r;s++)i.push(n.charAt(o>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map;if(!(n=this._reverseMap))for(var n=this._reverseMap=[],i=0;i<r.length;i++)n[r.charCodeAt(i)]=i;var a=r.charAt(64);return!a||-1!==(a=e.indexOf(a))&&(t=a),D(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},U.enc.Base64;O.run=function(e,t){e=function(e,t){for(var r=(e=e.split(","))[0].match(/:(.*?);/)[1],n=atob(e[1]),i=n.length,a=new Uint8Array(i);i--;)a[i]=n.charCodeAt(i);return new File([a],t,{type:r})}(e._track.getCurrentFrameDataURL(),"photo");return h.compressAccurately(e,24).then(function(e){return r=e,new Promise(function(e){var t=new FileReader;t.readAsDataURL(r),t.onload=function(){e(t.result)}});var r}).then(function(e){return v("/face-hdphotoauth",o({photo_b64:e.split(",")[1]},t))})};var x=O;function O(){}j.start=function(e,t){var t=t||15,r=new j,n=e._track;return r.frameRate=t,r.videoData=[],r.timer=setInterval(function(){var e=n.getCurrentFrameDataURL().replace("data:image/png;base64,","");r.videoData.push({image:e})},1e3/t),r},j.prototype.commit=function(){return s(this,void 0,void 0,function(){return c(this,function(e){return clearInterval(this.timer),[2,v("/face-flashlive",{video_data:this.videoData})]})})};var L=j;function j(){}B.run=function(e,t){e=e._track.getCurrentFrameDataURL();return v("/ocr-idcard",o({image:e.replace("data:image/png;base64,","")},t))};var N=B;function B(){}a.Status=void 0,(e=a.Status||(a.Status={}))[e.AVAILABLE=0]="AVAILABLE",e[e.DESTROY=1]="DESTROY",e[e.ERROR=2]="ERROR",e[e.DETECTING=3]="DETECTING";var F={voice_type:1,voice_encode:1,voice_sample:16e3,needvad:1,need_partial:1,maxsil:10,need_words:0,model_type:0,voice_id:void 0,force_final:0,vad_sil_thres:.5},U=(V.prototype.startConnectWebSocket=function(t,e){var r=this,n=e.params,i=e.callback,e=e.audioBuffer,e=o(o(o({},F),{voice_sample:e.sampleRate}),n);t.ws=new _({query:e},function(){var e;t.isRecording=!0,t.status=a.Status.DETECTING,null!==(e=t.ws)&&void 0!==e&&e.on("message",function(e){var e=JSON.parse(e.data);null!=i&&i.onAudioToText&&i.onAudioToText(e),1===e.ended&&(r.timeoutWebSocketCloseJob&&clearTimeout(r.timeoutWebSocketCloseJob),null!==(e=t.ws)&&void 0!==e&&e.close())}),null!=i&&i.onStatusChange&&i.onStatusChange(t.status,"正在实时转化"),null!==(e=t.ws)&&void 0!==e&&e.on("error",function(){t.isRecording=!1,t.status=a.Status.ERROR,null!=i&&i.onStatusChange&&i.onStatusChange(t.status,"连接异常断线")}),null!==(e=t.ws)&&void 0!==e&&e.on("close",function(){t.isRecording=!1,t.status=a.Status.DESTROY,null!=i&&i.onStatusChange&&i.onStatusChange(t.status,"已经销毁不可用")})}),t.ws.on("open",function(){var e;console.log("on open"),t.isRecording=!0,t.status=a.Status.DETECTING,null!==(e=t.ws)&&void 0!==e&&e.on("message",function(e){null!=i&&i.onAudioToText&&i.onAudioToText(JSON.parse(e.data))}),null!=i&&i.onStatusChange&&i.onStatusChange(t.status,"正在实时转化")})},V.prototype.sendMessageToWebSocket=function(e,t){var r,t=t.audioBuffer;e.leftDataList.push(t.getChannelData(0).slice(0)),200<=Date.now()-e.startTime&&(t=this.mergeArray(e.leftDataList),t=Int16Array.from(t.map(function(e){return 0<e?32767*e:32768*e})).buffer,null!==(r=e.ws)&&void 0!==r&&r.send(t),e.startTime=Date.now(),e.leftDataList=[],e.rightDataList=[])},V.prototype.mergeArray=function(e){for(var t=e.length*e[0].length,r=new Float32Array(t),n=0,i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r},V.prototype.interleaveLeftAndRight=function(e,t){for(var r=e.length+t.length,n=new Float32Array(r),i=0;i<e.length;i++){var a=2*i;n[a]=e[i],n[1+a]=t[i]}return n},V.startAudioToText=function(e,r,n){function t(e){var t;console.log("audioBuffer",e),i.ws||i.startConnectWebSocket(i,{params:r,callback:n,audioBuffer:e}),(null===(t=i.ws)||void 0===t?void 0:t.status)===y.OPENED&&i.sendMessageToWebSocket(i,{audioBuffer:e})}var e=e._track,i=new V;i.startTime=Date.now();return e.on("audioBuffer",t),i.audioBufferHandler=t,i.audioTrack=e,i},V.prototype.getStatus=function(){return this.status},V.prototype.stopAudioToText=function(){var e;this.audioTrack&&this.audioBufferHandler&&this.audioTrack.off("audioBuffer",this.audioBufferHandler),null!==(e=this.ws)&&void 0!==e&&e.sendEOS(),this.timeoutJob()},V.prototype.timeoutJob=function(e){var t=this;this.timeoutWebSocketCloseJob=setTimeout(function(){var e;null!==(e=t.ws)&&void 0!==e&&e.close()},e||500)},V);function V(){this.status=a.Status.AVAILABLE,this.isRecording=!1,this.startTime=Date.now(),this.leftDataList=[],this.rightDataList=[]}e={exports:{}},e=e.exports;{var w=e,G=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},W=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);(n="function"==typeof Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})):n).forEach(function(e){G(t,e,r[e])})}return t};function H(t){var e=q([["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]]).filter(function(e){return e.rule&&e.rule.test(t)})[0];return e?e.name:null}function z(){return"undefined"!=typeof process&&process.version&&{name:"node",version:process.version.slice(1),os:process.platform}}function J(n){var e=q([["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)$/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/]]);if(!n)return null;e=e.map(function(e){var t=e.rule.exec(n),r=t&&t[1].split(/[._]/).slice(0,3);return r&&r.length<3&&(r=r.concat(1==r.length?[0,0]:[0])),t&&{name:e.name,version:r.join(".")}}).filter(Boolean)[0]||null;return e&&(e.os=H(n)),/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/i.test(n)&&((e=e||{}).bot=!0),e}function q(e){return e.map(function(e){return{name:e[0],rule:e[1]}})}var $=function(){return"undefined"!=typeof navigator?J(navigator.userAgent):z()},$e="undefined"!=typeof window?window:void 0!==m?m:"undefined"!=typeof self?self:{};function X(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function K(e,t){return e(t={exports:{}},t.exports),t.exports}(e=K(function(e,n){n=e.exports=f,u="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},n.SEMVER_SPEC_VERSION="2.0.0";var u,r=256,a=Number.MAX_SAFE_INTEGER||9007199254740991,s=n.re=[],t=n.src=[],e=0,o=(e++,t[0]="0|[1-9]\\d*",e++,t[1]="[0-9]+",e++,t[2]="\\d*[a-zA-Z-][a-zA-Z0-9-]*",e++,t[3]="("+t[0]+")\\.("+t[0]+")\\.("+t[0]+")",e++,t[4]="("+t[1]+")\\.("+t[1]+")\\.("+t[1]+")",e++,t[5]="(?:"+t[0]+"|"+t[2]+")",e++,t[6]="(?:"+t[1]+"|"+t[2]+")",e++,t[7]="(?:-("+t[5]+"(?:\\."+t[5]+")*))",e++,t[8]="(?:-?("+t[6]+"(?:\\."+t[6]+")*))",e++,t[9]="[0-9A-Za-z-]+",e++,t[10]="(?:\\+("+t[9]+"(?:\\."+t[9]+")*))",e++),c="v?"+t[3]+t[7]+"?"+t[10]+"?",d=(t[o]="^"+c+"$","[v=\\s]*"+t[4]+t[8]+"?"+t[10]+"?"),l=e++;t[l]="^"+d+"$",e++,t[13]="((?:<|>)?=?)",e++,t[14]=t[1]+"|x|X|\\*",e++,t[15]=t[0]+"|x|X|\\*",e++,t[16]="[v=\\s]*("+t[15]+")(?:\\.("+t[15]+")(?:\\.("+t[15]+")(?:"+t[7]+")?"+t[10]+"?)?)?",e++,t[17]="[v=\\s]*("+t[14]+")(?:\\.("+t[14]+")(?:\\.("+t[14]+")(?:"+t[8]+")?"+t[10]+"?)?)?",e++,t[18]="^"+t[13]+"\\s*"+t[16]+"$",e++,t[19]="^"+t[13]+"\\s*"+t[17]+"$",e++,t[20]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])",e++,t[21]="(?:~>?)",e++,t[22]="(\\s*)"+t[21]+"\\s+",s[22]=new RegExp(t[22],"g"),e++,t[23]="^"+t[21]+t[16]+"$",e++,t[24]="^"+t[21]+t[17]+"$",e++,t[25]="(?:\\^)",e++,t[26]="(\\s*)"+t[25]+"\\s+",s[26]=new RegExp(t[26],"g"),e++,t[27]="^"+t[25]+t[16]+"$",e++,t[28]="^"+t[25]+t[17]+"$",e++,t[29]="^"+t[13]+"\\s*("+d+")$|^$",e++,t[30]="^"+t[13]+"\\s*("+c+")$|^$",e++,t[31]="(\\s*)"+t[13]+"\\s*("+d+"|"+t[16]+")",s[31]=new RegExp(t[31],"g"),e++,t[32]="^\\s*("+t[16]+")\\s+-\\s+("+t[16]+")\\s*$",t[33]="^\\s*("+t[17]+")\\s+-\\s+("+t[17]+")\\s*$";t[34]="(<|>)?=?\\s*\\*";for(var h=0;h<35;h++)u(h,t[h]),s[h]||(s[h]=new RegExp(t[h]));function v(e,t){if(e instanceof f)return e;if("string"!=typeof e)return null;if(e.length>r)return null;if(!((t=t&&"object"==typeof t?t:{loose:!!t,includePrerelease:!1}).loose?s[l]:s[o]).test(e))return null;try{return new f(e,t)}catch(e){return null}}function f(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof f){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>r)throw new TypeError("version is longer than "+r+" characters");if(!(this instanceof f))return new f(e,t);u("SemVer",e,t),this.options=t,this.loose=!!t.loose;t=e.trim().match(t.loose?s[l]:s[o]);if(!t)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(0<=t&&t<a)return t}return e}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}n.parse=v,n.valid=function(e,t){e=v(e,t);return e?e.version:null},n.clean=function(e,t){e=v(e.trim().replace(/^[=v]+/,""),t);return e?e.version:null},(n.SemVer=f).prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},f.prototype.toString=function(){return this.version},f.prototype.compare=function(e){return u("SemVer.compare",this.version,this.options,e),e instanceof f||(e=new f(e,this.options)),this.compareMain(e)||this.comparePre(e)},f.prototype.compareMain=function(e){return e instanceof f||(e=new f(e,this.options)),b(this.major,e.major)||b(this.minor,e.minor)||b(this.patch,e.patch)},f.prototype.comparePre=function(e){if(e instanceof f||(e=new f(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var r=this.prerelease[t],n=e.prerelease[t];if(u("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return b(r,n)}while(++t)},f.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var r=this.prerelease.length;0<=--r;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);-1===r&&this.prerelease.push(0)}t&&(this.prerelease[0]!==t||isNaN(this.prerelease[1]))&&(this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},n.inc=function(e,t,r,n){"string"==typeof r&&(n=r,r=void 0);try{return new f(e,r).inc(t,n).version}catch(e){return null}},n.diff=function(e,t){if(w(e,t))return null;var r=v(e),n=v(t);if(r.prerelease.length||n.prerelease.length){for(var i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return"pre"+i;return"prerelease"}for(i in r)if(("major"===i||"minor"===i||"patch"===i)&&r[i]!==n[i])return i},n.compareIdentifiers=b;var y=/^[0-9]+$/;function b(e,t){var r=y.test(e),n=y.test(t);return r&&n&&(e=+e,t=+t),r&&!n?-1:n&&!r?1:e<t?-1:t<e?1:0}function i(e,t,r){return new f(e,r).compare(new f(t,r))}function k(e,t,r){return 0<i(e,t,r)}function _(e,t,r){return i(e,t,r)<0}function w(e,t,r){return 0===i(e,t,r)}function S(e,t,r){return 0!==i(e,t,r)}function T(e,t,r){return 0<=i(e,t,r)}function C(e,t,r){return i(e,t,r)<=0}function R(e,t,r,n){var i;switch(t){case"===":i=(e="object"==typeof e?e.version:e)===(r="object"==typeof r?r.version:r);break;case"!==":i=(e="object"==typeof e?e.version:e)!==(r="object"==typeof r?r.version:r);break;case"":case"=":case"==":i=w(e,r,n);break;case"!=":i=S(e,r,n);break;case">":i=k(e,r,n);break;case">=":i=T(e,r,n);break;case"<":i=_(e,r,n);break;case"<=":i=C(e,r,n);break;default:throw new TypeError("Invalid operator: "+t)}return i}function p(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof p){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof p))return new p(e,t);u("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===E?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}n.rcompareIdentifiers=function(e,t){return b(t,e)},n.major=function(e,t){return new f(e,t).major},n.minor=function(e,t){return new f(e,t).minor},n.patch=function(e,t){return new f(e,t).patch},n.compare=i,n.compareLoose=function(e,t){return i(e,t,!0)},n.rcompare=function(e,t,r){return i(t,e,r)},n.sort=function(e,r){return e.sort(function(e,t){return n.compare(e,t,r)})},n.rsort=function(e,r){return e.sort(function(e,t){return n.rcompare(e,t,r)})},n.gt=k,n.lt=_,n.eq=w,n.neq=S,n.gte=T,n.lte=C,n.cmp=R,n.Comparator=p;var E={};function m(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof m)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new m(e.raw,t);if(e instanceof p)return new m(e.value,t);if(!(this instanceof m))return new m(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map(function(e){return this.parseRange(e.trim())},this).filter(function(e){return e.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function g(e){return!e||"x"===e.toLowerCase()||"*"===e}function I(u,e,t,r,n,d,l,i,a,o,s,c,h){return((e=g(t)?"":g(r)?">="+t+".0.0":g(n)?">="+t+"."+r+".0":">="+e)+" "+(i=g(a)?"":g(o)?"<"+(+a+1)+".0.0":g(s)?"<"+a+"."+(+o+1)+".0":c?"<="+a+"."+o+"."+s+"-"+c:"<="+i)).trim()}function P(e,t,r){try{t=new m(t,r)}catch(e){return!1}return t.test(e)}function A(e,t,d,r){var n,i,a,o,s;switch(e=new f(e,r),t=new m(t,r),d){case">":n=k,i=C,a=_,o=">",s=">=";break;case"<":n=_,i=T,a=k,o="<",s="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(P(e,t,r))return!1;for(var l=0;l<t.set.length;++l){var h=t.set[l],c=null,u=null;if(h.forEach(function(e){e.semver===E&&(e=new p(">=0.0.0")),c=c||e,u=u||e,n(e.semver,c.semver,r)?c=e:a(e.semver,u.semver,r)&&(u=e)}),c.operator===o||c.operator===s)return!1;if((!u.operator||u.operator===o)&&i(e,u.semver))return!1;if(u.operator===s&&a(e,u.semver))return!1}return!0}p.prototype.parse=function(e){var t=this.options.loose?s[29]:s[30],t=e.match(t);if(!t)throw new TypeError("Invalid comparator: "+e);this.operator=t[1],"="===this.operator&&(this.operator=""),t[2]?this.semver=new f(t[2],this.options.loose):this.semver=E},p.prototype.toString=function(){return this.value},p.prototype.test=function(e){return u("Comparator.test",e,this.options.loose),this.semver===E||R(e="string"==typeof e?new f(e,this.options):e,this.operator,this.semver,this.options)},p.prototype.intersects=function(e,t){if(!(e instanceof p))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return r=new m(e.value,t),P(this.value,r,t);if(""===e.operator)return r=new m(this.value,t),P(e.semver,r,t);var r=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),n=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=R(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),t=R(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return r||n||i&&a||o||t},(n.Range=m).prototype.format=function(){return this.range=this.set.map(function(e){return e.join(" ").trim()}).join("||").trim(),this.range},m.prototype.toString=function(){return this.range},m.prototype.parseRange=function(e){var t=this.options.loose,r=(e=e.trim(),t?s[33]:s[32]),n=(e=e.replace(r,I),u("hyphen replace",e),e=e.replace(s[31],"$1$2$3"),u("comparator trim",e,s[31]),e=(e=(e=e.replace(s[22],"$1~")).replace(s[26],"$1^")).split(/\s+/).join(" "),t?s[29]:s[30]),r=e.split(" ").map(function(e){return e=e,t=this.options,u("comp",e,t),o=t,e=e.trim().split(/\s+/).map(function(e){var a=e,e=o;return u("caret",a,e),e=(e=e&&"object"==typeof e?e:{loose:!!e,includePrerelease:!1}).loose?s[28]:s[27],a.replace(e,function(e,t,r,n,i){return u("caret",a,e,t,r,n,i),e=g(t)?"":g(r)?">="+t+".0.0 <"+(+t+1)+".0.0":g(n)?"0"===t?">="+t+"."+r+".0 <"+t+"."+(+r+1)+".0":">="+t+"."+r+".0 <"+(+t+1)+".0.0":i?(u("replaceCaret pr",i),"-"!==i.charAt(0)&&(i="-"+i),"0"===t?"0"===r?">="+t+"."+r+"."+n+i+" <"+t+"."+r+"."+(+n+1):">="+t+"."+r+"."+n+i+" <"+t+"."+(+r+1)+".0":">="+t+"."+r+"."+n+i+" <"+(+t+1)+".0.0"):(u("no pr"),"0"===t?"0"===r?">="+t+"."+r+"."+n+" <"+t+"."+r+"."+(+n+1):">="+t+"."+r+"."+n+" <"+t+"."+(+r+1)+".0":">="+t+"."+r+"."+n+" <"+(+t+1)+".0.0"),u("caret return",e),e})}).join(" "),u("caret",e),i=t,e=e.trim().split(/\s+/).map(function(e){return a=e,e=(i&&"object"==typeof i?i:{loose:!!i,includePrerelease:!1}).loose?s[24]:s[23],a.replace(e,function(e,t,r,n,i){return u("tilde",a,e,t,r,n,i),e=g(t)?"":g(r)?">="+t+".0.0 <"+(+t+1)+".0.0":g(n)?">="+t+"."+r+".0 <"+t+"."+(+r+1)+".0":i?(u("replaceTilde pr",i),">="+t+"."+r+"."+n+(i="-"!==i.charAt(0)?"-"+i:i)+" <"+t+"."+(+r+1)+".0"):">="+t+"."+r+"."+n+" <"+t+"."+(+r+1)+".0",u("tilde return",e),e});var a}).join(" "),u("tildes",e),u("replaceXRanges",r=e,n=t),e=r.split(/\s+/).map(function(e){var c=e,e=n;return c=c.trim(),e=(e=e&&"object"==typeof e?e:{loose:!!e,includePrerelease:!1}).loose?s[19]:s[18],c.replace(e,function(e,t,r,n,i,a){u("xRange",c,e,t,r,n,i,a);var a=g(r),o=a||g(n),s=o||g(i);return"="===t&&s&&(t=""),a?e=">"===t||"<"===t?"<0.0.0":"*":t&&s?(o&&(n=0),s&&(i=0),">"===t?(t=">=",o?(r=+r+1,i=n=0):s&&(n=+n+1,i=0)):"<="===t&&(t="<",o?r=+r+1:n=+n+1),e=t+r+"."+n+"."+i):o?e=">="+r+".0.0 <"+(+r+1)+".0.0":s&&(e=">="+r+"."+n+".0 <"+r+"."+(+n+1)+".0"),u("xRange return",e),e})}).join(" "),u("xrange",e),u("replaceStars",r=e,t),e=r.trim().replace(s[34],""),u("stars",e),e;var t,r,n,i,o},this).join(" ").split(/\s+/);return(r=this.options.loose?r.filter(function(e){return!!e.match(n)}):r).map(function(e){return new p(e,this.options)},this)},m.prototype.intersects=function(r,n){if(!(r instanceof m))throw new TypeError("a Range is required");return this.set.some(function(e){return e.every(function(t){return r.set.some(function(e){return e.every(function(e){return t.intersects(e,n)})})})})},n.toComparators=function(e,t){return new m(e,t).set.map(function(e){return e.map(function(e){return e.value}).join(" ").trim().split(" ")})},m.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new f(e,this.options));for(var t=0;t<this.set.length;t++)if(function(e,t,r){for(var n=0;n<e.length;n++)if(!e[n].test(t))return;if(r=r||{},!t.prerelease.length||r.includePrerelease)return 1;for(n=0;n<e.length;n++)if(u(e[n].semver),e[n].semver!==E&&0<e[n].semver.prerelease.length){var i=e[n].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return 1}}(this.set[t],e,this.options))return!0;return!1},n.satisfies=P,n.maxSatisfying=function(e,t,r){var n=null,i=null;try{var a=new m(t,r)}catch(e){return null}return e.forEach(function(e){a.test(e)&&(n&&-1!==i.compare(e)||(i=new f(n=e,r)))}),n},n.minSatisfying=function(e,t,r){var n=null,i=null;try{var a=new m(t,r)}catch(e){return null}return e.forEach(function(e){a.test(e)&&(n&&1!==i.compare(e)||(i=new f(n=e,r)))}),n},n.validRange=function(e,t){try{return new m(e,t).range||"*"}catch(e){return null}},n.ltr=function(e,t,r){return A(e,t,"<",r)},n.gtr=function(e,t,r){return A(e,t,">",r)},n.outside=A,n.prerelease=function(e,t){e=v(e,t);return e&&e.prerelease.length?e.prerelease:null},n.intersects=function(e,t,r){return e=new m(e,r),t=new m(t,r),e.intersects(t)},n.coerce=function(e){if(e instanceof f)return e;if("string"!=typeof e)return null;e=e.match(s[20]);return null==e?null:v((e[1]||"0")+"."+(e[2]||"0")+"."+(e[3]||"0"))}})).SEMVER_SPEC_VERSION,e.re,e.src,e.parse,e.valid,e.clean,e.SemVer,e.inc,e.diff,e.compareIdentifiers,e.rcompareIdentifiers,e.major,e.minor,e.patch,e.compare,e.compareLoose,e.rcompare,e.sort,e.rsort;var Q=e.gt,Z=e.lt,Y=(e.eq,e.neq,e.gte),ee=e.lte;e.cmp,e.Comparator,e.Range,e.toComparators,e.satisfies,e.maxSatisfying,e.minSatisfying,e.validRange,e.ltr,e.gtr,e.outside,e.prerelease,e.intersects,e.coerce;const At=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),Mt=!!window.chrome,Dt=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),l=function(){var e=$();if(!navigator||!navigator.appVersion||!e)return e;var t=/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/.exec(window.navigator.appVersion);return t&&t[1]?W({},e,{chromeVersion:t[1]}):e}()||{};function te(){try{return!!RTCPeerConnection&&!!WebSocket&&!!navigator.mediaDevices.getUserMedia}catch(e){return!1}}function re(){var e=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia,t=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().displaySurface;return At?!!e&&!!t:!!e}function ne(){return"createMediaStreamDestination"in AudioContext.prototype}const b=function(){if(!l)return{support:te(),supportRestartICE:!0,getDisplayMedia:re(),disconnectAudioNode:!0};switch(l.name){case"chrome":return{support:Y(l.version,"52.0.0"),mediaStreamDest:Y(l.version,"55.0.0"),replaceTrack:Y(l.version,"65.0.0"),screenSharing:Y(l.version,"55.0.0"),connectionState:Y(l.version,"72.0.0"),stats:Y(l.version,"67.0.0"),ondevicechange:Y(l.version,"57.0.0"),minMaxWithIdeal:Y(l.version,"56.0.0"),supportTransceivers:Y(l.version,"69.0.0"),unifiedPlan:Y(l.version,"72.0.0"),supportRestartICE:!0,getReceivers:Y(l.version,"59.0.0"),needH264FmtpLine:ee(l.version,"51.0.0"),audioContextOptions:!0,getDisplayMedia:re(),disconnectAudioNode:!0};case"ios":case"safari":return{support:Y(l.version,"11.0.0"),replaceTrack:Y(l.version,"11.0.0"),stats:!1,ondevicechange:!1,connectionState:!0,mediaStreamDest:Y(l.version,"12.0.0"),screenSharing:Y(l.version,"13.0.0"),unifiedPlan:Y(l.version,"12.1.0"),supportTransceivers:!0,minMaxWithIdeal:!1,supportRestartICE:!0,getReceivers:!0,audioContextOptions:!0,getDisplayMedia:re(),disconnectAudioNode:!1};case"firefox":return{support:te()&&Y(l.version,"52.0.0"),replaceTrack:!0,stats:!0,ondevicechange:Y(l.version,"52.0.0"),connectionState:!0,mediaStreamDest:!0,screenSharing:!0,minMaxWithIdeal:!0,unifiedPlan:!0,supportTransceivers:Y(l.version,"59.0.0"),supportRestartICE:!1,getReceivers:!0,audioContextOptions:Y(l.version,"55.0.0"),getDisplayMedia:re(),disconnectAudioNode:!0};case"crios":case"ios-webview":return{support:te(),getDisplayMedia:re(),mediaStreamDest:ne(),unifiedPlan:!0,supportTransceivers:!0,supportRestartICE:!0,disconnectAudioNode:!0};default:return{support:te(),mediaStreamDest:ne(),supportRestartICE:!0,getDisplayMedia:re(),disconnectAudioNode:!0}}}();if("chrome"===l.name){const ln=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const i={};return Object.keys(e).forEach(t=>{if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){const r="object"==typeof e[t]?e[t]:{ideal:e[t]},n=(void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact),function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t});if(void 0!==r.ideal){i.optional=i.optional||[];let e={};"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,i.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,i.optional.push(e)}void 0!==r.exact&&"number"!=typeof r.exact?(i.mandatory=i.mandatory||{},i.mandatory[n("",t)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(i.mandatory=i.mandatory||{},i.mandatory[n(e,t)]=r[e])})}}),e.advanced&&(i.optional=(i.optional||[]).concat(e.advanced)),i},hn=function(r){return new Promise((e,t)=>{navigator.getUserMedia(r,e,t)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:hn,enumerateDevices:()=>new Promise(t=>{const r={audio:"audioinput",video:"videoinput"};return window.MediaStreamTrack.getSources(e=>{t(e.map(e=>({label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""})))})})}),navigator.mediaDevices.getSupportedConstraints||(navigator.mediaDevices.getSupportedConstraints=()=>({deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0})),navigator.mediaDevices.getUserMedia){const hn=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){var i=e,a=t=>hn(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(e));if(Q(l.version,"61.0.0"))return a(i);if((i=JSON.parse(JSON.stringify(i)))&&"object"==typeof i.audio){const a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","googAutoGainControl"),a(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=ln(i.audio)}if(i&&"object"==typeof i.video){let n=i.video.facingMode;n=n&&("object"==typeof n?n:{ideal:n});e=Z(l.version,"66.0.0");if(n&&("user"===n.exact||"environment"===n.exact||"user"===n.ideal||"environment"===n.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||e)){delete i.video.facingMode;let r=void 0;if("environment"===n.exact||"environment"===n.ideal?r=["back","rear"]:"user"!==n.exact&&"user"!==n.ideal||(r=["front"]),r)return navigator.mediaDevices.enumerateDevices().then(e=>{let t=(e=e.filter(e=>"videoinput"===e.kind)).find(t=>r.some(e=>t.label.toLowerCase().includes(e)));return(t=!t&&e.length&&r.includes("back")?e[e.length-1]:t)&&(i.video.deviceId=n.exact?{exact:t.deviceId}:{ideal:t.deviceId}),i.video=ln(i.video),a(i)})}i.video=ln(i.video)}return a(i)}}else navigator.mediaDevices.getUserMedia=function(e){return hn(e)}}"firefox"===l.name&&(t=function(n){return new Promise((e,t)=>{var r;e=e,r=t,t=JSON.parse(JSON.stringify(n)),navigator.mozGetUserMedia(t,e,e=>{r(e)})})},navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:t,addEventListener(){},removeEventListener(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(e=>{e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})});var e=K(function(e){function t(){}function a(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var n,i,o;n="undefined"!=typeof window?window:$e||{},i=t.prototype,o=n.EventEmitter,i.getListeners=function(e){var t,r,n=this._getEvents();if(e instanceof RegExp)for(r in t={},n)n.hasOwnProperty(r)&&e.test(r)&&(t[r]=n[r]);else t=n[e]||(n[e]=[]);return t},i.flattenListeners=function(e){for(var t=[],r=0;r<e.length;r+=1)t.push(e[r].listener);return t},i.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&((t={})[e]=r),t||r},i.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var r,n=this.getListenersAsObject(e),i="object"==typeof t;for(r in n)n.hasOwnProperty(r)&&-1===a(n[r],t)&&n[r].push(i?t:{listener:t,once:!1});return this},i.on=r("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=r("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,t){var r,n,i=this.getListenersAsObject(e);for(n in i)i.hasOwnProperty(n)&&-1!==(r=a(i[n],t))&&i[n].splice(r,1);return this},i.off=r("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,r){var n,i,a=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=r.length;n--;)a.call(this,t,r[n]);else for(n in t)t.hasOwnProperty(n)&&(i=t[n])&&("function"==typeof i?a:o).call(this,n,i);return this},i.removeEvent=function(e){var t,r=typeof e,n=this._getEvents();if("string"==r)delete n[e];else if(e instanceof RegExp)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},i.removeAllListeners=r("removeEvent"),i.emitEvent=function(e,t){var r,n,i,a,o=this.getListenersAsObject(e);for(a in o)if(o.hasOwnProperty(a))for(r=o[a].slice(0),i=0;i<r.length;i++)!0===(n=r[i]).once&&this.removeListener(e,n.listener),n.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=r("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return n.EventEmitter=o,t},e.exports?e.exports=t:n.EventEmitter=t}),ie=K(function(s,e){var c="__lodash_hash_undefined__",A=1,M=2,u=1/0,d=9007199254740991,D="[object Arguments]",x="[object Array]",O="[object Boolean]",L="[object Date]",j="[object Error]",l="[object Function]",h="[object GeneratorFunction]",N="[object Map]",B="[object Number]",F="[object Object]",U="[object RegExp]",V="[object Set]",G="[object String]",W="[object Symbol]",H="[object ArrayBuffer]",z="[object DataView]",f=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/,m=/^\./,g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,v=/\\(\\)?/g,y=/^\[object .+?Constructor\]$/,b=/^(?:0|[1-9]\d*)$/,t={},k=(t["[object Float32Array]"]=t["[object Float64Array]"]=t["[object Int8Array]"]=t["[object Int16Array]"]=t["[object Int32Array]"]=t["[object Uint8Array]"]=t["[object Uint8ClampedArray]"]=t["[object Uint16Array]"]=t["[object Uint32Array]"]=!0,t[D]=t[x]=t[H]=t[O]=t[z]=t[L]=t[j]=t[l]=t[N]=t[B]=t[F]=t[U]=t[V]=t[G]=t["[object WeakMap]"]=!1,"object"==typeof $e&&$e&&$e.Object===Object&&$e),r="object"==typeof self&&self&&self.Object===Object&&self,r=k||r||Function("return this")(),e=e&&!e.nodeType&&e,n=e&&s&&!s.nodeType&&s,_=n&&n.exports===e&&k.process,n=function(){try{return _&&_.binding("util")}catch(e){}}(),e=n&&n.isTypedArray;function J(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function q(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}function $(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var w,S,k=Array.prototype,n=Function.prototype,T=Object.prototype,i=r["__core-js_shared__"],C=(i=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",R=n.toString,E=T.hasOwnProperty,X=T.toString,K=RegExp("^"+R.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),i=r.Symbol,Q=r.Uint8Array,Z=T.propertyIsEnumerable,Y=k.splice,ee=(w=Object.keys,S=Object,function(e){return w(S(e))}),n=_e(r,"DataView"),te=_e(r,"Map"),k=_e(r,"Promise"),re=_e(r,"Set"),r=_e(r,"WeakMap"),ne=_e(Object,"create"),ie=Ie(n),ae=Ie(te),oe=Ie(k),se=Ie(re),ce=Ie(r),i=i?i.prototype:void 0,ue=i?i.valueOf:void 0,de=i?i.toString:void 0;function le(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function a(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function o(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function he(e){var t=-1,r=e?e.length:0;for(this.__data__=new o;++t<r;)this.add(e[t])}function I(e){this.__data__=new a(e)}function fe(e,t){for(var r=e.length;r--;)if(Ae(e[r][0],t))return r;return-1}function pe(e,t){for(var r=0,n=(t=Se(t,e)?[t]:ye(t)).length;null!=e&&r<n;)e=e[Ee(t[r++])];return r&&r==n?e:void 0}function me(e,t){return null!=e&&t in Object(e)}function ge(e,t,r,n,i){return e===t||(null==e||null==t||!je(e)&&!Ne(t)?e!=e&&t!=t:function(e,t,d,l,h,r){var n=De(e),f=De(t),p=x,i=x,f=(n||(p=(p=P(e))==D?F:p),f||(i=(i=P(t))==D?F:i),p==F&&!J(e)),a=i==F&&!J(t),i=p==i;if(i&&!f)return r=r||new I,(n||Ue(e)?be:function(e,t,r,n,i,a){switch(p){case z:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case H:return!(e.byteLength!=t.byteLength||!r(new Q(e),new Q(t)));case O:case L:case B:return Ae(+e,+t);case j:return e.name==t.name&&e.message==t.message;case U:case G:return e==t+"";case N:var o=q;case V:o=o||$;if(e.size!=t.size&&!(i&M))return!1;var s=a.get(e);if(s)return s==t;i|=A,a.set(e,t);s=be(o(e),o(t),r,n,i,a);return a.delete(e),s;case W:if(ue)return ue.call(e)==ue.call(t)}return!1})(e,t,d,l,h,r);if(!(h&M)){n=f&&E.call(e,"__wrapped__"),f=a&&E.call(t,"__wrapped__");if(n||f)return d(n?e.value():e,f?t.value():t,l,h,r=r||new I)}if(i){r=r||new I;var o=e,s=t,m=d,g=l,v=h,c=r,y=v&M,b=Ve(o),k=b.length;if(k!=Ve(s).length&&!y)return!1;for(var _=k;_--;){var u=b[_];if(!(y?u in s:E.call(s,u)))return!1}a=c.get(o);if(a&&c.get(s))return a==s;var w=!0;c.set(o,s),c.set(s,o);for(var S=y;++_<k;){var T,C=o[u=b[_]],R=s[u];if(!(void 0===(T=g?y?g(R,C,u,s,o,c):g(C,R,u,o,s,c):T)?C===R||m(C,R,g,v,c):T)){w=!1;break}S=S||"constructor"==u}return!w||S||(a=o.constructor)!=(n=s.constructor)&&"constructor"in o&&"constructor"in s&&!("function"==typeof a&&a instanceof a&&"function"==typeof n&&n instanceof n)&&(w=!1),c.delete(o),c.delete(s),w}return!1}(e,t,ge,r,n,i))}function ve(e){return"function"==typeof e?e:null==e?Ge:"object"==typeof e?De(e)?(i=e[0],a=e[1],Se(i)&&Te(a)?Ce(Ee(i),a):function(e){var t=void 0===(t=null==e?void 0:pe(e,i))?void 0:t;return void 0===t&&t===a?null!=e&&function(e,t,r){for(var n,i=-1,a=(t=Se(t,e)?[t]:ye(t)).length;++i<a;){var o=Ee(t[i]);if(!(n=null!=e&&r(e,o)))break;e=e[o]}return n||!!(a=e?e.length:0)&&Le(a)&&we(o,a)&&(De(e)||Me(e))}(e,i,me):ge(a,t,void 0,A|M)}):1==(n=function(e){for(var t=Ve(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Te(i)]}return t}(r=e)).length&&n[0][2]?Ce(n[0][0],n[0][1]):function(d){return d===r||function(e,t,r){var n=t.length,i=n;if(null==d)return!i;for(e=Object(d);n--;){var a=t[n];if(a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++n<i;){var o=(a=t[n])[0],s=e[o],c=a[1];if(a[2]){if(void 0===s&&!(o in e))return!1}else{var u,o=new I;if(!(void 0===u?ge(c,s,r,A|M,o):u))return!1}}return!0}(0,n)}:Se(e=e)?(o=Ee(e),function(e){return null==e?void 0:e[o]}):(t=e,function(e){return pe(e,t)});var t,r,n,i,a,o}function ye(e){return De(e)?e:Re(e)}function be(e,t,d,r,n,i){var l=n&M,h=e.length,a=t.length;if(h!=a&&!(l&&h<a))return!1;a=i.get(e);if(a&&i.get(t))return a==t;var o=-1,s=!0,f=n&A?new he:void 0;for(i.set(e,t),i.set(t,e);++o<h;){var p,c=e[o],u=t[o];if(void 0!==(p=r?l?r(u,c,o,t,e,i):r(c,u,o,e,t,i):p)){if(p)continue;s=!1;break}if(f){if(!function(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return 1}(t,function(e,t){return!f.has(t)&&(c===e||d(c,e,r,n,i))&&f.add(t)})){s=!1;break}}else if(c!==u&&!d(c,u,r,n,i)){s=!1;break}}return i.delete(e),i.delete(t),s}function ke(e,t){var r,e=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map}function _e(e,t){e=null==e?void 0:e[t];return!je(t=e)||C&&C in t||!(Oe(t)||J(t)?K:y).test(Ie(t))?void 0:e}le.prototype.clear=function(){this.__data__=ne?ne(null):{}},le.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},le.prototype.get=function(e){var t,r=this.__data__;return ne?(t=r[e])===c?void 0:t:E.call(r,e)?r[e]:void 0},le.prototype.has=function(e){var t=this.__data__;return ne?void 0!==t[e]:E.call(t,e)},le.prototype.set=function(e,t){return this.__data__[e]=ne&&void 0===t?c:t,this},a.prototype.clear=function(){this.__data__=[]},a.prototype.delete=function(e){var t=this.__data__,e=fe(t,e);return!(e<0||(e==t.length-1?t.pop():Y.call(t,e,1),0))},a.prototype.get=function(e){var t=this.__data__,e=fe(t,e);return e<0?void 0:t[e][1]},a.prototype.has=function(e){return-1<fe(this.__data__,e)},a.prototype.set=function(e,t){var r=this.__data__,n=fe(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},o.prototype.clear=function(){this.__data__={hash:new le,map:new(te||a),string:new le}},o.prototype.delete=function(e){return ke(this,e).delete(e)},o.prototype.get=function(e){return ke(this,e).get(e)},o.prototype.has=function(e){return ke(this,e).has(e)},o.prototype.set=function(e,t){return ke(this,e).set(e,t),this},he.prototype.add=he.prototype.push=function(e){return this.__data__.set(e,c),this},he.prototype.has=function(e){return this.__data__.has(e)},I.prototype.clear=function(){this.__data__=new a},I.prototype.delete=function(e){return this.__data__.delete(e)},I.prototype.get=function(e){return this.__data__.get(e)},I.prototype.has=function(e){return this.__data__.has(e)},I.prototype.set=function(e,t){var r=this.__data__;if(r instanceof a){var n=r.__data__;if(!te||n.length<199)return n.push([e,t]),this;r=this.__data__=new o(n)}return r.set(e,t),this};var P=function(e){return X.call(e)};function we(e,t){return!!(t=null==t?d:t)&&("number"==typeof e||b.test(e))&&-1<e&&e%1==0&&e<t}function Se(e,t){var r;if(!De(e))return r=typeof e,"number"==r||"symbol"==r||"boolean"==r||null==e||Be(e)||p.test(e)||!f.test(e)||null!=t&&e in Object(t)}function Te(e){return e==e&&!je(e)}function Ce(t,r){return function(e){return null!=e&&e[t]===r&&(void 0!==r||t in Object(e))}}(n&&P(new n(new ArrayBuffer(1)))!=z||te&&P(new te)!=N||k&&"[object Promise]"!=P(k.resolve())||re&&P(new re)!=V||r&&"[object WeakMap]"!=P(new r))&&(P=function(e){var t=X.call(e),e=t==F?e.constructor:void 0,e=e?Ie(e):void 0;if(e)switch(e){case ie:return z;case ae:return N;case oe:return"[object Promise]";case se:return V;case ce:return"[object WeakMap]"}return t});var Re=Pe(function(e){e=null==e?"":function(e){if("string"==typeof e)return e;if(Be(e))return de?de.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}(e);var i=[];return m.test(e)&&i.push(""),e.replace(g,function(e,t,r,n){i.push(r?n.replace(v,"$1"):t||e)}),i});function Ee(e){if("string"==typeof e||Be(e))return e;var t=e+"";return"0"==t&&1/e==-u?"-0":t}function Ie(e){if(null!=e){try{return R.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Pe(n,i){if("function"!=typeof n||i&&"function"!=typeof i)throw new TypeError("Expected a function");function a(){var e=arguments,t=i?i.apply(this,e):e[0],r=a.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),a.cache=r.set(t,e),e)}return a.cache=new(Pe.Cache||o),a}function Ae(e,t){return e===t||e!=e&&t!=t}function Me(e){return Ne(e)&&xe(e)&&E.call(e,"callee")&&(!Z.call(e,"callee")||X.call(e)==D)}Pe.Cache=o;var De=Array.isArray;function xe(e){return null!=e&&Le(e.length)&&!Oe(e)}function Oe(e){e=je(e)?X.call(e):"";return e==l||e==h}function Le(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=d}function je(e){var t=typeof e;return e&&("object"==t||"function"==t)}function Ne(e){return!!e&&"object"==typeof e}function Be(e){return"symbol"==typeof e||Ne(e)&&X.call(e)==W}var Fe,Ue=e?(Fe=e,function(e){return Fe(e)}):function(e){return Ne(e)&&Le(e.length)&&!!t[X.call(e)]};function Ve(e){return(xe(e)?function(e,t){var r,n=De(e)||Me(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=n.length,a=!!i;for(r in e)!t&&!E.call(e,r)||a&&("length"==r||we(r,i))||n.push(r);return n}:function(e){if(e!==("function"==typeof(t=e&&e.constructor)&&t.prototype||T))return ee(e);var t,r,n=[];for(r in Object(e))E.call(e,r)&&"constructor"!=r&&n.push(r);return n})(e)}function Ge(e){return e}s.exports=function(e,t){var r=[];if(!e||!e.length)return r;var n=-1,i=[],d=e.length;for(t=ve(t);++n<d;){var l=e[n];t(l,n,e)&&(r.push(l),i.push(n))}for(var a,o=e,h=i,s=o?h.length:0,f=s-1;s--;){var p,c,u=h[s];s!=f&&u===p||(we(p=u)?Y.call(o,u,1):Se(u,o)?delete o[Ee(u)]:(u=ye(u),c=o,null!=(c=1==(a=u).length?c:pe(c,function(e,t,r){var n=-1,i=e.length;(r=i<r?i:r)<0&&(r+=i),i=r<(t=t<0?i<-t?0:i+t:t)?0:r-t>>>0,t>>>=0;for(var a=Array(i);++n<i;)a[n]=e[n+t];return a}(a,0,-1)))&&delete c[Ee((a=void 0,(a=(c=u)?c.length:0)?c[a-1]:void 0))]))}return r}});const xt=e=>!!e&&!!e.audio&&e.audio.enabled,Ot=e=>!!e&&!!e.video&&e.video.enabled,Lt=e=>!!e&&!!e.screen&&e.screen.enabled,jt=((t=w.PermissionNameCode||(w.PermissionNameCode={}))[t.camera=0]="camera",t[t.microphone=1]="microphone",(t=w.PermissionStateCode||(w.PermissionStateCode={}))[t.prompt=1]="prompt",t[t.denied=2]="denied",t[t.granted=3]="granted",(t=w.DeviceState||(w.DeviceState={})).ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",{"120p":{width:160,height:120,frameRate:15,bitrate:65},"120p_1":{width:160,height:120,frameRate:15,bitrate:65},"120p_3":{width:120,height:120,frameRate:15,bitrate:50},"180p":{width:320,height:180,frameRate:15,bitrate:140},"180p_1":{width:320,height:180,frameRate:15,bitrate:140},"180p_3":{width:180,height:180,frameRate:15,bitrate:100},"180p_4":{width:240,height:180,frameRate:15,bitrate:120},"240p":{width:320,height:240,frameRate:15,bitrate:200},"240p_1":{width:320,height:240,frameRate:15,bitrate:200},"240p_3":{width:240,height:240,frameRate:15,bitrate:140},"240p_4":{width:424,height:240,frameRate:15,bitrate:220},"360p":{width:640,height:360,frameRate:15,bitrate:400},"360p_1":{width:640,height:360,frameRate:15,bitrate:400},"360p_3":{width:360,height:360,frameRate:15,bitrate:260},"360p_4":{width:640,height:360,frameRate:30,bitrate:600},"360p_6":{width:360,height:360,frameRate:30,bitrate:400},"360p_7":{width:480,height:360,frameRate:15,bitrate:320},"360p_8":{width:480,height:360,frameRate:30,bitrate:490},"360p_9":{width:640,height:360,frameRate:15,bitrate:800},"360p_10":{width:640,height:360,frameRate:24,bitrate:800},"360p_11":{width:640,height:360,frameRate:24,bitrate:1e3},"480p":{width:640,height:480,frameRate:15,bitrate:500},"480p_1":{width:640,height:480,frameRate:15,bitrate:500},"480p_2":{width:640,height:480,frameRate:30,bitrate:1e3},"480p_3":{width:480,height:480,frameRate:15,bitrate:400},"480p_4":{width:640,height:480,frameRate:30,bitrate:750},"480p_6":{width:480,height:480,frameRate:30,bitrate:600},"480p_8":{width:848,height:480,frameRate:15,bitrate:610},"480p_9":{width:848,height:480,frameRate:30,bitrate:930},"480p_10":{width:640,height:480,frameRate:10,bitrate:400},"720p":{width:1280,height:720,frameRate:15,bitrate:1130},"720p_1":{width:1280,height:720,frameRate:15,bitrate:1130},"720p_2":{width:1280,height:720,frameRate:30,bitrate:2e3},"720p_3":{width:1280,height:720,frameRate:30,bitrate:1710},"720p_5":{width:960,height:720,frameRate:15,bitrate:910},"720p_6":{width:960,height:720,frameRate:30,bitrate:1380},"1080p":{width:1920,height:1080,frameRate:15,bitrate:2080},"1080p_1":{width:1920,height:1080,frameRate:15,bitrate:2080},"1080p_2":{width:1920,height:1080,frameRate:30,bitrate:3e3},"1080p_3":{width:1920,height:1080,frameRate:30,bitrate:3150},"1080p_5":{width:1920,height:1080,frameRate:60,bitrate:4780},"1440p":{width:2560,height:1440,frameRate:30,bitrate:4850},"1440p_1":{width:2560,height:1440,frameRate:30,bitrate:4850},"1440p_2":{width:2560,height:1440,frameRate:60,bitrate:7350},"4k":{width:3840,height:2160,frameRate:30,bitrate:8910},"4k_1":{width:3840,height:2160,frameRate:30,bitrate:8910},"4k_3":{width:3840,height:2160,frameRate:60,bitrate:13500}}),Nt={width:{ideal:640},height:{ideal:480},frameRate:15,bitrate:500},Bt={speech_low_quality:{sampleRate:16e3,stereo:!1,bitrate:24},speech_standard:{sampleRate:32e3,stereo:!1,bitrate:24},music_standard:{sampleRate:48e3,stereo:!1,bitrate:40},standard_stereo:{sampleRate:48e3,stereo:!0,bitrate:64},high_quality:{sampleRate:48e3,stereo:!1,bitrate:128},high_quality_stereo:{sampleRate:48e3,stereo:!0,bitrate:192}},Ft={"480p":{width:640,height:480,frameRate:5},"480p_1":{width:640,height:480,frameRate:5},"480p_2":{width:640,height:480,frameRate:30},"480p_3":{width:640,height:480,frameRate:15},"720p":{width:1280,height:720,frameRate:5},"720p_1":{width:1280,height:720,frameRate:5},"720p_2":{width:1280,height:720,frameRate:30},"720p_3":{width:1280,height:720,frameRate:15},"1080p":{width:1920,height:1080,frameRate:5},"1080p_1":{width:1920,height:1080,frameRate:5},"1080p_2":{width:1920,height:1080,frameRate:30},"1080p_3":{width:1920,height:1080,frameRate:15}},Ut=Ft["720p"],Vt=((t=w.NetworkGrade||(w.NetworkGrade={}))[t.INVALID=-1]="INVALID",t[t.EXCELLENT=1]="EXCELLENT",t[t.GOOD=2]="GOOD",t[t.FAIR=3]="FAIR",t[t.POOR=4]="POOR",(t=w.TrackConnectStatus||(w.TrackConnectStatus={}))[t.Idle=0]="Idle",t[t.Connecting=1]="Connecting",t[t.Connect=2]="Connect",(t=w.TrackSourceType||(w.TrackSourceType={}))[t.NORMAL=0]="NORMAL",t[t.EXTERNAL=1]="EXTERNAL",{publishUrl:"",height:720,width:1080,fps:25,kbps:1e3,audioOnly:!(t[t.MIXING=2]="MIXING"),stretchMode:"aspectFill"}),Gt=((t=w.AudioSourceState||(w.AudioSourceState={})).IDLE="idle",t.LOADING="loading",t.PLAY="play",t.PAUSE="pause",t.END="end",{Init:1,UnInit:2,JoinRoom:3,MCSAuth:4,SignalAuth:5,LeaveRoom:6,PublisherPC:7,PublishTracks:8,UnPublishTracks:9,SubscriberPC:10,SubscribeTracks:11,UnSubscribeTracks:13,MuteTracks:14,ICEConnectionState:15,CallbackStatistics:16,KickoutUser:17,RoomStateChanged:18,AudioDeviceInOut:19,VideoDeviceInOut:20,SDKError:21,ApplicationState:22,CreateMergeJob:24,UpdateMergeTracks:25,StopMerge:26,AuthorizationStatus:27,DeviceChanged:28,DefaultSetting:29,MediaStatistics:30,AbnormalDisconnect:31,WebsocketConnect:40,WebConsoleLog:45,NetworkChange:46,SystemRequirementsTest:47});var ae=K(function(e){var t=$e,r=function(){function l(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function h(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:[e[1]<<(t-=32)|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t]}function f(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function p(e){return e=g(e,[0,e[0]>>>1]),e=m(e,[4283543511,3981806797]),e=g(e,[0,e[0]>>>1]),e=m(e,[3301882366,444984403]),g(e,[0,e[0]>>>1])}function d(e,t){for(var r=(e=e||"").length%16,d=e.length-r,n=[0,t=t||0],i=[0,t],a=[0,0],o=[0,0],s=[2277735313,289559509],c=[1291169091,658871167],u=0;u<d;u+=16)a=[255&e.charCodeAt(u+4)|(255&e.charCodeAt(u+5))<<8|(255&e.charCodeAt(u+6))<<16|(255&e.charCodeAt(u+7))<<24,255&e.charCodeAt(u)|(255&e.charCodeAt(u+1))<<8|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+3))<<24],o=[255&e.charCodeAt(u+12)|(255&e.charCodeAt(u+13))<<8|(255&e.charCodeAt(u+14))<<16|(255&e.charCodeAt(u+15))<<24,255&e.charCodeAt(u+8)|(255&e.charCodeAt(u+9))<<8|(255&e.charCodeAt(u+10))<<16|(255&e.charCodeAt(u+11))<<24],a=m(a,s),a=h(a,31),a=m(a,c),n=g(n,a),n=h(n,27),n=l(n,i),n=l(m(n,[0,5]),[0,1390208809]),o=m(o,c),o=h(o,33),o=m(o,s),i=g(i,o),i=h(i,31),i=l(i,n),i=l(m(i,[0,5]),[0,944331445]);switch(a=[0,0],o=[0,0],r){case 15:o=g(o,f([0,e.charCodeAt(u+14)],48));case 14:o=g(o,f([0,e.charCodeAt(u+13)],40));case 13:o=g(o,f([0,e.charCodeAt(u+12)],32));case 12:o=g(o,f([0,e.charCodeAt(u+11)],24));case 11:o=g(o,f([0,e.charCodeAt(u+10)],16));case 10:o=g(o,f([0,e.charCodeAt(u+9)],8));case 9:o=g(o,[0,e.charCodeAt(u+8)]),o=m(o,c),o=h(o,33),o=m(o,s),i=g(i,o);case 8:a=g(a,f([0,e.charCodeAt(u+7)],56));case 7:a=g(a,f([0,e.charCodeAt(u+6)],48));case 6:a=g(a,f([0,e.charCodeAt(u+5)],40));case 5:a=g(a,f([0,e.charCodeAt(u+4)],32));case 4:a=g(a,f([0,e.charCodeAt(u+3)],24));case 3:a=g(a,f([0,e.charCodeAt(u+2)],16));case 2:a=g(a,f([0,e.charCodeAt(u+1)],8));case 1:a=g(a,[0,e.charCodeAt(u)]),a=m(a,s),a=h(a,31),a=m(a,c),n=g(n,a)}return n=g(n,[0,e.length]),i=g(i,[0,e.length]),n=l(n,i),i=l(i,n),n=p(n),i=p(i),n=l(n,i),i=l(i,n),("00000000"+(n[0]>>>0).toString(16)).slice(-8)+("00000000"+(n[1]>>>0).toString(16)).slice(-8)+("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)}function i(e){if(null==navigator.plugins)return e.NOT_AVAILABLE;for(var t=[],r=0,n=navigator.plugins.length;r<n;r++)navigator.plugins[r]&&t.push(navigator.plugins[r]);return v(e)&&(t=t.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})),s(t,function(e){var t=s(e,function(e){return[e.type,e.suffixes]});return[e.name,e.description,t]})}function r(){function e(e){return a.clearColor(0,0,0,1),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),"["+e[0]+", "+e[1]+"]"}var a;if(!(a=c()))return null;var o=[],t=a.createBuffer(),r=(a.bindBuffer(a.ARRAY_BUFFER,t),new Float32Array([-.2,-.9,0,.4,-.26,0,0,.732134444,0])),r=(a.bufferData(a.ARRAY_BUFFER,r,a.STATIC_DRAW),t.itemSize=3,t.numItems=3,a.createProgram()),n=a.createShader(a.VERTEX_SHADER),i=(a.shaderSource(n,"attribute vec2 attrVertex;varying vec2 varyinTexCoordinate;uniform vec2 uniformOffset;void main(){varyinTexCoordinate=attrVertex+uniformOffset;gl_Position=vec4(attrVertex,0,1);}"),a.compileShader(n),a.createShader(a.FRAGMENT_SHADER));a.shaderSource(i,"precision mediump float;varying vec2 varyinTexCoordinate;void main() {gl_FragColor=vec4(varyinTexCoordinate,0,1);}"),a.compileShader(i),a.attachShader(r,n),a.attachShader(r,i),a.linkProgram(r),a.useProgram(r),r.vertexPosAttrib=a.getAttribLocation(r,"attrVertex"),r.offsetUniform=a.getUniformLocation(r,"uniformOffset"),a.enableVertexAttribArray(r.vertexPosArray),a.vertexAttribPointer(r.vertexPosAttrib,t.itemSize,a.FLOAT,!1,0,0),a.uniform2f(r.offsetUniform,1,1),a.drawArrays(a.TRIANGLE_STRIP,0,t.numItems);try{o.push(a.canvas.toDataURL())}catch(a){}o.push("extensions:"+(a.getSupportedExtensions()||[]).join(";")),o.push("webgl aliased line width range:"+e(a.getParameter(a.ALIASED_LINE_WIDTH_RANGE))),o.push("webgl aliased point size range:"+e(a.getParameter(a.ALIASED_POINT_SIZE_RANGE))),o.push("webgl alpha bits:"+a.getParameter(a.ALPHA_BITS)),o.push("webgl antialiasing:"+(a.getContextAttributes().antialias?"yes":"no")),o.push("webgl blue bits:"+a.getParameter(a.BLUE_BITS)),o.push("webgl depth bits:"+a.getParameter(a.DEPTH_BITS)),o.push("webgl green bits:"+a.getParameter(a.GREEN_BITS)),o.push("webgl max anisotropy:"+((i=(n=a).getExtension("EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic"))?0===(n=n.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT))?2:n:null)),o.push("webgl max combined texture image units:"+a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS)),o.push("webgl max cube map texture size:"+a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE)),o.push("webgl max fragment uniform vectors:"+a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)),o.push("webgl max render buffer size:"+a.getParameter(a.MAX_RENDERBUFFER_SIZE)),o.push("webgl max texture image units:"+a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS)),o.push("webgl max texture size:"+a.getParameter(a.MAX_TEXTURE_SIZE)),o.push("webgl max varying vectors:"+a.getParameter(a.MAX_VARYING_VECTORS)),o.push("webgl max vertex attribs:"+a.getParameter(a.MAX_VERTEX_ATTRIBS)),o.push("webgl max vertex texture image units:"+a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)),o.push("webgl max vertex uniform vectors:"+a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS)),o.push("webgl max viewport dims:"+e(a.getParameter(a.MAX_VIEWPORT_DIMS))),o.push("webgl red bits:"+a.getParameter(a.RED_BITS)),o.push("webgl renderer:"+a.getParameter(a.RENDERER)),o.push("webgl shading language version:"+a.getParameter(a.SHADING_LANGUAGE_VERSION)),o.push("webgl stencil bits:"+a.getParameter(a.STENCIL_BITS)),o.push("webgl vendor:"+a.getParameter(a.VENDOR)),o.push("webgl version:"+a.getParameter(a.VERSION));try{var s=a.getExtension("WEBGL_debug_renderer_info");s&&(o.push("webgl unmasked vendor:"+a.getParameter(s.UNMASKED_VENDOR_WEBGL)),o.push("webgl unmasked renderer:"+a.getParameter(s.UNMASKED_RENDERER_WEBGL)))}catch(a){}return a.getShaderPrecisionFormat&&u(["FLOAT","INT"],function(i){u(["VERTEX","FRAGMENT"],function(n){u(["HIGH","MEDIUM","LOW"],function(r){u(["precision","rangeMin","rangeMax"],function(e){var t=a.getShaderPrecisionFormat(a[n+"_SHADER"],a[r+"_"+i])[e],e=("precision"!==e&&(e="precision "+e),["webgl ",n.toLowerCase()," shader ",r.toLowerCase()," ",i.toLowerCase()," ",e,":",t].join(""));o.push(e)})})})}),o}function o(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function a(){var e;if(o())return e=c(),!!window.WebGLRenderingContext&&!!e}function c(){var e=document.createElement("canvas"),t=null;try{t=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(e){}return t=t||null}function n(e){throw new Error("'new Fingerprint()' is deprecated, see https://github.com/Valve/fingerprintjs2#upgrade-guide-from-182-to-200")}var m=function(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]},g=function(e,t){return[e[0]^t[0],e[1]^t[1]]},e={preprocessor:null,audio:{timeout:1e3,excludeIOS11:!0},fonts:{swfContainerId:"fingerprintjs2",swfPath:"flash/compiled/FontList.swf",userDefinedFonts:[],extendedJsFonts:!1},screen:{detectScreenOrientation:!0},plugins:{sortPluginsFor:[/palemoon/i],excludeIE:!1},extraComponents:[],excludes:{enumerateDevices:!0,pixelRatio:!0,doNotTrack:!0,fontsFlash:!0},NOT_AVAILABLE:"not available",ERROR:"error",EXCLUDED:"excluded"},u=function(e,t){if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t);else if(e.length===+e.length)for(var r=0,n=e.length;r<n;r++)t(e[r],r,e);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i,e)},s=function(e,n){var i=[];return null==e?i:Array.prototype.map&&e.map===Array.prototype.map?e.map(n):(u(e,function(e,t,r){i.push(n(e,t,r))}),i)},v=function(e){for(var t=!1,r=0,n=e.plugins.sortPluginsFor.length;r<n;r++){var i=e.plugins.sortPluginsFor[r];if(navigator.userAgent.match(i)){t=!0;break}}return t},t=[{key:"userAgent",getData:function(e){e(navigator.userAgent)}},{key:"language",getData:function(e,t){e(navigator.language||navigator.userLanguage||navigator.browserLanguage||navigator.systemLanguage||t.NOT_AVAILABLE)}},{key:"colorDepth",getData:function(e,t){e(window.screen.colorDepth||t.NOT_AVAILABLE)}},{key:"deviceMemory",getData:function(e,t){e(navigator.deviceMemory||t.NOT_AVAILABLE)}},{key:"pixelRatio",getData:function(e,t){e(window.devicePixelRatio||t.NOT_AVAILABLE)}},{key:"hardwareConcurrency",getData:function(e,t){e((e=t,navigator.hardwareConcurrency||e.NOT_AVAILABLE))}},{key:"screenResolution",getData:function(e,t){e((e=[window.screen.width,window.screen.height],t.screen.detectScreenOrientation&&e.sort().reverse(),e))}},{key:"availableScreenResolution",getData:function(e,t){e((e=t,window.screen.availWidth&&window.screen.availHeight?(t=[window.screen.availHeight,window.screen.availWidth],e.screen.detectScreenOrientation&&t.sort().reverse(),t):e.NOT_AVAILABLE))}},{key:"timezoneOffset",getData:function(e){e((new Date).getTimezoneOffset())}},{key:"timezone",getData:function(e,t){window.Intl&&window.Intl.DateTimeFormat?e((new window.Intl.DateTimeFormat).resolvedOptions().timeZone):e(t.NOT_AVAILABLE)}},{key:"sessionStorage",getData:function(e,t){e(function(t){try{return!!window.sessionStorage}catch(e){return t.ERROR}}(t))}},{key:"localStorage",getData:function(e,t){e(function(t){try{return!!window.localStorage}catch(e){return t.ERROR}}(t))}},{key:"indexedDb",getData:function(e,t){e(function(t){try{return!!window.indexedDB}catch(e){return t.ERROR}}(t))}},{key:"addBehavior",getData:function(e){e(!(!document.body||!document.body.addBehavior))}},{key:"openDatabase",getData:function(e){e(!!window.openDatabase)}},{key:"cpuClass",getData:function(e,t){e((e=t,navigator.cpuClass||e.NOT_AVAILABLE))}},{key:"platform",getData:function(e,t){e((e=t,navigator.platform||e.NOT_AVAILABLE))}},{key:"doNotTrack",getData:function(e,t){e((e=t,navigator.doNotTrack||navigator.msDoNotTrack||window.doNotTrack||e.NOT_AVAILABLE))}},{key:"plugins",getData:function(e,t){var r,n;"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&/Trident/.test(navigator.userAgent)?t.plugins.excludeIE?e(t.EXCLUDED):e((r=t,n=[],Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window?n=s(["AcroPDF.PDF","Adodb.Stream","AgControl.AgControl","DevalVRXCtrl.DevalVRXCtrl.1","MacromediaFlashPaper.MacromediaFlashPaper","Msxml2.DOMDocument","Msxml2.XMLHTTP","PDF.PdfCtrl","QuickTime.QuickTime","QuickTimeCheckObject.QuickTimeCheck.1","RealPlayer","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","Scripting.Dictionary","SWCtl.SWCtl","Shell.UIHelper","ShockwaveFlash.ShockwaveFlash","Skype.Detection","TDCCtl.TDCCtl","WMPlayer.OCX","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1"],function(e){try{return new window.ActiveXObject(e),e}catch(e){return r.ERROR}}):n.push(r.NOT_AVAILABLE),n=navigator.plugins?n.concat(i(r)):n)):e(i(t))}},{key:"canvas",getData:function(e,t){var r,n,i,a;o()?e((r=t,n=[],(i=document.createElement("canvas")).width=2e3,i.height=200,i.style.display="inline",(a=i.getContext("2d")).rect(0,0,10,10),a.rect(2,2,6,6),n.push("canvas winding:"+(!1===a.isPointInPath(5,5,"evenodd")?"yes":"no")),a.textBaseline="alphabetic",a.fillStyle="#f60",a.fillRect(125,1,62,20),a.fillStyle="#069",r.dontUseFakeFontInCanvas?a.font="11pt Arial":a.font="11pt no-real-font-123",a.fillText("Cwm fjordbank glyphs vext quiz, 😃",2,15),a.fillStyle="rgba(102, 204, 0, 0.2)",a.font="18pt Arial",a.fillText("Cwm fjordbank glyphs vext quiz, 😃",4,45),a.globalCompositeOperation="multiply",a.fillStyle="rgb(255,0,255)",a.beginPath(),a.arc(50,50,50,0,2*Math.PI,!0),a.closePath(),a.fill(),a.fillStyle="rgb(0,255,255)",a.beginPath(),a.arc(100,50,50,0,2*Math.PI,!0),a.closePath(),a.fill(),a.fillStyle="rgb(255,255,0)",a.beginPath(),a.arc(75,100,50,0,2*Math.PI,!0),a.closePath(),a.fill(),a.fillStyle="rgb(255,0,255)",a.arc(75,75,75,0,2*Math.PI,!0),a.arc(75,75,25,0,2*Math.PI,!0),a.fill("evenodd"),i.toDataURL&&n.push("canvas fp:"+i.toDataURL()),n)):e(t.NOT_AVAILABLE)}},{key:"webgl",getData:function(e,t){a()?e(r()):e(t.NOT_AVAILABLE)}},{key:"webglVendorAndRenderer",getData:function(e){a()?e(function(){try{var e=c(),t=e.getExtension("WEBGL_debug_renderer_info");return e.getParameter(t.UNMASKED_VENDOR_WEBGL)+"~"+e.getParameter(t.UNMASKED_RENDERER_WEBGL)}catch(e){return null}}()):e()}},{key:"adBlock",getData:function(e){e(function(){var e=document.createElement("div"),t=(e.innerHTML="&nbsp;",!(e.className="adsbox"));try{document.body.appendChild(e),t=0===document.getElementsByClassName("adsbox")[0].offsetHeight,document.body.removeChild(e)}catch(e){t=!1}return t}())}},{key:"hasLiedLanguages",getData:function(e){e(function(){if(void 0!==navigator.languages)try{if(navigator.languages[0].substr(0,2)!==navigator.language.substr(0,2))return!0}catch(e){return!0}return!1}())}},{key:"hasLiedResolution",getData:function(e){e(window.screen.width<window.screen.availWidth||window.screen.height<window.screen.availHeight)}},{key:"hasLiedOs",getData:function(e){e(function(){var e=navigator.userAgent.toLowerCase(),t=navigator.oscpu,r=navigator.platform.toLowerCase(),e=0<=e.indexOf("windows phone")?"Windows Phone":0<=e.indexOf("win")?"Windows":0<=e.indexOf("android")?"Android":0<=e.indexOf("linux")?"Linux":0<=e.indexOf("iphone")||0<=e.indexOf("ipad")?"iOS":0<=e.indexOf("mac")?"Mac":"Other";if(("ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints)&&"Windows Phone"!=e&&"Android"!=e&&"iOS"!=e&&"Other"!=e)return!0;if(void 0!==t){if(0<=(t=t.toLowerCase()).indexOf("win")&&"Windows"!=e&&"Windows Phone"!=e)return!0;if(0<=t.indexOf("linux")&&"Linux"!=e&&"Android"!=e)return!0;if(0<=t.indexOf("mac")&&"Mac"!=e&&"iOS"!=e)return!0;if((-1===t.indexOf("win")&&-1===t.indexOf("linux")&&-1===t.indexOf("mac"))!=("Other"==e))return!0}return 0<=r.indexOf("win")&&"Windows"!=e&&"Windows Phone"!=e||(0<=r.indexOf("linux")||0<=r.indexOf("android")||0<=r.indexOf("pike"))&&"Linux"!=e&&"Android"!=e||(0<=r.indexOf("mac")||0<=r.indexOf("ipad")||0<=r.indexOf("ipod")||0<=r.indexOf("iphone"))&&"Mac"!=e&&"iOS"!=e||(-1===r.indexOf("win")&&-1===r.indexOf("linux")&&-1===r.indexOf("mac"))!=("Other"==e)||void 0===navigator.plugins&&"Windows"!=e&&"Windows Phone"!=e}())}},{key:"hasLiedBrowser",getData:function(e){e(function(){var e,t=navigator.userAgent.toLowerCase(),r=navigator.productSub;if(("Chrome"==(e=0<=t.indexOf("firefox")?"Firefox":0<=t.indexOf("opera")||0<=t.indexOf("opr")?"Opera":0<=t.indexOf("chrome")?"Chrome":0<=t.indexOf("safari")?"Safari":0<=t.indexOf("trident")?"Internet Explorer":"Other")||"Safari"==e||"Opera"==e)&&"20030107"!==r)return!0;var n,t=eval.toString().length;if(37===t&&"Safari"!=e&&"Firefox"!=e&&"Other"!=e)return!0;if(39===t&&"Internet Explorer"!=e&&"Other"!=e)return!0;if(33===t&&"Chrome"!=e&&"Opera"!=e&&"Other"!=e)return!0;try{throw"a"}catch(e){try{e.toSource(),n=!0}catch(e){n=!1}}return n&&"Firefox"!=e&&"Other"!=e}())}},{key:"touchSupport",getData:function(e){e(function(){var e,t=0;void 0!==navigator.maxTouchPoints?t=navigator.maxTouchPoints:void 0!==navigator.msMaxTouchPoints&&(t=navigator.msMaxTouchPoints);try{document.createEvent("TouchEvent"),e=!0}catch(t){e=!1}return[t,e,"ontouchstart"in window]}())}},{key:"fonts",getData:function(o,e){var u=["monospace","sans-serif","serif"],d=["Andale Mono","Arial","Arial Black","Arial Hebrew","Arial MT","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Bitstream Vera Sans Mono","Book Antiqua","Bookman Old Style","Calibri","Cambria","Cambria Math","Century","Century Gothic","Century Schoolbook","Comic Sans","Comic Sans MS","Consolas","Courier","Courier New","Geneva","Georgia","Helvetica","Helvetica Neue","Impact","Lucida Bright","Lucida Calligraphy","Lucida Console","Lucida Fax","LUCIDA GRANDE","Lucida Handwriting","Lucida Sans","Lucida Sans Typewriter","Lucida Sans Unicode","Microsoft Sans Serif","Monaco","Monotype Corsiva","MS Gothic","MS Outlook","MS PGothic","MS Reference Sans Serif","MS Sans Serif","MS Serif","MYRIAD","MYRIAD PRO","Palatino","Palatino Linotype","Segoe Print","Segoe Script","Segoe UI","Segoe UI Light","Segoe UI Semibold","Segoe UI Symbol","Tahoma","Times","Times New Roman","Times New Roman PS","Trebuchet MS","Verdana","Wingdings","Wingdings 2","Wingdings 3"],e=(d=(d=(d=e.fonts.extendedJsFonts?d.concat(["Abadi MT Condensed Light","Academy Engraved LET","ADOBE CASLON PRO","Adobe Garamond","ADOBE GARAMOND PRO","Agency FB","Aharoni","Albertus Extra Bold","Albertus Medium","Algerian","Amazone BT","American Typewriter","American Typewriter Condensed","AmerType Md BT","Andalus","Angsana New","AngsanaUPC","Antique Olive","Aparajita","Apple Chancery","Apple Color Emoji","Apple SD Gothic Neo","Arabic Typesetting","ARCHER","ARNO PRO","Arrus BT","Aurora Cn BT","AvantGarde Bk BT","AvantGarde Md BT","AVENIR","Ayuthaya","Bandy","Bangla Sangam MN","Bank Gothic","BankGothic Md BT","Baskerville","Baskerville Old Face","Batang","BatangChe","Bauer Bodoni","Bauhaus 93","Bazooka","Bell MT","Bembo","Benguiat Bk BT","Berlin Sans FB","Berlin Sans FB Demi","Bernard MT Condensed","BernhardFashion BT","BernhardMod BT","Big Caslon","BinnerD","Blackadder ITC","BlairMdITC TT","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bodoni MT","Bodoni MT Black","Bodoni MT Condensed","Bodoni MT Poster Compressed","Bookshelf Symbol 7","Boulder","Bradley Hand","Bradley Hand ITC","Bremen Bd BT","Britannic Bold","Broadway","Browallia New","BrowalliaUPC","Brush Script MT","Californian FB","Calisto MT","Calligrapher","Candara","CaslonOpnface BT","Castellar","Centaur","Cezanne","CG Omega","CG Times","Chalkboard","Chalkboard SE","Chalkduster","Charlesworth","Charter Bd BT","Charter BT","Chaucer","ChelthmITC Bk BT","Chiller","Clarendon","Clarendon Condensed","CloisterBlack BT","Cochin","Colonna MT","Constantia","Cooper Black","Copperplate","Copperplate Gothic","Copperplate Gothic Bold","Copperplate Gothic Light","CopperplGoth Bd BT","Corbel","Cordia New","CordiaUPC","Cornerstone","Coronet","Cuckoo","Curlz MT","DaunPenh","Dauphin","David","DB LCD Temp","DELICIOUS","Denmark","DFKai-SB","Didot","DilleniaUPC","DIN","DokChampa","Dotum","DotumChe","Ebrima","Edwardian Script ITC","Elephant","English 111 Vivace BT","Engravers MT","EngraversGothic BT","Eras Bold ITC","Eras Demi ITC","Eras Light ITC","Eras Medium ITC","EucrosiaUPC","Euphemia","Euphemia UCAS","EUROSTILE","Exotc350 Bd BT","FangSong","Felix Titling","Fixedsys","FONTIN","Footlight MT Light","Forte","FrankRuehl","Fransiscan","Freefrm721 Blk BT","FreesiaUPC","Freestyle Script","French Script MT","FrnkGothITC Bk BT","Fruitger","FRUTIGER","Futura","Futura Bk BT","Futura Lt BT","Futura Md BT","Futura ZBlk BT","FuturaBlack BT","Gabriola","Galliard BT","Gautami","Geeza Pro","Geometr231 BT","Geometr231 Hv BT","Geometr231 Lt BT","GeoSlab 703 Lt BT","GeoSlab 703 XBd BT","Gigi","Gill Sans","Gill Sans MT","Gill Sans MT Condensed","Gill Sans MT Ext Condensed Bold","Gill Sans Ultra Bold","Gill Sans Ultra Bold Condensed","Gisha","Gloucester MT Extra Condensed","GOTHAM","GOTHAM BOLD","Goudy Old Style","Goudy Stout","GoudyHandtooled BT","GoudyOLSt BT","Gujarati Sangam MN","Gulim","GulimChe","Gungsuh","GungsuhChe","Gurmukhi MN","Haettenschweiler","Harlow Solid Italic","Harrington","Heather","Heiti SC","Heiti TC","HELV","Herald","High Tower Text","Hiragino Kaku Gothic ProN","Hiragino Mincho ProN","Hoefler Text","Humanst 521 Cn BT","Humanst521 BT","Humanst521 Lt BT","Imprint MT Shadow","Incised901 Bd BT","Incised901 BT","Incised901 Lt BT","INCONSOLATA","Informal Roman","Informal011 BT","INTERSTATE","IrisUPC","Iskoola Pota","JasmineUPC","Jazz LET","Jenson","Jester","Jokerman","Juice ITC","Kabel Bk BT","Kabel Ult BT","Kailasa","KaiTi","Kalinga","Kannada Sangam MN","Kartika","Kaufmann Bd BT","Kaufmann BT","Khmer UI","KodchiangUPC","Kokila","Korinna BT","Kristen ITC","Krungthep","Kunstler Script","Lao UI","Latha","Leelawadee","Letter Gothic","Levenim MT","LilyUPC","Lithograph","Lithograph Light","Long Island","Lydian BT","Magneto","Maiandra GD","Malayalam Sangam MN","Malgun Gothic","Mangal","Marigold","Marion","Marker Felt","Market","Marlett","Matisse ITC","Matura MT Script Capitals","Meiryo","Meiryo UI","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Tai Le","Microsoft Uighur","Microsoft YaHei","Microsoft Yi Baiti","MingLiU","MingLiU_HKSCS","MingLiU_HKSCS-ExtB","MingLiU-ExtB","Minion","Minion Pro","Miriam","Miriam Fixed","Mistral","Modern","Modern No. 20","Mona Lisa Solid ITC TT","Mongolian Baiti","MONO","MoolBoran","Mrs Eaves","MS LineDraw","MS Mincho","MS PMincho","MS Reference Specialty","MS UI Gothic","MT Extra","MUSEO","MV Boli","Nadeem","Narkisim","NEVIS","News Gothic","News GothicMT","NewsGoth BT","Niagara Engraved","Niagara Solid","Noteworthy","NSimSun","Nyala","OCR A Extended","Old Century","Old English Text MT","Onyx","Onyx BT","OPTIMA","Oriya Sangam MN","OSAKA","OzHandicraft BT","Palace Script MT","Papyrus","Parchment","Party LET","Pegasus","Perpetua","Perpetua Titling MT","PetitaBold","Pickwick","Plantagenet Cherokee","Playbill","PMingLiU","PMingLiU-ExtB","Poor Richard","Poster","PosterBodoni BT","PRINCETOWN LET","Pristina","PTBarnum BT","Pythagoras","Raavi","Rage Italic","Ravie","Ribbon131 Bd BT","Rockwell","Rockwell Condensed","Rockwell Extra Bold","Rod","Roman","Sakkal Majalla","Santa Fe LET","Savoye LET","Sceptre","Script","Script MT Bold","SCRIPTINA","Serifa","Serifa BT","Serifa Th BT","ShelleyVolante BT","Sherwood","Shonar Bangla","Showcard Gothic","Shruti","Signboard","SILKSCREEN","SimHei","Simplified Arabic","Simplified Arabic Fixed","SimSun","SimSun-ExtB","Sinhala Sangam MN","Sketch Rockwell","Skia","Small Fonts","Snap ITC","Snell Roundhand","Socket","Souvenir Lt BT","Staccato222 BT","Steamer","Stencil","Storybook","Styllo","Subway","Swis721 BlkEx BT","Swiss911 XCm BT","Sylfaen","Synchro LET","System","Tamil Sangam MN","Technical","Teletype","Telugu Sangam MN","Tempus Sans ITC","Terminal","Thonburi","Traditional Arabic","Trajan","TRAJAN PRO","Tristan","Tubular","Tunga","Tw Cen MT","Tw Cen MT Condensed","Tw Cen MT Condensed Extra Bold","TypoUpright BT","Unicorn","Univers","Univers CE 55 Medium","Univers Condensed","Utsaah","Vagabond","Vani","Vijaya","Viner Hand ITC","VisualUI","Vivaldi","Vladimir Script","Vrinda","Westminster","WHITNEY","Wide Latin","ZapfEllipt BT","ZapfHumnst BT","ZapfHumnst Dm BT","Zapfino","Zurich BlkEx BT","Zurich Ex BT","ZWAdobeF"]):d).concat(e.fonts.userDefinedFonts)).filter(function(e,t){return d.indexOf(e)===t}),document.getElementsByTagName("body")[0]),i=document.createElement("div"),l=document.createElement("div"),n={},a={},h=function(){var e=document.createElement("span");return e.style.position="absolute",e.style.left="-9999px",e.style.fontSize="72px",e.style.fontStyle="normal",e.style.fontWeight="normal",e.style.letterSpacing="normal",e.style.lineBreak="auto",e.style.lineHeight="normal",e.style.textTransform="none",e.style.textAlign="left",e.style.textDecoration="none",e.style.textShadow="none",e.style.whiteSpace="normal",e.style.wordBreak="normal",e.style.wordSpacing="normal",e.innerHTML="mmmmmmmmmmlli",e},s=function(){for(var e=[],t=0,r=u.length;t<r;t++){var n=h();n.style.fontFamily=u[t],i.appendChild(n),e.push(n)}return e}();e.appendChild(i);for(var t=0,c=u.length;t<c;t++)n[u[t]]=s[t].offsetWidth,a[u[t]]=s[t].offsetHeight;var f=function(){for(var e,t,r={},n=0,i=d.length;n<i;n++){for(var a=[],o=0,s=u.length;o<s;o++){c=d[n],e=u[o],t=void 0,(t=h()).style.fontFamily="'"+c+"',"+e;var c=t;l.appendChild(c),a.push(c)}r[d[n]]=a}return r}();e.appendChild(l);for(var p=[],r=0,m=d.length;r<m;r++)!function(e){for(var t=!1,r=0;r<u.length;r++)if(t=e[r].offsetWidth!==n[u[r]]||e[r].offsetHeight!==a[u[r]])return t;return t}(f[d[r]])||p.push(d[r]);e.removeChild(l),e.removeChild(i),o(p)},pauseBefore:!0},{key:"fontsFlash",getData:function(t,e){{if(void 0===window.swfobject)return t("swf object not loaded");if(!window.swfobject.hasFlashPlayerVersion("9.0.0"))return t("flash not installed");if(!e.fonts.swfPath)return t("missing options.fonts.swfPath");var r=function(e){t(e)};window.___fp_swf_loaded=function(e){r(e)};var n,i=e.fonts.swfContainerId;(n=document.createElement("div")).setAttribute("id",(void 0).fonts.swfContainerId),document.body.appendChild(n),window.swfobject.embedSWF(e.fonts.swfPath,i,"1","1","9.0.0",!1,{onReady:"___fp_swf_loaded"},{allowScriptAccess:"always",menu:"false"},{})}},pauseBefore:!0},{key:"audio",getData:function(r,e){var t=e.audio;if(t.excludeIOS11&&navigator.userAgent.match(/OS 11.+Version\/11.+Safari/))return r(e.EXCLUDED);var n=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(null==n)return r(e.NOT_AVAILABLE);var i=new n(1,44100,44100),a=i.createOscillator(),o=(a.type="triangle",a.frequency.setValueAtTime(1e4,i.currentTime),i.createDynamicsCompressor()),s=(u([["threshold",-50],["knee",40],["ratio",12],["reduction",-20],["attack",0],["release",.25]],function(e){void 0!==o[e[0]]&&"function"==typeof o[e[0]].setValueAtTime&&o[e[0]].setValueAtTime(e[1],i.currentTime)}),a.connect(o),o.connect(i.destination),a.start(0),i.startRendering(),setTimeout(function(){return console.warn('Audio fingerprint timed out. Please report bug at https://github.com/Valve/fingerprintjs2 with your user agent: "'+navigator.userAgent+'".'),i.oncomplete=function(){},i=null,r("audioTimeout")},t.timeout));i.oncomplete=function(e){var t;try{clearTimeout(s),t=e.renderedBuffer.getChannelData(0).slice(4500,5e3).reduce(function(e,t){return e+Math.abs(t)},0).toString(),a.disconnect(),o.disconnect()}catch(e){return void r(e)}r(t)}}},{key:"enumerateDevices",getData:function(t,e){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return t(e.NOT_AVAILABLE);navigator.mediaDevices.enumerateDevices().then(function(e){t(e.map(function(e){return"id="+e.deviceId+";gid="+e.groupId+";"+e.kind+";"+e.label}))}).catch(function(e){t(e)})}}];return n.get=function(r,n){(function(e,t){if(null==t)return;var r,n;for(n in t)null==(r=t[n])||Object.prototype.hasOwnProperty.call(e,n)||(e[n]=r)})(r=n?r||{}:(n=r,{}),e),r.components=r.extraComponents.concat(t);var i={data:[],addPreprocessedComponent:function(e,t){"function"==typeof r.preprocessor&&(t=r.preprocessor(e,t)),i.data.push({key:e,value:t})}},a=-1,o=function(e){if((a+=1)>=r.components.length)n(i.data);else{var t=r.components[a];if(r.excludes[t.key])o(!1);else{if(!e&&t.pauseBefore)return--a,void setTimeout(function(){o(!0)},1);try{t.getData(function(e){i.addPreprocessedComponent(t.key,e),o(!1)},r)}catch(e){i.addPreprocessedComponent(t.key,String(e)),o(!1)}}}};o(!1)},n.getPromise=function(r){return new Promise(function(e,t){n.get(r,e)})},n.getV18=function(a,o){return null==o&&(o=a,a={}),n.get(a,function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];n.value===(a.NOT_AVAILABLE||"not available")?t.push({key:n.key,value:"unknown"}):"plugins"===n.key?t.push({key:"plugins",value:s(n.value,function(e){var t=s(e[2],function(e){return e.join?e.join("~"):e}).join(",");return[e[0],e[1],t].join("::")})}):-1!==["canvas","webgl"].indexOf(n.key)?t.push({key:n.key,value:n.value.join("~")}):-1!==["sessionStorage","localStorage","indexedDb","addBehavior","openDatabase"].indexOf(n.key)?n.value&&t.push({key:n.key,value:1}):n.value?t.push(n.value.join?{key:n.key,value:n.value.join(";")}:n):t.push({key:n.key,value:n.value})}var i=d(s(t,function(e){return e.value}).join("~~~"),31);o(i,t)})},n.x64hash128=d,n.VERSION="2.0.0",n};e.exports?e.exports=r():t.exports?t.exports=r():t.Fingerprint2=r()}),oe=K(function(e,t){e.exports=function r(n,i,a){function o(t,e){if(!i[t]){if(!n[t]){if(!e&&X)return X();if(s)return s(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e=i[t]={exports:{}};n[t][0].call(e.exports,function(e){return o(n[t][1][e]||e)},e,e.exports,r,n,i,a)}return i[t].exports}for(var s=X,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,u,t){!function(t){var n,e,r,i,a=t.MutationObserver||t.WebKitMutationObserver,o=a?(e=0,a=new a(c),r=t.document.createTextNode(""),a.observe(r,{characterData:!0}),function(){r.data=e=++e%2}):t.setImmediate||void 0===t.MessageChannel?"document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)}:((i=new t.MessageChannel).port1.onmessage=c,function(){i.port2.postMessage(0)}),s=[];function c(){var e,t;n=!0;for(var r=s.length;r;){for(t=s,s=[],e=-1;++e<r;)t[e]();r=s.length}n=!1}u.exports=function(e){1!==s.push(e)||n||o()}}.call(this,$e)},{}],2:[function(t,r,h){var f=t(1);function c(){}var u={},i=["REJECTED"],a=["FULFILLED"],n=["PENDING"];function e(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=n,this.queue=[],this.outcome=void 0,e!==c&&d(this,e)}function o(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function s(t,r,n){f(function(){var e;try{e=r(n)}catch(e){return u.reject(t,e)}e===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,e)})}function p(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(t,e){var r=!1;function n(e){r||(r=!0,u.reject(t,e))}function i(e){r||(r=!0,u.resolve(t,e))}var a=l(function(){e(i,n)});"error"===a.status&&n(a.value)}function l(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}(r.exports=e).prototype.catch=function(e){return this.then(null,e)},e.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===i)return this;var r=new this.constructor(c);return this.state!==n?s(r,this.state===a?e:t,this.outcome):this.queue.push(new o(r,e,t)),r},o.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){u.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},u.resolve=function(e,t){var r=l(p,t);if("error"===r.status)return u.reject(e,r.value);r=r.value;if(r)d(e,r);else{e.state=a,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callFulfilled(t)}return e},u.reject=function(e,t){e.state=i,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},e.resolve=function(e){return e instanceof this?e:u.resolve(new this(c),e)},e.reject=function(e){var t=new this(c);return u.reject(t,e)},e.all=function(e){var r=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var a=new Array(n),o=0,t=-1,s=new this(c);++t<n;)!function(e,t){r.resolve(e).then(function(e){a[t]=e,++o!==n||i||(i=!0,u.resolve(s,a))},function(e){i||(i=!0,u.reject(s,e))})}(e[t],t);return s},e.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,r=!1;if(!t)return this.resolve([]);for(var n,i=-1,a=new this(c);++i<t;)n=e[i],this.resolve(n).then(function(e){r||(r=!0,u.resolve(a,e))},function(e){r||(r=!0,u.reject(a,e))});return a}},{1:1}],3:[function(t,e,r){!function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}.call(this,$e)},{2:2}],4:[function(e,t,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function g(t,r){t=t||[],r=r||{};try{return new Blob(t,r)}catch(e){if("TypeError"!==e.name)throw e;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<t.length;i+=1)n.append(t[i]);return n.getBlob(r.type)}}"undefined"==typeof Promise&&e(3);var f=Promise;function p(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function i(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function c(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var v="local-forage-detect-blob-support",y=void 0,d={},b=Object.prototype.toString,k="readonly",_="readwrite";function w(e){var e=d[e.name],r={};r.promise=new f(function(e,t){r.resolve=e,r.reject=t}),e.deferredOperations.push(r),e.dbReady?e.dbReady=e.dbReady.then(function(){return r.promise}):e.dbReady=r.promise}function S(e){e=d[e.name].deferredOperations.pop();return e&&(e.resolve(),e.promise)}function T(e,t){e=d[e.name].deferredOperations.pop();if(e)return e.reject(t),e.promise}function C(i,a){return new f(function(e,t){if(d[i.name]=d[i.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},i.db){if(!a)return e(i.db);w(i),i.db.close()}var r=[i.name],n=(a&&r.push(i.version),s.open.apply(s,r));a&&(n.onupgradeneeded=function(e){var t=n.result;try{t.createObjectStore(i.storeName),e.oldVersion<=1&&t.createObjectStore(v)}catch(t){if("ConstraintError"!==t.name)throw t;console.warn('The database "'+i.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+i.storeName+'" already exists.')}}),n.onerror=function(e){e.preventDefault(),t(n.error)},n.onsuccess=function(){e(n.result),S(i)}})}function R(e){return C(e,!1)}function E(e){return C(e,!0)}function I(e,t){if(!e.db)return 1;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;return n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(i||r)&&(!r||(n=e.db.version+1)>e.version&&(e.version=n),1)}function P(e){return g([function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}(atob(e.data))],{type:e.type})}function A(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,r=t._initReady().then(function(){var e=d[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return i(r,e,e),r}function u(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(0<n&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return f.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),E(e)}).then(function(){return function(r){w(r);for(var n=d[r.name],i=n.forages,e=0;e<i.length;e++){var t=i[e];t._dbInfo.db&&(t._dbInfo.db.close(),t._dbInfo.db=null)}return r.db=null,R(r).then(function(e){return r.db=e,I(r)?E(r):e}).then(function(e){r.db=n.db=e;for(var t=0;t<i.length;t++)i[t]._dbInfo.db=e}).catch(function(e){throw T(r,e),e})}(e).then(function(){u(e,t,r,n-1)})}).catch(r);r(i)}}var e={_driver:"asyncStorage",_initStorage:function(e){var n=this,i={db:null};if(e)for(var t in e)i[t]=e[t];var a=d[i.name],r=(a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},d[i.name]=a),a.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=M),[]);function o(){return f.resolve()}for(var s=0;s<a.forages.length;s++){var c=a.forages[s];c!==n&&r.push(c._initReady().catch(o))}var u=a.forages.slice(0);return f.all(r).then(function(){return i.db=a.db,R(i)}).then(function(e){return i.db=e,I(i,n._defaultConfig.version)?E(i):e}).then(function(e){i.db=a.db=e,n._dbInfo=i;for(var t=0;t<u.length;t++){var r=u[t];r!==n&&(r._dbInfo.db=i.db,r._dbInfo.version=i.version)}})},_support:function(){try{if(!s)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(o,e){var s=this,t=new f(function(i,a){s.ready().then(function(){u(s._dbInfo,k,function(e,t){if(e)return a(e);try{var r=t.objectStore(s._dbInfo.storeName).openCursor(),n=1;r.onsuccess=function(){var e,t=r.result;t?(A(e=t.value)&&(e=P(e)),void 0!==(e=o(e,t.key,n++))?i(e):t.continue()):i()},r.onerror=function(){a(r.error)}}catch(e){a(e)}})}).catch(a)});return p(t,e),t},getItem:function(a,e){var o=this,t=(a=l(a),new f(function(n,i){o.ready().then(function(){u(o._dbInfo,k,function(e,t){if(e)return i(e);try{var r=t.objectStore(o._dbInfo.storeName).get(a);r.onsuccess=function(){var e=r.result;A(e=void 0===e?null:e)&&(e=P(e)),n(e)},r.onerror=function(){i(r.error)}}catch(e){i(e)}})}).catch(i)}));return p(t,e),t},setItem:function(s,r,e){var c=this,t=(s=l(s),new f(function(a,o){var t;c.ready().then(function(){return t=c._dbInfo,"[object Blob]"===b.call(r)?(e=t.db,("boolean"==typeof y?f.resolve(y):(n=e,new f(function(r){var e=n.transaction(v,_),t=g([""]);e.objectStore(v).put(t,"key"),e.onabort=function(e){e.preventDefault(),e.stopPropagation(),r(!1)},e.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);r(t||!e||43<=parseInt(e[1],10))}}).catch(function(){return!1}).then(function(e){return y=e}))).then(function(e){return e?r:(n=r,new f(function(t,e){var r=new FileReader;r.onerror=e,r.onloadend=function(e){e=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:e,type:n.type})},r.readAsBinaryString(n)}));var n})):r;var e,n}).then(function(i){u(c._dbInfo,_,function(e,t){if(e)return o(e);try{var r=t.objectStore(c._dbInfo.storeName),n=(null===i&&(i=void 0),r.put(i,s));t.oncomplete=function(){a(i=void 0===i?null:i)},t.onabort=t.onerror=function(){var e=n.error||n.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)}));return p(t,e),t},removeItem:function(a,e){var o=this,t=(a=l(a),new f(function(n,i){o.ready().then(function(){u(o._dbInfo,_,function(e,t){if(e)return i(e);try{var r=t.objectStore(o._dbInfo.storeName).delete(a);t.oncomplete=function(){n()},t.onerror=function(){i(r.error)},t.onabort=function(){var e=r.error||r.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)}));return p(t,e),t},clear:function(e){var a=this,t=new f(function(n,i){a.ready().then(function(){u(a._dbInfo,_,function(e,t){if(e)return i(e);try{var r=t.objectStore(a._dbInfo.storeName).clear();t.oncomplete=function(){n()},t.onabort=t.onerror=function(){var e=r.error||r.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return p(t,e),t},length:function(e){var a=this,t=new f(function(n,i){a.ready().then(function(){u(a._dbInfo,k,function(e,t){if(e)return i(e);try{var r=t.objectStore(a._dbInfo.storeName).count();r.onsuccess=function(){n(r.result)},r.onerror=function(){i(r.error)}}catch(e){i(e)}})}).catch(i)});return p(t,e),t},key:function(s,e){var c=this,t=new f(function(a,o){s<0?a(null):c.ready().then(function(){u(c._dbInfo,k,function(e,t){if(e)return o(e);try{var r=t.objectStore(c._dbInfo.storeName),n=!1,i=r.openCursor();i.onsuccess=function(){var e=i.result;e?0===s||n?a(e.key):(n=!0,e.advance(s)):a(null)},i.onerror=function(){o(i.error)}}catch(e){o(e)}})}).catch(o)});return p(t,e),t},keys:function(e){var o=this,t=new f(function(i,a){o.ready().then(function(){u(o._dbInfo,k,function(e,t){if(e)return a(e);try{var r=t.objectStore(o._dbInfo.storeName).openCursor(),n=[];r.onsuccess=function(){var e=r.result;e?(n.push(e.key),e.continue()):i(n)},r.onerror=function(){a(r.error)}}catch(e){a(e)}})}).catch(a)});return p(t,e),t},dropInstance:function(o,e){e=c.apply(this,arguments);var t=this.config();return(o="function"!=typeof o&&o||{}).name||(o.name=o.name||t.name,o.storeName=o.storeName||t.storeName),p(t=o.name?(t=o.name===t.name&&this._dbInfo.db?f.resolve(this._dbInfo.db):R(o).then(function(e){var t=d[o.name],r=t.forages;t.db=e;for(var n=0;n<r.length;n++)r[n]._dbInfo.db=e;return e}),o.storeName?t.then(function(e){if(e.objectStoreNames.contains(o.storeName)){var i=e.version+1,n=(w(o),d[o.name]),a=n.forages;e.close();for(var t=0;t<a.length;t++){var r=a[t];r._dbInfo.db=null,r._dbInfo.version=i}return new f(function(t,r){var n=s.open(o.name,i);n.onerror=function(e){n.result.close(),r(e)},n.onupgradeneeded=function(){n.result.deleteObjectStore(o.storeName)},n.onsuccess=function(){var e=n.result;e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<a.length;t++){var r=a[t];r._dbInfo.db=e,S(r._dbInfo)}}).catch(function(e){throw(T(o,e)||f.resolve()).catch(function(){}),e})}}):t.then(function(e){w(o);var r=d[o.name],n=r.forages;e.close();for(var t=0;t<n.length;t++)n[t]._dbInfo.db=null;return new f(function(t,r){var n=s.deleteDatabase(o.name);n.onerror=n.onblocked=function(e){var t=n.result;t&&t.close(),r(e)},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<n.length;t++)S(n[t]._dbInfo)}).catch(function(e){throw(T(o,e)||f.resolve()).catch(function(){}),e})})):f.reject("Invalid arguments"),e),t}},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=/^~~local_forage_type~([^~]+)~/,x="__lfsc__:",O=x.length,L="arbf",j="blob",N=O+L.length,B=Object.prototype.toString;function F(e){for(var t,r,n,i,a=.75*e.length,o=e.length,s=0,a=("="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--),new ArrayBuffer(a)),c=new Uint8Array(a),u=0;u<o;u+=4)t=h.indexOf(e[u]),r=h.indexOf(e[u+1]),n=h.indexOf(e[u+2]),i=h.indexOf(e[u+3]),c[s++]=t<<2|r>>4,c[s++]=(15&r)<<4|n>>2,c[s++]=(3&n)<<6|63&i;return a}function U(e){for(var t=new Uint8Array(e),r="",n=0;n<t.length;n+=3)r=(r=(r=(r+=h[t[n]>>2])+h[(3&t[n])<<4|t[n+1]>>4])+h[(15&t[n+1])<<2|t[n+2]>>6])+h[63&t[n+2]];return t.length%3==2?r=r.substring(0,r.length-1)+"=":t.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var V={serialize:function(t,r){var e="";if(t&&(e=B.call(t)),t&&("[object ArrayBuffer]"===e||t.buffer&&"[object ArrayBuffer]"===B.call(t.buffer))){var n,i=x;t instanceof ArrayBuffer?(n=t,i+=L):(n=t.buffer,"[object Int8Array]"===e?i+="si08":"[object Uint8Array]"===e?i+="ui08":"[object Uint8ClampedArray]"===e?i+="uic8":"[object Int16Array]"===e?i+="si16":"[object Uint16Array]"===e?i+="ur16":"[object Int32Array]"===e?i+="si32":"[object Uint32Array]"===e?i+="ui32":"[object Float32Array]"===e?i+="fl32":"[object Float64Array]"===e?i+="fl64":r(new Error("Failed to get type for BinaryArray"))),r(i+U(n))}else if("[object Blob]"===e){i=new FileReader;i.onload=function(){var e="~~local_forage_type~"+t.type+"~"+U(this.result);r(x+j+e)},i.readAsArrayBuffer(t)}else try{r(JSON.stringify(t))}catch(e){console.error("Couldn't convert value into a JSON string: ",t),r(null,e)}},deserialize:function(e){if(e.substring(0,O)!==x)return JSON.parse(e);var t,r=e.substring(N),n=e.substring(O,N),i=(n===j&&D.test(r)&&(t=(e=r.match(D))[1],r=r.substring(e[0].length)),F(r));switch(n){case L:return i;case j:return g([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+n)}},stringToBuffer:F,bufferToString:U};function G(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function m(e,n,i,a,o,s){e.executeSql(i,a,o,function(e,r){r.code===r.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[n.storeName],function(e,t){t.rows.length?s(e,r):G(e,n,function(){e.executeSql(i,a,o,s)},s)},s):s(e,r)},s)}var W={_driver:"webSQLStorage",_initStorage:function(e){var n=this,i={db:null};if(e)for(var t in e)i[t]="string"!=typeof e[t]?e[t].toString():e[t];var r=new f(function(t,r){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return r(t)}i.db.transaction(function(e){G(e,i,function(){n._dbInfo=i,t()},function(e,t){r(t)})},r)});return i.serializer=V,r},_support:"function"==typeof openDatabase,iterate:function(u,e){var t=this,r=new f(function(c,r){t.ready().then(function(){var s=t._dbInfo;s.db.transaction(function(e){m(e,s,"SELECT * FROM "+s.storeName,[],function(e,t){for(var r=t.rows,n=r.length,i=0;i<n;i++){var a=r.item(i),o=(o=a.value)&&s.serializer.deserialize(o);if(void 0!==(o=u(o,a.key,i+1)))return void c(o)}c()},function(e,t){r(t)})})}).catch(r)});return p(r,e),r},getItem:function(t,e){var a=this,r=(t=l(t),new f(function(n,i){a.ready().then(function(){var r=a._dbInfo;r.db.transaction(function(e){m(e,r,"SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[t],function(e,t){t=(t=t.rows.length?t.rows.item(0).value:null)&&r.serializer.deserialize(t);n(t)},function(e,t){i(t)})})}).catch(i)}));return p(r,e),r},setItem:function(e,t,r){return function o(s,e,c,u){var d=this,t=(s=l(s),new f(function(i,a){d.ready().then(function(){var r=e=void 0===e?null:e,n=d._dbInfo;n.serializer.serialize(e,function(t,e){e?a(e):n.db.transaction(function(e){m(e,n,"INSERT OR REPLACE INTO "+n.storeName+" (key, value) VALUES (?, ?)",[s,t],function(){i(r)},function(e,t){a(t)})},function(e){e.code===e.QUOTA_ERR&&(0<u?i(o.apply(d,[s,r,c,u-1])):a(e))})})}).catch(a)}));return p(t,c),t}.apply(this,[e,t,r,1])},removeItem:function(i,e){var a=this,t=(i=l(i),new f(function(r,n){a.ready().then(function(){var t=a._dbInfo;t.db.transaction(function(e){m(e,t,"DELETE FROM "+t.storeName+" WHERE key = ?",[i],function(){r()},function(e,t){n(t)})})}).catch(n)}));return p(t,e),t},clear:function(e){var i=this,t=new f(function(r,n){i.ready().then(function(){var t=i._dbInfo;t.db.transaction(function(e){m(e,t,"DELETE FROM "+t.storeName,[],function(){r()},function(e,t){n(t)})})}).catch(n)});return p(t,e),t},length:function(e){var i=this,t=new f(function(r,n){i.ready().then(function(){var t=i._dbInfo;t.db.transaction(function(e){m(e,t,"SELECT COUNT(key) as c FROM "+t.storeName,[],function(e,t){t=t.rows.item(0).c;r(t)},function(e,t){n(t)})})}).catch(n)});return p(t,e),t},key:function(i,e){var a=this,t=new f(function(r,n){a.ready().then(function(){var t=a._dbInfo;t.db.transaction(function(e){m(e,t,"SELECT key FROM "+t.storeName+" WHERE id = ? LIMIT 1",[i+1],function(e,t){t=t.rows.length?t.rows.item(0).key:null;r(t)},function(e,t){n(t)})})}).catch(n)});return p(t,e),t},keys:function(e){var n=this,t=new f(function(i,r){n.ready().then(function(){var t=n._dbInfo;t.db.transaction(function(e){m(e,t,"SELECT key FROM "+t.storeName,[],function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).key);i(r)},function(e,t){r(t)})})}).catch(r)});return p(t,e),t},dropInstance:function(r,e){e=c.apply(this,arguments);var n=this.config();(r="function"!=typeof r&&r||{}).name||(r.name=r.name||n.name,r.storeName=r.storeName||n.storeName);var t,i=this;return p(t=r.name?new f(function(e){var a,t=r.name===n.name?i._dbInfo.db:openDatabase(r.name,"","",0);r.storeName?e({db:t,storeNames:[r.storeName]}):e((a=t,new f(function(i,r){a.transaction(function(e){e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,t){for(var r=[],n=0;n<t.rows.length;n++)r.push(t.rows.item(n).name);i({db:a,storeNames:r})},function(e,t){r(t)})},function(e){r(e)})})))}).then(function(o){return new f(function(i,a){o.db.transaction(function(n){for(var e=[],t=0,r=o.storeNames.length;t<r;t++)e.push(function(t){return new f(function(e,r){n.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(e,t){r(t)})})}(o.storeNames[t]));f.all(e).then(function(){i()}).catch(function(e){a(e)})},function(e){a(e)})})}):f.reject("Invalid arguments"),e),t}};function H(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}var z={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=H(e,this._defaultConfig),!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),0}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=V,f.resolve()):f.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(c,e){var u=this,t=u.ready().then(function(){for(var e=u._dbInfo,t=e.keyPrefix,r=t.length,n=localStorage.length,i=1,a=0;a<n;a++){var o=localStorage.key(a);if(0===o.indexOf(t)){var s=(s=localStorage.getItem(o))&&e.serializer.deserialize(s);if(void 0!==(s=c(s,o.substring(r),i++)))return s}}});return p(t,e),t},getItem:function(r,e){var n=this,t=(r=l(r),n.ready().then(function(){var e=n._dbInfo,t=localStorage.getItem(e.keyPrefix+r);return t=t&&e.serializer.deserialize(t)}));return p(t,e),t},setItem:function(o,e,t){var s=this,r=(o=l(o),s.ready().then(function(){var a=e=void 0===e?null:e;return new f(function(r,n){var i=s._dbInfo;i.serializer.serialize(e,function(e,t){if(t)n(t);else try{localStorage.setItem(i.keyPrefix+o,e),r(a)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||n(e),n(e)}})})}));return p(r,t),r},removeItem:function(t,e){var r=this,n=(t=l(t),r.ready().then(function(){var e=r._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return p(n,e),n},clear:function(e){var n=this,t=n.ready().then(function(){for(var e=n._dbInfo.keyPrefix,t=localStorage.length-1;0<=t;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}});return p(t,e),t},length:function(e){var t=this.keys().then(function(e){return e.length});return p(t,e),t},key:function(r,e){var n=this,t=n.ready().then(function(){var t,e=n._dbInfo;try{t=localStorage.key(r)}catch(e){t=null}return t=t&&t.substring(e.keyPrefix.length)});return p(t,e),t},keys:function(e){var a=this,t=a.ready().then(function(){for(var e=a._dbInfo,t=localStorage.length,r=[],n=0;n<t;n++){var i=localStorage.key(n);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r});return p(t,e),t},dropInstance:function(t,e){e=c.apply(this,arguments),(t="function"!=typeof t&&t||{}).name||(r=this.config(),t.name=t.name||r.name,t.storeName=t.storeName||r.storeName);var r,n=this;return p(r=t.name?new f(function(e){t.storeName?e(H(t,n._defaultConfig)):e(t.name+"/")}).then(function(e){for(var t=localStorage.length-1;0<=t;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}}):f.reject("Invalid arguments"),e),r}},J=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},q={},$={},a={INDEXEDDB:e,WEBSQL:W,LOCALSTORAGE:z},e=[a.INDEXEDDB._driver,a.WEBSQL._driver,a.LOCALSTORAGE._driver],X=["dropInstance"],K=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(X),Q={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Z(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];if(r)for(var n in r)r.hasOwnProperty(n)&&(J(r[n])?e[n]=r[n].slice():e[n]=r[n])}return e}o.prototype.config=function(e){if("object"!==(void 0===e?"undefined":n(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},o.prototype.defineDriver=function(h,e,t){var r=new f(function(t,r){try{var n=h._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!h._driver)return void r(e);for(var i=K.concat("_initStorage"),a=0,d=i.length;a<d;a++){var o=i[a];if((!function(e,t){for(var r,n,i=e.length,a=0;a<i;){if((r=e[a])===(n=t)||"number"==typeof r&&"number"==typeof n&&isNaN(r)&&isNaN(n))return!0;a++}return!1}(X,o)||h[o])&&"function"!=typeof h[o])return void r(e)}for(var s=0,l=X.length;s<l;s++){var c=X[s];h[c]||(h[c]=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),e=f.reject(e);return p(e,arguments[arguments.length-1]),e}}(c))}var u=function(e){q[n]&&console.info("Redefining LocalForage driver: "+n),q[n]=h,$[n]=e,t()};"_support"in h?h._support&&"function"==typeof h._support?h._support().then(u,r):u(!!h._support):u(!0)}catch(e){r(e)}});return i(r,e,t),r},o.prototype.driver=function(){return this._driver||null},o.prototype.getDriver=function(e,t,r){e=q[e]?f.resolve(q[e]):f.reject(new Error("Driver not found."));return i(e,t,r),e},o.prototype.getSerializer=function(e){var t=f.resolve(V);return i(t,e),t},o.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return i(r,e,e),r},o.prototype.setDriver=function(e,t,r){var a=this,n=(J(e)||(e=[e]),this._getSupportedDrivers(e));function o(){a._config.driver=a.driver()}function s(e){return a._extend(e),o(),a._ready=a._initStorage(a._config),a._ready}e=null!==this._driverSet?this._driverSet.catch(function(){return f.resolve()}):f.resolve();return this._driverSet=e.then(function(){var e=n[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){var i;a._driver=e._driver,o(),a._wrapLibraryMethodsWithReady(),a._initDriver=(i=n,function(){var n=0;return function e(){for(;n<i.length;){var t=i[n];return n++,a._dbInfo=null,a._ready=null,a.getDriver(t).then(s).catch(e)}o();var r=new Error("No available storage method found.");return a._driverSet=f.reject(r),a._driverSet}()})})}).catch(function(){o();var e=new Error("No available storage method found.");return a._driverSet=f.reject(e),a._driverSet}),i(this._driverSet,t,r),this._driverSet},o.prototype.supports=function(e){return!!$[e]},o.prototype._extend=function(e){Z(this,e)},o.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},o.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=K.length;e<t;e++)!function(t,r){t[r]=function(){var e=arguments;return t.ready().then(function(){return t[r].apply(t,e)})}}(this,K[e])},o.prototype.createInstance=function(e){return new o(e)};W=new o;function o(e){var t,r,n,i=this;if(!(i instanceof o))throw new TypeError("Cannot call a class as a function");for(t in a)a.hasOwnProperty(t)&&(n=(r=a[t])._driver,this[t]=n,q[n]||this.defineDriver(r));this._defaultConfig=Z({},Q),this._config=Z({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}t.exports=W},{3:3}]},{},[4])(4)}),se=K(function(e){var a=[],o=3988292384;function r(e){for(var t,r,n=-1,i=0,a=e.length;i<a;i+=1){for(r=255&(n^e[i]),t=0;t<8;t+=1)1==(1&r)?r=r>>>1^o:r>>>=1;n=n>>>8^r}return-1^n}function s(e,t){var r,n,i;if(void 0!==s.crc&&t&&e||(s.crc=-1,e)){for(r=s.crc,n=0,i=e.length;n<i;n+=1)r=r>>>8^a[255&(r^e[n])];return-1^(s.crc=r)}}for(var t,n,i=0;i<256;i+=1){for(t=i,n=0;n<8;n+=1)1&t?t=o^t>>>1:t>>>=1;a[i]=t>>>0}e.exports=function(e,t){return((t?r:s)(e="string"==typeof e?(t=e,Array.prototype.map.call(t,function(e){return e.charCodeAt(0)})):e)>>>0).toString(16)},e.exports.direct=r,e.exports.table=s}),ce=(se.direct,se.table,K(function(e){function P(){this.next=null,this.list=null}function A(){this.e=0,this.b=0,this.n=0,this.t=null}function y(d,l,h,f,p,m){var g;this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;for(var v,y,b,e,t,r,n,i,a,o,k,_,w,S,s=[],T=[],c=new A,C=[],R=[],E=[],I=this.root=null,u=0;u<this.BMAX+1;u++)s[u]=0;for(u=0;u<this.BMAX+1;u++)T[u]=0;for(u=0;u<this.BMAX;u++)C[u]=null;for(u=0;u<this.N_MAX;u++)R[u]=0;for(u=0;u<this.BMAX+1;u++)E[u]=0;for(v=256<l?d[256]:this.BMAX,n=d,i=0,u=l;s[n[i]]++,i++,0<--u;);if(s[0]===l)return this.root=null,this.m=0,void(this.status=0);for(t=1;t<=this.BMAX&&0===s[t];t++);for(m<(r=t)&&(m=t),u=this.BMAX;0!==u&&0===s[u];u--);for((b=u)<m&&(m=u),_=1<<t;t<u;t++,_<<=1)if((_-=s[t])<0)return this.status=2,void(this.m=m);if((_-=s[u])<0)return this.status=2,void(this.m=m);for(s[u]+=_,E[1]=t=0,n=s,i=1,k=2;0<--u;)E[k++]=t+=n[i++];for(n=d,u=i=0;0!==(t=n[i++])&&(R[E[t]++]=u),++u<l;);for(l=E[b],n=R,e=-1,a=null,w=o=T[i=E[0]=u=0]=0;r<=b;r++)for(g=s[r];0<g--;){for(;r>o+T[1+e];){if(o+=T[1+e],e++,w=(w=b-o)>m?m:w,(y=1<<(t=r-o))>g+1)for(y-=g+1,k=r;++t<w&&!((y<<=1)<=s[++k]);)y-=s[k];for(w=1<<(t=v<o+t&&o<v?v-o:t),T[1+e]=t,a=[],S=0;S<w;S++)a[S]=new A;(I=I?I.next=new P:this.root=new P).next=null,I.list=a,C[e]=a,0<e&&(E[e]=u,c.b=T[e],c.e=16+t,c.t=a,t=(u&(1<<o)-1)>>o-T[e],C[e-1][t].e=c.e,C[e-1][t].b=c.b,C[e-1][t].n=c.n,C[e-1][t].t=c.t)}for(c.b=r-o,l<=i?c.e=99:n[i]<h?(c.e=n[i]<256?16:15,c.n=n[i++]):(c.e=p[n[i]-h],c.n=f[n[i++]-h]),y=1<<r-o,t=u>>o;t<w;t+=y)a[t].e=c.e,a[t].b=c.b,a[t].n=c.n,a[t].t=c.t;for(t=1<<r-1;0!=(u&t);t>>=1)u^=t;for(u^=t;(u&(1<<o)-1)!==E[e];)o-=T[e],e--}this.m=T[1],this.status=0!==_&&1!==b?1:0}function f(e){for(;_<e;)a|=(n.length===i?-1:255&n[i++])<<_,_+=8}function p(e){return a&t[e]}function m(e){a>>=e,_-=e}function b(e,t,r){var n,i,a;if(0===r)return 0;for(a=0;;){for(f(v),n=(i=g.list[p(v)]).e;16<n;){if(99===n)return-1;m(i.b),f(n-=16),n=(i=i.t[p(n)]).e}if(m(i.b),16!==n){if(15===n)break;for(f(n),u=i.n+p(n),m(n),f(C),n=(i=T.list[p(C)]).e;16<n;){if(99===n)return-1;m(i.b),f(n-=16),n=(i=i.t[p(n)]).e}for(m(i.b),f(n),S=s-i.n-p(n),m(n);0<u&&a<r;)u--,S&=d-1,s&=d-1,e[t+a++]=o[s++]=o[S++];if(a===r)return r}else if(s&=d-1,e[t+a++]=o[s++]=i.n,a===r)return r}return c=-1,a}function r(e,t,r){for(var n,i=0;i<r;){if(w&&-1===c)return i;if(0<u){if(0!==c)for(;0<u&&i<r;)u--,S&=d-1,s&=d-1,e[t+i++]=o[s++]=o[S++];else{for(;0<u&&i<r;)u--,s&=d-1,f(8),e[t+i++]=o[s++]=p(8),m(8);0===u&&(c=-1)}if(i===r)return i}if(-1===c){if(w)break;f(1),0!==p(1)&&(w=!0),m(1),f(2),c=p(2),m(2),g=null,u=0}switch(c){case 0:n=function(e,t,r){var n;if(m(n=7&_),f(16),n=p(16),m(16),f(16),n!==(65535&~a))return-1;for(m(16),u=n,n=0;0<u&&n<r;)u--,s&=d-1,f(8),e[t+n++]=o[s++]=p(8),m(8);return 0===u&&(c=-1),n}(e,t+i,r-i);break;case 1:n=(g?b:function(e,t,r){if(!I){for(var n,i=[],a=0;a<144;a++)i[a]=8;for(;a<256;a++)i[a]=9;for(;a<280;a++)i[a]=7;for(;a<288;a++)i[a]=8;if(0!==(n=new y(i,288,257,M,D,h=7)).status)return console.error("HufBuild error: "+n.status),-1;for(I=n.root,h=n.m,a=0;a<30;a++)i[a]=5;if(1<(n=new y(i,30,0,x,O,k=5)).status)return I=null,console.error("HufBuild error: "+n.status),-1;l=n.root,k=n.m}return g=I,T=l,v=h,C=k,b(e,t,r)})(e,t+i,r-i);break;case 2:n=(g?b:function(d,l,h){for(var e,t,r,n,i,a,o,s,c=[],u=0;u<316;u++)c[u]=0;if(f(5),a=257+p(5),m(5),f(5),o=1+p(5),m(5),f(4),i=4+p(4),m(4),286<a||30<o)return-1;for(e=0;e<i;e++)f(3),c[L[e]]=p(3),m(3);for(;e<19;e++)c[L[e]]=0;if(0!==(s=new y(c,19,19,null,null,v=7)).status)return-1;for(g=s.root,v=s.m,r=a+o,u=t=0;u<r;)if(f(v),m(e=(n=g.list[p(v)]).b),(e=n.n)<16)c[u++]=t=e;else if(16===e){if(f(2),e=3+p(2),m(2),r<u+e)return-1;for(;0<e--;)c[u++]=t}else if(17===e){if(f(3),e=3+p(3),m(3),r<u+e)return-1;for(;0<e--;)c[u++]=0;t=0}else{if(f(7),e=11+p(7),m(7),r<u+e)return-1;for(;0<e--;)c[u++]=0;t=0}if(s=new y(c,a,257,M,D,v=R),0===v&&(s.status=1),0!==s.status&&1!==s.status)return-1;for(g=s.root,v=s.m,u=0;u<o;u++)c[u]=c[u+a];return s=new y(c,o,0,x,O,C=E),T=s.root,0===(C=s.m)&&257<a||0!==s.status?-1:b(d,l,h)})(e,t+i,r-i);break;default:n=-1}if(-1===n)return w?0:-1;i+=n}return i}var o,s,l,h,k,a,_,c,w,u,S,g,T,v,C,n,i,d,R,E,I,t,M,D,x,O,L;d=32768,I=null,t=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],M=[3,4,5,E=6,7,8,R=9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],O=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],e.exports=function(e){var t=[];for(o=o||[],w=!(c=-1),u=S=_=a=s=0,g=null,n=e,i=0;0<r(t,t.length,1024););return n=null,t}})),ue=K(function(e){function i(){this.fc=0,this.dl=0}function p(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function t(e,t,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n}function m(){this.next=null,this.len=0,this.ptr=[],this.off=0}function n(e){return q[l+e]}function g(e,t){return q[l+e]=t}function v(e){var t,r,n;if((ut[u+c++]=e,u+c===Ne)&&0!==c){for(null!==V?V=(n=V).next:n=new m,n.next=null,n.len=n.off=0,t=n,null===s?s=G=t:G=G.next=t,t.len=c-u,r=0;r<t.len;r++)t.ptr[r]=ut[u+r];c=u=0}}function y(e){e&=65535,u+c<Ne-2?(ut[u+c++]=255&e,ut[u+c++]=e>>>8):(v(255&e),v(e>>>8))}function b(){Q=(Q<<ct^255&h[f+Fe-1])&He,Z=n(Q),q[f&ze]=Z,g(Q,f)}function k(e,t){B(t[e].fc,t[e].dl)}function _(e){return 255&(e<256?_e[e]:_e[256+(e>>7)])}function S(e,t,r){return e[t].fc<e[r].fc||e[t].fc===e[r].fc&&be[t]<=be[r]}function T(e,t,r){for(var n=0;n<r&&xe<De.length;n++)e[t+n]=255&De[xe++];return n}function C(e){var t,r,n,i,a=ie,o=f,s=te,d=$e<f?f-$e:Je,c=f+Ue,u=h[o+s-1],l=h[o+s];se<=te&&(a>>=2);do{if(h[(t=e)+s]===l&&h[t+s-1]===u&&h[t]===h[o]&&h[++t]===h[o+1]){for(o+=2,t++;o<c;){for(i=!1,n=0;n<8;n+=1)if(t+=1,h[o+=1]!==h[t]){i=!0;break}if(i)break}if(r=Ue-(c-o),o=c-Ue,s<r){if(re=e,ce<=(s=r))break;u=h[o+s-1],l=h[o+s]}}}while((e=q[e&ze])>d&&0!=--a);return s}function R(){var e,t,r=Be-o-f;if(-1===r)r--;else if(l+$e<=f){for(e=0;e<l;e++)h[e]=h[e+l];for(re-=l,f-=l,K-=l,e=0;e<We;e++)g(e,(t=n(e))>=l?t-l:Je);for(e=0;e<l;e++)t=q[e],q[e]=l<=t?t-l:Je;r+=l}ne||((e=T(h,f+o,r))<=0?ne=!0:o+=e)}function E(e,t,r){var n;return W||(function(){if(!ne){var e,t,r,n,i;if((X=$=0)===he[0].dl){for(fe.dyn_tree=ue,fe.static_tree=le,fe.extra_bits=dt,fe.extra_base=Ye+1,fe.elems=tt,fe.max_length=Ke,fe.max_code=0,pe.dyn_tree=de,pe.static_tree=he,pe.extra_bits=lt,pe.extra_base=0,pe.elems=rt,pe.max_length=Ke,pe.max_code=0,me.dyn_tree=d,me.static_tree=null,me.extra_bits=ht,me.extra_base=0,me.elems=nt,me.max_length=Qe,n=r=me.max_code=0;n<Ze-1;n++)for(we[n]=r,e=0;e<1<<dt[n];e++)ke[r++]=n;for(ke[r-1]=n,n=i=0;n<16;n++)for(Se[n]=i,e=0;e<1<<lt[n];e++)_e[i++]=n;for(i>>=7;n<rt;n++)for(Se[n]=i<<7,e=0;e<1<<lt[n]-7;e++)_e[256+i++]=n;for(t=0;t<=Ke;t++)ge[t]=0;for(e=0;e<=143;)le[e++].dl=8,ge[8]++;for(;e<=255;)le[e++].dl=9,ge[9]++;for(;e<=279;)le[e++].dl=7,ge[7]++;for(;e<=287;)le[e++].dl=8,ge[8]++;for(M(le,tt+1),e=0;e<rt;e++)he[e].dl=5,he[e].fc=F(e,5);P()}(function(){for(var e=0;e<We;e++)q[l+e]=0;if(ae=pt[oe].max_lazy,se=pt[oe].good_length,ce=pt[oe].nice_length,ie=pt[oe].max_chain,(o=T(h,K=f=0,2*l))<=0)return ne=!0,o=0;for(ne=!1;o<qe&&!ne;)R();for(e=Q=0;e<Fe-1;e++)Q=(Q<<ct^255&h[e])&He})(),s=null,u=c=0,oe<=3?(te=Fe-1,a=0):(a=Fe-1,ee=!1),H=!1}}(),W=!0,0!==o)?(n=I(e,t,r))===r?r:H?n:((oe<=3?function(){for(;0!==o&&null===s;){var e;if(b(),Z!==Je&&f-Z<=$e&&(a=C(Z))>o&&(a=o),Fe<=a)if(e=j(f-re,a-Fe),o-=a,a<=ae){for(a--;f++,b(),0!=--a;);f++}else f+=a,a=0,Q=((Q=255&h[f])<<ct^255&h[f+1])&He;else e=j(0,255&h[f]),o--,f++;for(e&&(L(0),K=f);o<qe&&!ne;)R()}}:function(){for(;0!==o&&null===s;){if(b(),te=a,Y=re,a=Fe-1,Z!==Je&&te<ae&&f-Z<=$e&&((a=(a=C(Z))>o?o:a)===Fe&&4096<f-re&&a--),Fe<=te&&a<=te){var e=j(f-1-Y,te-Fe);for(o-=te-1,te-=2;f++,b(),0!=--te;);ee=!1,a=Fe-1,f++,e&&(L(0),K=f)}else ee?j(0,255&h[f-1])&&(L(0),K=f):ee=!0,f++,o--;for(;o<qe&&!ne;)R()}})(),0===o&&(ee&&j(0,255&h[f-1]),L(1),H=!0),n+I(e,n+t,r-n)):(H=!0,0)}function I(e,t,r){for(var n,i,a,o=0;null!==s&&o<r;){for((n=r-o)>s.len&&(n=s.len),i=0;i<n;i++)e[t+o+i]=s.ptr[s.off+i];s.off+=n,s.len-=n,o+=n,0===s.len&&(s=(a=s).next,(a=a).next=V,V=a)}if(o===r)return o;if(u<c){for((n=r-o)>c-u&&(n=c-u),i=0;i<n;i++)e[t+o+i]=ut[u+i];o+=n,c===(u+=n)&&(c=u=0)}return o}function P(){for(var e=0;e<tt;e++)ue[e].fc=0;for(e=0;e<rt;e++)de[e].fc=0;for(e=0;e<nt;e++)d[e].fc=0;ue[et].fc=1,Ae=Me=0,Ce=Re=Ee=0,Ie=0,Pe=1}function A(e,t){for(var r=w[t],n=t<<1;n<=ve&&(n<ve&&S(e,w[n+1],w[n])&&n++,!S(e,r,w[n]));)w[t]=w[n],t=n,n<<=1;w[t]=r}function M(e,t){for(var r,n=[],i=0,a=1;a<=Ke;a++)i=i+ge[a-1]<<1,n[a]=i;for(r=0;r<=t;r++){var o=e[r].dl;0!==o&&(e[r].fc=F(n[o]++,o))}}function D(e){var t,r,n=e.dyn_tree,d=e.static_tree,l=e.elems,i=-1,a=l;for(ye=st,t=ve=0;t<l;t++)0!==n[t].fc?(w[++ve]=i=t,be[t]=0):n[t].dl=0;for(;ve<2;){var h=w[++ve]=i<2?++i:0;n[h].fc=1,be[h]=0,Ae--,null!==d&&(Me-=d[h].dl)}for(e.max_code=i,t=ve>>1;1<=t;t--)A(n,t);for(;t=w[Xe],w[Xe]=w[ve--],A(n,Xe),r=w[Xe],w[--ye]=t,w[--ye]=r,n[a].fc=n[t].fc+n[r].fc,be[t]>be[r]+1?be[a]=be[t]:be[a]=be[r]+1,n[t].dl=n[r].dl=a,w[Xe]=a++,A(n,Xe),2<=ve;);w[--ye]=w[Xe];for(var o,s,f,p,m,c=e.dyn_tree,g=e.extra_bits,v=e.extra_base,y=e.max_code,b=e.max_length,k=e.static_tree,_=0,u=0;u<=Ke;u++)ge[u]=0;for(c[w[ye]].dl=0,o=ye+1;o<st;o++)(u=c[c[s=w[o]].dl].dl+1)>b&&(u=b,_++),c[s].dl=u,y<s||(ge[u]++,p=0,v<=s&&(p=g[s-v]),m=c[s].fc,Ae+=m*(u+p),null!==k&&(Me+=m*(k[s].dl+p)));if(0!==_){do{for(u=b-1;0===ge[u];)u--}while(ge[u]--,ge[u+1]+=2,ge[b]--,0<(_-=2));for(u=b;0!==u;u--)for(s=ge[u];0!==s;)(f=w[--o])>y||(c[f].dl!==u&&(Ae+=(u-c[f].dl)*c[f].fc,c[f].fc=u),s--)}M(n,i)}function x(e,t){var r,n,i=-1,a=e[0].dl,o=0,s=7,c=4;for(0===a&&(s=138,c=3),e[t+1].dl=65535,r=0;r<=t;r++)n=a,a=e[r+1].dl,++o<s&&n===a||(o<c?d[n].fc+=o:0!==n?(n!==i&&d[n].fc++,d[it].fc++):o<=10?d[at].fc++:d[ot].fc++,i=n,c=(o=0)===a?(s=138,3):n===a?(s=6,3):(s=7,4))}function O(e,t){var r,n,i=-1,a=e[0].dl,o=0,s=7,c=4;for(0===a&&(s=138,c=3),r=0;r<=t;r++)if(n=a,a=e[r+1].dl,!(++o<s&&n===a)){if(o<c)for(;k(n,d),0!=--o;);else 0!==n?(n!==i&&(k(n,d),o--),k(it,d),B(o-3,2)):o<=10?(k(at,d),B(o-3,3)):(k(ot,d),B(o-11,7));i=n,c=(o=0)===a?(s=138,3):n===a?(s=6,3):(s=7,4)}}function L(e){var t,r,n,i=f-K;if(Te[Ee]=Ie,D(fe),D(pe),t=function(){var e;for(x(ue,fe.max_code),x(de,pe.max_code),D(me),e=nt-1;3<=e&&0===d[ft[e]].dl;e--);return Ae+=3*(e+1)+5+5+4,e}(),4+i<=(o=(a=Me+3+7>>3)<=(o=Ae+3+7>>3)?a:o)&&0<=K)for(B((Oe<<1)+e,3),U(),y(i),y(~i),r=0;r<i;r++)v(h[K+r]);else if(a===o)B((Le<<1)+e,3),N(le,he);else{B((je<<1)+e,3);{var a=fe.max_code+1;var o=pe.max_code+1;var s=t+1;for(B(a-257,5),B(o-1,5),B(s-4,4),n=0;n<s;n++)B(d[ft[n]].dl,3);O(ue,a-1),O(de,o-1)}N(ue,de)}P(),0!==e&&U()}function j(e,t){if(J[Ce++]=t,0===e?ue[t].fc++:(e--,ue[ke[t]+Ye+1].fc++,de[_(e)].fc++,z[Re++]=e,Ie|=Pe),Pe<<=1,0==(7&Ce)&&(Te[Ee++]=Ie,Ie=0,Pe=1),2<oe&&0==(4095&Ce)){for(var r=8*Ce,t=f-K,n=0;n<rt;n++)r+=de[n].fc*(5+lt[n]);if(r>>=3,Re<parseInt(Ce/2,10)&&r<parseInt(t/2,10))return!0}return Ce===Ve-1||Re===Ge}function N(e,t){var r,n,i,a=0,o=0,s=0,c=0;if(0!==Ce)for(;0==(7&a)&&(c=Te[s++]),r=255&J[a++],0==(1&c)?k(r,e):(k((n=ke[r])+Ye+1,e),0!==(i=dt[n])&&B(r-=we[n],i),k(n=_(r=z[o++]),t),0!==(i=lt[n])&&B(r-=Se[n],i)),c>>=1,a<Ce;);k(et,e)}function B(e,t){r-t<X?(y($|=e<<X),$=e>>r-X,X+=t-r):($|=e<<X,X+=t)}function F(e,t){for(var r=0;r|=1&e,e>>=1,r<<=1,0<--t;);return r>>1}function U(){8<X?y($):0<X&&v($),X=$=0}var V,s,G,W,c,u,H,h,z,J,q,$,X,K,Q,Z,Y,ee,a,te,f,re,ne,o,ie,ae,oe,se,ce,ue,de,le,he,d,fe,pe,me,ge,w,ve,ye,be,ke,_e,we,Se,Te,Ce,Re,Ee,Ie,Pe,Ae,Me,De,xe,l,Oe,Le,je,Ne,Be,Fe,Ue,Ve,Ge,We,He,ze,Je,qe,$e,Xe,Ke,Qe,Ze,Ye,et,tt,rt,nt,it,at,ot,st,ct,ut,dt,lt,ht,ft,pt,r;Be=(je=2)*(l=32768),Ge=Ve=Ne=8192,He=(We=32768)-(Le=1),ze=l-1,Je=Oe=0,$e=l-(qe=(Ue=258)+(Fe=3)+1),Ke=15,Qe=7,et=Ye=256,rt=30,nt=19,it=16,at=17,ot=18,st=2*(tt=Ye+(Xe=1)+(Ze=29))+1,ct=parseInt((15+Fe-1)/Fe,10),ut=null,dt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],lt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ht=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],pt=[new t(0,0,0,0),new t(4,4,8,4),new t(4,5,16,8),new t(4,6,32,32),new t(4,4,16,16),new t(8,16,32,32),new t(8,16,128,128),new t(8,32,128,256),new t(32,128,258,1024),new t(32,258,258,4096)],r=16,e.exports=function(e,t){De=e;var r,n,e=t=void(xe=0)===t?6:t;if(e?e<1?e=1:9<e&&(e=9):e=6,oe=e,ne=W=!1,null===ut){for(V=s=G=null,ut=[],h=[],z=[],J=[],q=[],ue=[],n=0;n<st;n++)ue[n]=new i;for(de=[],n=0;n<2*rt+1;n++)de[n]=new i;for(le=[],n=0;n<tt+2;n++)le[n]=new i;for(he=[],n=0;n<rt;n++)he[n]=new i;for(d=[],n=0;n<2*nt+1;n++)d[n]=new i;fe=new p,pe=new p,me=new p,ge=[],w=[],be=[],ke=[],_e=[],we=[],Se=[],Te=[]}for(r=[];0<E(r,r.length,1024););return De=null,r},e.exports.DEFAULT_LEVEL=6}),de=(ue.DEFAULT_LEVEL,K(function(e){e.exports={inflate:ce,deflate:ue}})),le=K(function(e){!function(){var d=se,l=de,h={deflate:8},b=1,k=2,_=4,f=8,w=16,p={fat:0,amiga:1,vmz:2,unix:3,"vm/cms":4,atari:5,hpfs:6,macintosh:7,"z-system":8,cplm:9,"tops-20":10,ntfs:11,qdos:12,acorn:13,vfat:14,vms:15,beos:16,tandem:17,theos:18};function u(e,t){t.push(255&e)}function r(e,t){t.push(255&e),t.push(e>>>8)}function m(e,t){r(65535&e,t),r(e>>>16,t)}function g(e){return e.shift()}function v(e){return e.shift()|e.shift()<<8}function y(e){var t=v(e),e=v(e);return 32768<e?((e-=32768)<<16|t)+32768*Math.pow(2,16):e<<16|t}function S(e){for(var t=[];0!==e[0];)t.push(String.fromCharCode(e.shift()));return e.shift(),t.join("")}e.exports={zip:function(e,t){var r=0,n=[],i=(t=t||{}).level||6;if("string"==typeof e&&(e=Array.prototype.map.call(e,function(e){return e.charCodeAt(0)})),u(31,n),u(139,n),u(h.deflate,n),t.name&&(r|=f),u(r,n),m(t.timestamp||parseInt(Date.now()/1e3,10),n),u(1===i?4:9===i?2:0,n),u(p.unix,n),t.name){for(var a=t.name.substring(t.name.lastIndexOf("/")+1),o=n,s=a.length,c=0;c<s;c+=1)u(a.charCodeAt(c),o);u(0,n)}return l.deflate(e,i).forEach(function(e){u(e,n)}),m(parseInt(d(e),16),n),m(e.length,n),n},unzip:function(e,u){var t,r,n,i,e=Array.prototype.slice.call(e,0);if(31!==g(e)||139!==g(e))throw"Not a GZIP file";if(t=g(e),!(t=Object.keys(h).some(function(e){return h[r=e]===t})))throw"Unsupported compression method";if(n=g(e),y(e),g(e),t=g(e),Object.keys(p).some(function(e){if(p[e]===t)return!0}),n&_)for(var a=e,o=t=v(e),s=[],c=0;c<o;c+=1)s.push(a.shift());if(n&f&&S(e),n&w&&S(e),n&k&&v(e),"deflate"===r&&(i=l.inflate(e.splice(0,e.length-8))),n&b&&(i=Array.prototype.map.call(i,function(e){return String.fromCharCode(e)}).join("")),y(e)!==parseInt(d(i),16))throw"Checksum does not match";if(y(e)!==i.length)throw"Size of decompressed file not correct";return i},get DEFAULT_LEVEL(){return 6}}}()}),he=(le.zip,le.unzip,le.DEFAULT_LEVEL,K(function(e){function l(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e,t,r,n,i,a){return l((t=l(l(t,e),l(n,a)))<<i|t>>>32-i,r)}function h(e,t,r,n,i,a,o){return s(t&r|~t&n,e,t,i,a,o)}function f(e,t,r,n,i,a,o){return s(t&n|r&~n,e,t,i,a,o)}function p(e,t,r,n,i,a,o){return s(t^r^n,e,t,i,a,o)}function m(e,t,r,n,i,a,o){return s(r^(t|~n),e,t,i,a,o)}function o(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r,n,i,d,a=1732584193,o=-271733879,s=-1732584194,c=271733878,u=0;u<e.length;u+=16)a=h(r=a,n=o,i=s,d=c,e[u],7,-680876936),c=h(c,a,o,s,e[u+1],12,-389564586),s=h(s,c,a,o,e[u+2],17,606105819),o=h(o,s,c,a,e[u+3],22,-1044525330),a=h(a,o,s,c,e[u+4],7,-176418897),c=h(c,a,o,s,e[u+5],12,1200080426),s=h(s,c,a,o,e[u+6],17,-1473231341),o=h(o,s,c,a,e[u+7],22,-45705983),a=h(a,o,s,c,e[u+8],7,1770035416),c=h(c,a,o,s,e[u+9],12,-1958414417),s=h(s,c,a,o,e[u+10],17,-42063),o=h(o,s,c,a,e[u+11],22,-1990404162),a=h(a,o,s,c,e[u+12],7,1804603682),c=h(c,a,o,s,e[u+13],12,-40341101),s=h(s,c,a,o,e[u+14],17,-1502002290),a=f(a,o=h(o,s,c,a,e[u+15],22,1236535329),s,c,e[u+1],5,-165796510),c=f(c,a,o,s,e[u+6],9,-1069501632),s=f(s,c,a,o,e[u+11],14,643717713),o=f(o,s,c,a,e[u],20,-373897302),a=f(a,o,s,c,e[u+5],5,-701558691),c=f(c,a,o,s,e[u+10],9,38016083),s=f(s,c,a,o,e[u+15],14,-660478335),o=f(o,s,c,a,e[u+4],20,-405537848),a=f(a,o,s,c,e[u+9],5,568446438),c=f(c,a,o,s,e[u+14],9,-1019803690),s=f(s,c,a,o,e[u+3],14,-187363961),o=f(o,s,c,a,e[u+8],20,1163531501),a=f(a,o,s,c,e[u+13],5,-1444681467),c=f(c,a,o,s,e[u+2],9,-51403784),s=f(s,c,a,o,e[u+7],14,1735328473),a=p(a,o=f(o,s,c,a,e[u+12],20,-1926607734),s,c,e[u+5],4,-378558),c=p(c,a,o,s,e[u+8],11,-2022574463),s=p(s,c,a,o,e[u+11],16,1839030562),o=p(o,s,c,a,e[u+14],23,-35309556),a=p(a,o,s,c,e[u+1],4,-1530992060),c=p(c,a,o,s,e[u+4],11,1272893353),s=p(s,c,a,o,e[u+7],16,-155497632),o=p(o,s,c,a,e[u+10],23,-1094730640),a=p(a,o,s,c,e[u+13],4,681279174),c=p(c,a,o,s,e[u],11,-358537222),s=p(s,c,a,o,e[u+3],16,-722521979),o=p(o,s,c,a,e[u+6],23,76029189),a=p(a,o,s,c,e[u+9],4,-640364487),c=p(c,a,o,s,e[u+12],11,-421815835),s=p(s,c,a,o,e[u+15],16,530742520),a=m(a,o=p(o,s,c,a,e[u+2],23,-995338651),s,c,e[u],6,-198630844),c=m(c,a,o,s,e[u+7],10,1126891415),s=m(s,c,a,o,e[u+14],15,-1416354905),o=m(o,s,c,a,e[u+5],21,-57434055),a=m(a,o,s,c,e[u+12],6,1700485571),c=m(c,a,o,s,e[u+3],10,-1894986606),s=m(s,c,a,o,e[u+10],15,-1051523),o=m(o,s,c,a,e[u+1],21,-2054922799),a=m(a,o,s,c,e[u+8],6,1873313359),c=m(c,a,o,s,e[u+15],10,-30611744),s=m(s,c,a,o,e[u+6],15,-1560198380),o=m(o,s,c,a,e[u+13],21,1309151649),a=m(a,o,s,c,e[u+4],6,-145523070),c=m(c,a,o,s,e[u+11],10,-1120210379),s=m(s,c,a,o,e[u+2],15,718787259),o=m(o,s,c,a,e[u+9],21,-343485551),a=l(a,r),o=l(o,n),s=l(s,i),c=l(c,d);return[a,o,s,c]}function d(e){for(var t="",r=32*e.length,n=0;n<r;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function c(e){var t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(var r=8*e.length,n=0;n<r;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function n(e){for(var t,r="",n=0;n<e.length;n+=1)t=e.charCodeAt(n),r+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return r}function u(e){return unescape(encodeURIComponent(e))}function i(e){return d(o(c(e=u(e)),8*e.length))}function a(e,t){var r,e=u(e),t=u(t),n=c(e),i=[],a=[];for(i[15]=a[15]=void 0,16<n.length&&(n=o(n,8*e.length)),r=0;r<16;r+=1)i[r]=909522486^n[r],a[r]=1549556828^n[r];return e=o(i.concat(c(t)),512+8*t.length),d(o(a.concat(e),640))}function t(e,t,r){return t?r?a(t,e):n(a(t,e)):r?i(e):n(i(e))}var r;r=$e,e.exports?e.exports=t:r.md5=t})),fe=K(function(a,s){var c="__lodash_hash_undefined__",M=1,D=2,u=1/0,d=9007199254740991,x="[object Arguments]",O="[object Array]",L="[object Boolean]",j="[object Date]",N="[object Error]",l="[object Function]",h="[object GeneratorFunction]",B="[object Map]",F="[object Number]",U="[object Object]",V="[object RegExp]",G="[object Set]",W="[object String]",H="[object Symbol]",z="[object ArrayBuffer]",J="[object DataView]",f=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/,m=/^\./,g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,v=/\\(\\)?/g,y=/^\[object .+?Constructor\]$/,b=/^(?:0|[1-9]\d*)$/,t={},k=(t["[object Float32Array]"]=t["[object Float64Array]"]=t["[object Int8Array]"]=t["[object Int16Array]"]=t["[object Int32Array]"]=t["[object Uint8Array]"]=t["[object Uint8ClampedArray]"]=t["[object Uint16Array]"]=t["[object Uint32Array]"]=!0,t[x]=t[O]=t[z]=t[L]=t[J]=t[j]=t[N]=t[l]=t[B]=t[F]=t[U]=t[V]=t[G]=t[W]=t["[object WeakMap]"]=!1,"object"==typeof $e&&$e&&$e.Object===Object&&$e),e="object"==typeof self&&self&&self.Object===Object&&self,e=k||e||Function("return this")(),s=s&&!s.nodeType&&s,r=s&&a&&!a.nodeType&&a,_=r&&r.exports===s&&k.process,r=function(){try{return _&&_.binding("util")}catch(e){}}(),s=r&&r.isTypedArray;function w(e,t,r,n){for(var i=-1,a=e?e.length:0;++i<a;){var o=e[i];t(n,o,r(o),e)}return n}function q(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function $(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}function X(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var S,T,k=Array.prototype,r=Function.prototype,C=Object.prototype,n=e["__core-js_shared__"],R=(n=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",K=r.toString,E=C.hasOwnProperty,Q=C.toString,Z=RegExp("^"+K.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),n=e.Symbol,Y=e.Uint8Array,ee=C.propertyIsEnumerable,te=k.splice,re=(S=Object.keys,T=Object,function(e){return S(T(e))}),r=Re(e,"DataView"),ne=Re(e,"Map"),k=Re(e,"Promise"),ie=Re(e,"Set"),e=Re(e,"WeakMap"),ae=Re(Object,"create"),oe=xe(r),se=xe(ne),ce=xe(k),ue=xe(ie),de=xe(e),n=n?n.prototype:void 0,le=n?n.valueOf:void 0,he=n?n.toString:void 0;function fe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function i(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function o(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function pe(e){var t=-1,r=e?e.length:0;for(this.__data__=new o;++t<r;)this.add(e[t])}function I(e){this.__data__=new i(e)}function me(e,t){for(var r=e.length;r--;)if(je(e[r][0],t))return r;return-1}function ge(e,n,i,a){return function(e,t){if(null==e)return;if(!Be(e))return ve(e,t);for(var r=e.length,n=-1,i=Object(e);++n<r&&!1!==t(i[n],n,i););}(e,function(e,t,r){n(a,e,i(e),r)}),a}fe.prototype.clear=function(){this.__data__=ae?ae(null):{}},fe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},fe.prototype.get=function(e){var t,r=this.__data__;return ae?(t=r[e])===c?void 0:t:E.call(r,e)?r[e]:void 0},fe.prototype.has=function(e){var t=this.__data__;return ae?void 0!==t[e]:E.call(t,e)},fe.prototype.set=function(e,t){return this.__data__[e]=ae&&void 0===t?c:t,this},i.prototype.clear=function(){this.__data__=[]},i.prototype.delete=function(e){var t=this.__data__,e=me(t,e);return!(e<0||(e==t.length-1?t.pop():te.call(t,e,1),0))},i.prototype.get=function(e){var t=this.__data__,e=me(t,e);return e<0?void 0:t[e][1]},i.prototype.has=function(e){return-1<me(this.__data__,e)},i.prototype.set=function(e,t){var r=this.__data__,n=me(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},o.prototype.clear=function(){this.__data__={hash:new fe,map:new(ne||i),string:new fe}},o.prototype.delete=function(e){return Ce(this,e).delete(e)},o.prototype.get=function(e){return Ce(this,e).get(e)},o.prototype.has=function(e){return Ce(this,e).has(e)},o.prototype.set=function(e,t){return Ce(this,e).set(e,t),this},pe.prototype.add=pe.prototype.push=function(e){return this.__data__.set(e,c),this},pe.prototype.has=function(e){return this.__data__.has(e)},I.prototype.clear=function(){this.__data__=new i},I.prototype.delete=function(e){return this.__data__.delete(e)},I.prototype.get=function(e){return this.__data__.get(e)},I.prototype.has=function(e){return this.__data__.has(e)},I.prototype.set=function(e,t){var r=this.__data__;if(r instanceof i){var n=r.__data__;if(!ne||n.length<199)return n.push([e,t]),this;r=this.__data__=new o(n)}return r.set(e,t),this};ve=function(e,t){return e&&ye(e,t,Je)};var ve,ye=function(e,t,r){for(var n=-1,i=Object(e),a=r(e),o=a.length;o--;){var s=a[++n];if(!1===t(i[s],s,i))break}return e};function be(e,t){for(var r=0,n=(t=Ie(t,e)?[t]:Se(t)).length;null!=e&&r<n;)e=e[De(t[r++])];return r&&r==n?e:void 0}function ke(e,t){return null!=e&&t in Object(e)}function _e(e,t,r,n,i){return e===t||(null==e||null==t||!Ve(e)&&!Ge(t)?e!=e&&t!=t:function(e,t,d,l,h,r){var n=A(e),f=A(t),p=O,i=O,f=(n||(p=(p=P(e))==x?U:p),f||(i=(i=P(t))==x?U:i),p==U&&!q(e)),a=i==U&&!q(t),i=p==i;if(i&&!f)return r=r||new I,(n||ze(e)?Te:function(e,t,r,n,i,a){switch(p){case J:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case z:return!(e.byteLength!=t.byteLength||!r(new Y(e),new Y(t)));case L:case j:case F:return je(+e,+t);case N:return e.name==t.name&&e.message==t.message;case V:case W:return e==t+"";case B:var o=$;case G:o=o||X;if(e.size!=t.size&&!(i&D))return!1;var s=a.get(e);if(s)return s==t;i|=M,a.set(e,t);s=Te(o(e),o(t),r,n,i,a);return a.delete(e),s;case H:if(le)return le.call(e)==le.call(t)}return!1})(e,t,d,l,h,r);if(!(h&D)){n=f&&E.call(e,"__wrapped__"),f=a&&E.call(t,"__wrapped__");if(n||f)return d(n?e.value():e,f?t.value():t,l,h,r=r||new I)}if(i){r=r||new I;var o=e,s=t,m=d,g=l,v=h,c=r,y=v&D,b=Je(o),k=b.length;if(k!=Je(s).length&&!y)return!1;for(var _=k;_--;){var u=b[_];if(!(y?u in s:E.call(s,u)))return!1}a=c.get(o);if(a&&c.get(s))return a==s;var w=!0;c.set(o,s),c.set(s,o);for(var S=y;++_<k;){var T,C=o[u=b[_]],R=s[u];if(!(void 0===(T=g?y?g(R,C,u,s,o,c):g(C,R,u,o,s,c):T)?C===R||m(C,R,g,v,c):T)){w=!1;break}S=S||"constructor"==u}return!w||S||(a=o.constructor)!=(n=s.constructor)&&"constructor"in o&&"constructor"in s&&!("function"==typeof a&&a instanceof a&&"function"==typeof n&&n instanceof n)&&(w=!1),c.delete(o),c.delete(s),w}return!1}(e,t,_e,r,n,i))}function we(e){return"function"==typeof e?e:null==e?qe:"object"==typeof e?A(e)?(i=e[0],a=e[1],Ie(i)&&Pe(a)?Ae(De(i),a):function(e){var t=void 0===(t=null==e?void 0:be(e,i))?void 0:t;return void 0===t&&t===a?null!=e&&function(e,t,r){for(var n,i=-1,a=(t=Ie(t,e)?[t]:Se(t)).length;++i<a;){var o=De(t[i]);if(!(n=null!=e&&r(e,o)))break;e=e[o]}return n||!!(a=e?e.length:0)&&Ue(a)&&Ee(o,a)&&(A(e)||Ne(e))}(e,i,ke):_e(a,t,void 0,M|D)}):1==(n=function(e){for(var t=Je(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Pe(i)]}return t}(r=e)).length&&n[0][2]?Ae(n[0][0],n[0][1]):function(d){return d===r||function(e,t,r){var n=t.length,i=n;if(null==d)return!i;for(e=Object(d);n--;){var a=t[n];if(a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++n<i;){var o=(a=t[n])[0],s=e[o],c=a[1];if(a[2]){if(void 0===s&&!(o in e))return!1}else{var u,o=new I;if(!(void 0===u?_e(c,s,r,M|D,o):u))return!1}}return!0}(0,n)}:Ie(e=e)?(o=De(e),function(e){return null==e?void 0:e[o]}):(t=e,function(e){return be(e,t)});var t,r,n,i,a,o}function Se(e){return A(e)?e:Me(e)}function Te(e,t,d,r,n,i){var l=n&D,h=e.length,a=t.length;if(h!=a&&!(l&&h<a))return!1;a=i.get(e);if(a&&i.get(t))return a==t;var o=-1,s=!0,f=n&M?new pe:void 0;for(i.set(e,t),i.set(t,e);++o<h;){var p,c=e[o],u=t[o];if(void 0!==(p=r?l?r(u,c,o,t,e,i):r(c,u,o,e,t,i):p)){if(p)continue;s=!1;break}if(f){if(!function(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return 1}(t,function(e,t){return!f.has(t)&&(c===e||d(c,e,r,n,i))&&f.add(t)})){s=!1;break}}else if(c!==u&&!d(c,u,r,n,i)){s=!1;break}}return i.delete(e),i.delete(t),s}function Ce(e,t){var r,e=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map}function Re(e,t){e=null==e?void 0:e[t];return!Ve(t=e)||R&&R in t||!(Fe(t)||q(t)?Z:y).test(xe(t))?void 0:e}var P=function(e){return Q.call(e)};function Ee(e,t){return!!(t=null==t?d:t)&&("number"==typeof e||b.test(e))&&-1<e&&e%1==0&&e<t}function Ie(e,t){var r;if(!A(e))return r=typeof e,"number"==r||"symbol"==r||"boolean"==r||null==e||We(e)||p.test(e)||!f.test(e)||null!=t&&e in Object(t)}function Pe(e){return e==e&&!Ve(e)}function Ae(t,r){return function(e){return null!=e&&e[t]===r&&(void 0!==r||t in Object(e))}}(r&&P(new r(new ArrayBuffer(1)))!=J||ne&&P(new ne)!=B||k&&"[object Promise]"!=P(k.resolve())||ie&&P(new ie)!=G||e&&"[object WeakMap]"!=P(new e))&&(P=function(e){var t=Q.call(e),e=t==U?e.constructor:void 0,e=e?xe(e):void 0;if(e)switch(e){case oe:return J;case se:return B;case ce:return"[object Promise]";case ue:return G;case de:return"[object WeakMap]"}return t});var Me=Le(function(e){e=null==e?"":function(e){if("string"==typeof e)return e;if(We(e))return he?he.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}(e);var i=[];return m.test(e)&&i.push(""),e.replace(g,function(e,t,r,n){i.push(r?n.replace(v,"$1"):t||e)}),i});function De(e){if("string"==typeof e||We(e))return e;var t=e+"";return"0"==t&&1/e==-u?"-0":t}function xe(e){if(null!=e){try{return K.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var Oe;Oe=function(e,t,r){E.call(e,r)?e[r].push(t):e[r]=[t]};function Le(n,i){if("function"!=typeof n||i&&"function"!=typeof i)throw new TypeError("Expected a function");function a(){var e=arguments,t=i?i.apply(this,e):e[0],r=a.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),a.cache=r.set(t,e),e)}return a.cache=new(Le.Cache||o),a}function je(e,t){return e===t||e!=e&&t!=t}function Ne(e){return Ge(e)&&Be(e)&&E.call(e,"callee")&&(!ee.call(e,"callee")||Q.call(e)==x)}Le.Cache=o;var A=Array.isArray;function Be(e){return null!=e&&Ue(e.length)&&!Fe(e)}function Fe(e){e=Ve(e)?Q.call(e):"";return e==l||e==h}function Ue(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=d}function Ve(e){var t=typeof e;return e&&("object"==t||"function"==t)}function Ge(e){return!!e&&"object"==typeof e}function We(e){return"symbol"==typeof e||Ge(e)&&Q.call(e)==H}var He,ze=s?(He=s,function(e){return He(e)}):function(e){return Ge(e)&&Ue(e.length)&&!!t[Q.call(e)]};function Je(e){return(Be(e)?function(e,t){var r,n=A(e)||Ne(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=n.length,a=!!i;for(r in e)!t&&!E.call(e,r)||a&&("length"==r||Ee(r,i))||n.push(r);return n}:function(e){if(e!==("function"==typeof(t=e&&e.constructor)&&t.prototype||C))return re(e);var t,r,n=[];for(r in Object(e))E.call(e,r)&&"constructor"!=r&&n.push(r);return n})(e)}function qe(e){return e}a.exports=function(e,t){return(A(e)?w:ge)(e,Oe,we(t),{})}});const Wt="4.0.1-beta.7";function pe(){const e=new Date;function t(e){e=e.toString();return e.length<2?"0"+e:e}return`[${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}.${e.getMilliseconds()}]`}const S=new class{constructor(e){this.level=e}setLevel(e){this.level=e}fetchConsoleLog(e){T.addEvent("WebConsoleLog",{content:String(e)})}log(...e){var t;"log"===this.level&&(t=pe()+" %cLOG-QNRTC",console.info(t,"color: #66ccff; font-weight: bold;",...e),this.fetchConsoleLog([t,...e]))}debug(...e){var t;"log"!==this.level&&"debug"!==this.level||(t=pe()+" %cDEBUG-QNRTC",console.info(t,"color: #A28148; font-weight: bold;",...e),this.fetchConsoleLog([t,...e]))}warning(...e){var t;"disable"!==this.level&&(t=pe()+" %cWARNING-QNRTC",console.warn(t,"color: #E44F44; font-weight: bold;",...e),this.fetchConsoleLog([t,...e]))}}("log");class Ht extends e{constructor(e,t=!0){super(),this._closed=!1,this._busy=!1,this._queue=[],this.name=e||"TaskQueue",this.isDebug=t}close(){this._closed=!0}push(r,n){return this.isDebug&&S.debug(this.name+" push()",r,n),new Promise((e,t)=>{this._queue.push({method:r,data:n,resolve:e,reject:t}),this._handlePendingCommands()})}_handlePendingCommands(){if(!this._busy){const e=this._queue,t=e[0];t&&(this._busy=!0,this._handleCommand(t).then(()=>{this._busy=!1,e.shift(),this._handlePendingCommands()}))}}_handleCommand(t){if(this.isDebug&&S.debug(this.name+" _handleCommand() ",t.method,t.data),this._closed)return t.reject(new fr("closed")),Promise.resolve();const e={promise:null};return this.emit("exec",t,e),Promise.resolve().then(()=>e.promise).then(e=>{this.isDebug&&S.debug(this.name+" _handleCommand() | command succeeded",t.method),this._closed?t.reject(new fr("closed")):t.resolve(e)}).catch(e=>{this.isDebug&&S.warning(this.name+" _handleCommand() | command failed [method:%s]: %o",t.method,e),t.reject(e)})}}const zt="qnrtcqosevents";function me(){return new Promise((t,e)=>{window.requestIdleCallback?window.requestIdleCallback(()=>{ae.get(e=>{e=he(JSON.stringify(e));t(e)})}):setTimeout(()=>{ae.get(e=>{e=he(JSON.stringify(e));t(e)})},500)})}function ge(r){const n=[];for(let t=0;t<r.length;t++){let e=r.charCodeAt(t);e<128?n.push(e):e<2048?n.push(192|e>>6,128|63&e):e<55296||57344<=e?n.push(224|e>>12,128|e>>6&63,128|63&e):(t++,e=65536+((1023&e)<<10|1023&r.charCodeAt(t)),n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e))}return new Uint8Array(n)}const T=new class{constructor(){this.events=[],this.lastSubmitTime=Date.now(),this.submitQueue=new Ht("qossubmit",!1),me().then(e=>{this.deviceId=e,this.base.device_id=this.deviceId}).catch(()=>{this.deviceId="unknow",this.base.device_id=this.deviceId}),this.base={qos_version:"2.0",device_id:"",bundle_id:window.location.href,app_version:"",sdk_version:Wt,device_model:""+l.name+l.version,os_platform:l.os,os_version:""},this.initSubmitQueue(),this.submitQueue.push("resume").catch(Te)}setSessionId(t){for(let e=this.events.length-1;0<=e;--e){const r=this.events[e];if(r.session_id)break;r.session_id=t}this.sessionId=t}setUserBase(e,t,r){this.userBase={user_id:e,room_name:t,app_id:r};for(let e=this.events.length-1;0<=e;--e){const t=this.events[e];if(t.user_base)break;t.user_base=this.userBase}}addEvent(e,t,r){e=W({timestamp:Date.now(),event_id:Gt[e],event_name:e},t);this.submitQueue.push("add",e).catch(Te),this.submit(r)}submit(e=!1){this.submitQueue.push("submit",e).catch(Te)}initSubmitQueue(){this.submitQueue.on("exec",(e,t)=>{switch(e.method){case"submit":return void(t.promise=this._submit(e.data));case"add":return void(t.promise=this._addEvent(e.data));case"resume":return void(t.promise=this._recoverStoredEvents())}})}async _recoverStoredEvents(){var e=await oe.getItem(zt);await oe.removeItem(zt),e&&(this.events=JSON.parse(window.atob(decodeURIComponent(e))),this.events=this.events.filter(e=>!!e.session_id&&!!e.user_base).sort((e,t)=>e.event.timestamp-t.event.timestamp))}_addEvent(e){return this.events.push({user_base:this.userBase,event:e,session_id:this.sessionId}),this.submit(),Promise.resolve()}saveEvents(){var e=encodeURIComponent(window.btoa(JSON.stringify(this.events)));oe.setItem(zt,e).catch(Te)}submitCheck(){return!!(this.sessionId&&this.deviceId&&this.userBase)&&(3e5<Date.now()-this.lastSubmitTime||30<=this.events.length)}async _submit(e=!1){if(e||this.submitCheck())try{const e=this.encodeQosSubmitData();for(const t of e)if(!(await fetch("https://pili-rtc-qos.qiniuapi.com/v1/rtcevent",{method:"POST",headers:{"Content-Type":"application/x-gzip"},body:t.buffer})).ok)throw C("rtcevent error");this.lastSubmitTime=Date.now(),this.events=[],await oe.removeItem(zt)}catch(e){console.log(e)}else this.saveEvents()}encodeQosSubmitData(){const e=fe(this.events,e=>e.session_id||""+JSON.stringify(e.user_base)),t=[];for(const n in e){const i=e[n];var r;0!==i.length&&(r={session_id:i[0].session_id,user_base:i[0].user_base,base:this.base,items:i.map(e=>e.event)},r=new Uint8Array(le.zip(ge(JSON.stringify(r)))),t.push(r))}return t}};{const G=navigator;function ve(e,t){let r;switch(e){case"prompt":r=w.PermissionStateCode.prompt;break;case"granted":r=w.PermissionStateCode.granted;break;case"denied":r=w.PermissionStateCode.denied;break;default:return}T.addEvent("AuthorizationStatus",{type:t,status:r})}function ye(t){G&&G.permissions&&G.permissions.query({name:t}).then(e=>{ve(e.state,w.PermissionNameCode[t]),e.onchange=()=>{ve(e.state,w.PermissionNameCode[t])}}).catch(e=>{S.debug("error when queryPermission",e)})}ye("camera"),ye("microphone")}document.visibilityState&&document.addEventListener("visibilitychange",()=>{T.addEvent("ApplicationState",{state:"visible"===document.visibilityState?0:2})});const Jt=(()=>{let t=w.NetworkGrade.INVALID,e="unknow";const r=()=>{T.addEvent("NetworkChange",{network_type:(e=>{let t;switch(e){case"cellular":t=0;break;case"wifi":t=1;break;case"ethernet":t=2;break;default:t=-1}return t})(e),network_name:e,network_grade:t})},n=navigator,i=n.connection||n.mozConnection||n.webkitConnection;return i&&i.type&&(e=i.type,i.onchange=()=>{e!==i.type&&(e=i.type,r())}),r(),e=>{e!==t&&(t=e,r())}})();class qt extends Error{constructor(e,t){super(t),this.code=e,this.error=t,T.addEvent("SDKError",{error_code:e,error_msg:t})}}const C=e=>new qt(11e3,"piliRTC: unexpected error "+e),$t=e=>new qt(11001,`enterRoom error, can not get accessToken. Error: ${e}
 please check enterRoom arguments`),Xt=(e,t)=>new qt(e,`publish error, signaling code: ${e}, msg: `+t),Kt=(e,t)=>new qt(e,`create merge job error, signaling code: ${e}, msg: `+t),Qt=e=>new qt(11005,"subscribe faild, can not create p2p connection, "+e),Zt=e=>new qt(11006,"publish faild, can not create p2p connection, "+e),Yt=e=>new qt(11007,"media format not support, "+e),er=(e,t)=>new qt(e,`subscribe error, signaling code: ${e}, msg: `+t),tr=(e,t)=>new qt(e,`send control error, code: ${e}, msg: `+t),rr=e=>new qt(11008,"not support! "+e),nr=()=>new qt(10052,"server unavailable"),ir=e=>new qt(11009,"plugin not avaliable! "+e),ar=e=>new qt(11010,"NotAllowedError: no permission to access media device. "+e),or=e=>new qt(11012,"can not set merge layout stream, no merge job id "+e),sr=()=>new qt(11013,"can not sharing screen/window on chrome"),cr=()=>new qt(11014,"subscribe/publish operation is aborted"),ur=e=>new qt(11015,"can not decode audio data, "+e.toString()),dr=()=>new qt(11017,"cannot found preset"),lr=()=>new qt(11018,"no audio track when createScreenVideoTrack withAudio enable"),hr=()=>new qt(30001,"websocket abort");class fr extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,fr):this.stack=new Error(e).stack}}var be,ke,t=Object.freeze({QNRTCError:qt,UNEXPECTED_ERROR:C,AUTH_ENTER_ROOM_ERROR:$t,PUBLISH_ERROR:Xt,CREATE_MERGE_JOB_ERROR:Kt,PUBLISH_ICE_ERROR:()=>new qt(11002,"publish faild, ice not ready"),SUB_ICE_ERROR:()=>new qt(11003,"subscribe faild, ice not ready"),SUB_ERROR_NO_STREAM:e=>new qt(11004,"subscribe faild, can not find this player in streams, userID: "+e),SUB_P2P_ERROR:Qt,PUB_P2P_ERROR:Zt,UNSUPPORT_FMT:Yt,JOIN_ROOM_ERROR:(e,t)=>new qt(e,`joinRoom error, code: ${e}, `+t),SUB_ERROR:er,UNPUBLISH_ERROR:(e,t)=>new qt(e,"unpublish error, code: ${code}, msg: ${msg}"),UNSUB_ERROR:(e,t)=>new qt(e,"unsubscribe error, code: ${code}, msg: ${msg}"),CONTROL_ERROR:tr,NOT_SUPPORT_ERROR:rr,SERVER_UNAVAILABLE:nr,PLUGIN_NOT_AVALIABLE:ir,DEVICE_NOT_ALLOWED:ar,SUB_ERROR_NO_USER:e=>new qt(11011,"subscribe faild, can not find this user in room, userID: "+e),NO_MERGE_JOB:or,SCREEN_PERMISSION_DENIED:sr,SUB_PUB_ABORT:cr,AUDIO_DECODE_ERROR:ur,PRESET_NOT_FOUND:dr,CREATE_SCREEN_AUDIO_ERROR:lr,AUTO_SWITCH_ERROR:e=>new qt(20001,"deviceManager auto switch error. "+e),WS_ABORT:hr,InvalidStateError:fr});function _e(e){e=e.split(".")[1];if(!e)throw new Error("parse jwt error, can not find payload string.");e=atob(e);return JSON.parse(e)}function we(e){try{var t=e.split(":")[2],r=atob(t);return JSON.parse(r)}catch(e){throw C("can not parse roomToken, "+e)}}function Se(t,r,n){if(!n)return null;for(let e=0;e<t.length;e+=1){var i=t[e];if(i[r]===n)return i}return null}function Te(){}function Ce(e,t=0){if(4<=t)return e;for(const r in e)void 0===e[r]&&delete e[r],"object"==typeof e[r]&&(e[r]=Ce(e[r],t+1));return e}function Re(e){Promise.resolve().then(e)}function Ee(e){return("0"+e.toString(16)).substr(-2)}function Ie(e=5){e=new Uint8Array((e||40)/2);return window.crypto.getRandomValues(e),Array.from(e,Ee).join("")}function Pe(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}const pr={};function Ae(e){S.warning("play failed!",e),S.warning("play failed due to browser security policy, see: http://s.qnsdk.com/s/Txsdz")}async function Me(e){const t=await fetch(e);if(400<=t.status&&t.status<500)throw{retry:!1,message:t.status.toString()};if(200!==t.status)throw{retry:!0,message:t.status.toString()};return t.json()}async function De(e){const t=e.match(/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/);if(e.match(/^([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])$/)||t)return e;try{const t=await fetch(`https://${e}/ip`);return(await t.json()).ip}catch(t){return S.warning("resolve ice failed, retry",t),await Pe(1e3),De(e)}}class mr{constructor(e,t=mr.AlphaForPacketLossFractionSmoother){this.mLastFilteredTimestamp=Date.now(),this.mMax=mr.kValueUndefined,this.smooth_interval="audio"===e?mr.SMOOTH_AUDIO_INTERVAL:mr.SMOOTH_VIDEO_INTERVAL,this.Reset(t)}Reset(e){this.mAlpha=e,this.mFiltered=mr.kValueUndefined}Apply(t){var r=Date.now()-this.mLastFilteredTimestamp;if(r<this.smooth_interval&&0===t)this.applied=!1;else{let e;e=this.mFiltered===mr.kValueUndefined?t:1==r?this.mAlpha*this.mFiltered+(1-this.mAlpha)*t:(r=Math.pow(this.mAlpha,r))*this.mFiltered+(1-r)*t,isNaN(e)||(this.mFiltered=e),this.mMax!==mr.kValueUndefined&&this.mFiltered>this.mMax&&(this.mFiltered=this.mMax),this.mLastFilteredTimestamp=Date.now(),this.applied=!0}}Filtered(){return this.mFiltered}LastFilteredTime(){return this.mLastFilteredTimestamp}UpdateBase(e){this.mAlpha=e}}function xe(){const r={};return(e,t)=>(e in r||(r[e]=new mr(t)),r[e])}mr.kValueUndefined=-1,mr.AlphaForPacketLossFractionSmoother=.9999,mr.SMOOTH_VIDEO_INTERVAL=1e3,mr.SMOOTH_AUDIO_INTERVAL=5e3;const gr=xe(),vr=xe(),yr=()=>({id:"",kind:"audio",packetLossRate:0,bitrate:0,bytes:0,packets:0,packetLoss:0,frameRate:0,rtt:0,timestamp:Date.now(),networkGrade:w.NetworkGrade.INVALID});function Oe(e,t){let r;r=9<e||100<t?w.NetworkGrade.POOR:5<e||80<t?w.NetworkGrade.FAIR:1<e||40<t?w.NetworkGrade.GOOD:w.NetworkGrade.EXCELLENT;e=navigator;return r=e.connection&&e.connection.effectiveType&&["slow-2g","2g","3g"].includes(e.connection.effectiveType)?w.NetworkGrade.POOR:r}const br={track_audio_volume:0,jitter_buffer_delay:0,bytes_sent:0,bytes_received:0},kr={nack_count:0,fir_count:0,pli_count:0,width:0,height:0,jitter_buffer_delay:0,bytes_sent:0,frame_encoded:0,bytes_received:0,frame_decoded:0},_r={frames_received:0,frames_sent:0,packets_lost:0,packets_received:0,packets_sent:0,timestamp:0,bytes_sent:0,bytes_received:0};async function Le(e){let t;try{t=await e.getStats()}catch(e){return S.debug("get media statistic stats error, fallback to default",e),[]}if(!t)return S.debug("get null media statistic stats, fallback to default"),[];const s=[...t.values()];return s.filter(e=>e.type===ke.InBoundRtp||e.type===ke.OutBoundRtp).map(t=>{{var r=t;t=s;var n,i,a,o,t={[ke.MediaSource]:t.filter(e=>e.type===ke.MediaSource).find(e=>e.id===r.mediaSourceId),[ke.Track]:t.filter(e=>e.type===ke.Track).find(e=>e.id===r.trackID),[ke.RemoteInBound]:t.filter(e=>e.type===ke.RemoteInBound).find(e=>e.id===r.remoteId)};let e=function(e,t,r){const n={id:e,track_id:t,kind:"audio",kbps:0,framerate:0,packet_lost_rate:0,rtt:0,extra_stats:null,calculation_stats:W({},_r)};return r===be.Audio?n.extra_stats=W({},br):n.extra_stats=W({},kr),n}(r.id,r.trackID,r.mediaType);return e.rtt=je(t[ke.RemoteInBound])||je(r)||0,e.calculation_stats.packets_lost=Ne(r,t[ke.RemoteInBound])||0,r.mediaType===be.Video?(e=(a=r,(o=e).kind=a.kind,o.extra_stats.nack_count=a.nackCount,o.extra_stats.fir_count=a.firCount,o.extra_stats.pli_count=a.pliCount,o.extra_stats.bytes_sent=a.bytesSent||0,o.extra_stats.frame_encoded=a.framesEncoded||0,o.extra_stats.bytes_received=a.bytesReceived||0,o.extra_stats.frame_decoded=a.framesDecoded||0,o.calculation_stats.bytes_received=a.bytesReceived||0,o.calculation_stats.bytes_sent=a.bytesSent||0,o.calculation_stats.packets_received=a.packetsReceived||0,o.calculation_stats.packets_sent=a.packetsSent||0,o.calculation_stats.timestamp=a.timestamp||0,o),t[ke.MediaSource]&&(e=(a=t[ke.MediaSource],(o=e).framerate=a.framesPerSecond,o)),t[ke.Track]&&(e=(a=t[ke.Track],(o=e).track_id=a.trackIDentifier,o.extra_stats.width=a.frameWidth,o.extra_stats.height=a.frameHeight,o.extra_stats.jitter_buffer_delay=a.jitterBufferDelay||0,o.calculation_stats.frames_sent=a.framesSent||0,o.calculation_stats.frames_received=a.framesReceived||0,o))):(e=(a=r,(o=e).kind=a.kind,o.extra_stats.bytes_sent=a.bytesSent||0,o.extra_stats.bytes_received=a.bytesReceived||0,o.extra_stats.track_audio_volume=a.audioLevel||0,o.calculation_stats.bytes_received=a.bytesReceived||0,o.calculation_stats.bytes_sent=a.bytesSent||0,o.calculation_stats.packets_received=a.packetsReceived||0,o.calculation_stats.packets_sent=a.packetsSent||0,o.calculation_stats.timestamp=a.timestamp||0,o),t[ke.MediaSource]&&(e=(n=t[ke.MediaSource],(i=e).extra_stats.track_audio_volume=n.audioLevel||0,i)),t[ke.Track]&&(e=(n=t[ke.Track],(i=e).track_id=n.trackIDentifier,i.extra_stats.jitter_buffer_delay=n.jitterBufferDelay||0,i.calculation_stats.frames_sent=n.framesSent||0,i.calculation_stats.frames_received=n.framesReceived||0,i))),e}})}function je(e){if(e)return e.roundTripTime?1e3*e.roundTripTime:e.googRtt||e.mozRtt||void 0}function Ne(e,t){return"inbound-rtp"===e.type?e.packetsLost:"outbound-rtp"===e.type&&t?t.packetsLost:void 0}function Be(e,t,r,n){t-=e,e=n-r;if(t<=0||e<=0)return 0;n=t/e;return 1<n?1:n}function Fe(){const e={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",iceServers:[]};return b.unifiedPlan?e.sdpSemantics="unified-plan":e.sdpSemantics="plan-b",new RTCPeerConnection(e)}async function Ue(t,e){const r=e.getTransceivers().find(e=>"inactive"===e.direction&&e.receiver.track.kind===t.kind);return r?(r.direction="sendonly",await r.sender.replaceTrack(t),r):await e.addTransceiver(t,{direction:"sendonly"})}async function Ve(e,t,r,n){if(b.stats){e=await async function(e,t,r){let n;try{n=await e.getStats(t)}catch(e){return S.debug("get stats error, fallback to default",e),[]}if(!n)return S.debug("get null stats, fallback to default"),[];const i=[];for(const e of n.values())if("send"===r&&"outbound-rtp"===e.type&&!e.isRemote||"recv"===r&&"inbound-rtp"===e.type&&!e.isRemote){const t=yr(),a=n.get(e.remoteId);t.packetLoss=Ne(e,a)||0,t.bytes="send"===r?e.bytesSent:e.bytesReceived,t.packets="send"===r?e.packetsSent:e.packetsReceived,t.rtt=je(e)||je(a)||0,t.id=e.id,t.kind=e.kind,e.frameWidth&&(t.width=e.frameWidth),e.frameHeight&&(t.height=e.frameHeight),e.framesPerSecond&&(t.frameRate=e.framesPerSecond),e.framerateMean&&(t.frameRate=Math.ceil(e.framerateMean)),i.push(t)}return i}(e,t,r),t=n;if(!t||0===t.length)return e;if(t.length!==e.length)return e;const i=Object.values(fe([...e,...t],"id"));return i.every(e=>2===e.length)?i.map(([e,t])=>{var r=(e.timestamp-t.timestamp)/1e3;if(r<=0)return e;const n=W({},e),i=Be(t.packetLoss,e.packetLoss,t.packets,e.packets),a=(n.networkGrade=Oe(i,n.rtt),gr(e.id,e.kind));return a.Apply(i),n.packetLossRate=a.Filtered()<0?0:a.Filtered(),n.bitrate=8*(e.bytes-t.bytes)/r,n.bitrate<0?t:n}):e}return r="not-support-stats-warning",pr[r]||(pr[r]=!0,S.warning("your browser does not support getStats")),[]}var Ge=be=be||{};Ge.Video="video",Ge.Audio="audio",(Ge=ke=ke||{}).MediaSource="media-source",Ge.Track="track",Ge.OutBoundRtp="outbound-rtp",Ge.InBoundRtp="inbound-rtp",Ge.RemoteInBound="remote-inbound-rtp",(Ge=r=r||{}).In="in",Ge.Out="out",window.addEventListener("message",e=>{if(e.origin===window.location.origin){e=e.data;if("PermissionDeniedError"===e){if(d="PermissionDeniedError",u)return void u("PermissionDeniedError");throw sr()}"qnrtc:rtcmulticonnection-extension-loaded"===e&&(d="desktop"),"rtcmulticonnection-extension-loaded"===e&&S.warning("your chrome screen sharing plugin is not the latest version, or you have other screen sharing plugins."),e.sourceId&&u&&u(c=e.sourceId,!0===e.canRequestAudioTrack)}});let c,u,d="screen";async function We(){return new Promise((e,t)=>{"desktop"!==d?(window.postMessage("qnrtc:are-you-there","*"),setTimeout(()=>{e("screen"!==d)},2e3)):e(!0)})}async function He(a,o){const s=o.source;return new Promise((r,n)=>{var e,t={mozMediaSource:s||"window",mediaSource:s||"window",height:o.height,width:o.width};if(At)r(t);else{const i={mandatory:{chromeMediaSource:d,maxWidth:rt(o.width),maxHeight:rt(o.height)},optional:[]};"desktop"!==d?r(i):a?(t=function(e,t){i.mandatory.chromeMediaSourceId=e,t&&(i.canRequestAudioTrack=!0),"PermissionDeniedError"!==e?r(i):n(sr())},c?t(c):(u=t,window.postMessage("qnrtc:audio-plus-tab","*"))):(t="screen"===s,e="window"===s,u=function(e){"PermissionDeniedError"!==(i.mandatory.chromeMediaSourceId=e)?r(i):n(sr())},t?window.postMessage("qnrtc:get-sourceId-screen","*"):e?window.postMessage("qnrtc:get-sourceId-window","*"):window.postMessage("qnrtc:get-sourceId","*"))}})}var ze=K(function(s,e){var c="__lodash_hash_undefined__",A=1,M=2,u=1/0,d=9007199254740991,D="[object Arguments]",x="[object Array]",O="[object Boolean]",L="[object Date]",j="[object Error]",l="[object Function]",h="[object GeneratorFunction]",N="[object Map]",B="[object Number]",F="[object Object]",U="[object RegExp]",V="[object Set]",G="[object String]",W="[object Symbol]",H="[object ArrayBuffer]",z="[object DataView]",f=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p=/^\w*$/,m=/^\./,g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,v=/\\(\\)?/g,y=/^\[object .+?Constructor\]$/,b=/^(?:0|[1-9]\d*)$/,t={},k=(t["[object Float32Array]"]=t["[object Float64Array]"]=t["[object Int8Array]"]=t["[object Int16Array]"]=t["[object Int32Array]"]=t["[object Uint8Array]"]=t["[object Uint8ClampedArray]"]=t["[object Uint16Array]"]=t["[object Uint32Array]"]=!0,t[D]=t[x]=t[H]=t[O]=t[z]=t[L]=t[j]=t[l]=t[N]=t[B]=t[F]=t[U]=t[V]=t[G]=t["[object WeakMap]"]=!1,"object"==typeof $e&&$e&&$e.Object===Object&&$e),r="object"==typeof self&&self&&self.Object===Object&&self,r=k||r||Function("return this")(),e=e&&!e.nodeType&&e,n=e&&s&&!s.nodeType&&s,_=n&&n.exports===e&&k.process,n=function(){try{return _&&_.binding("util")}catch(e){}}(),e=n&&n.isTypedArray;function w(e,t){return!(!e||!e.length)&&-1<function(e,t){if(t==t){for(var r=-1,n=e.length;++r<n;)if(e[r]===t)return r;return-1}for(var i=e,a=S,o=i.length,s=-1;++s<o;)if(a(i[s],s,i))return s;return-1}(e,t)}function S(e){return e!=e}function T(e,t){return e.has(t)}function J(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function q(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}function $(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var C,R,k=Array.prototype,n=Function.prototype,X=Object.prototype,i=r["__core-js_shared__"],K=(i=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Q=n.toString,E=X.hasOwnProperty,Z=X.toString,Y=RegExp("^"+Q.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),i=r.Symbol,ee=r.Uint8Array,te=X.propertyIsEnumerable,re=k.splice,ne=(C=Object.keys,R=Object,function(e){return C(R(e))}),n=Ce(r,"DataView"),ie=Ce(r,"Map"),k=Ce(r,"Promise"),ae=Ce(r,"Set"),r=Ce(r,"WeakMap"),oe=Ce(Object,"create"),se=De(n),ce=De(ie),ue=De(k),de=De(ae),le=De(r),i=i?i.prototype:void 0,he=i?i.valueOf:void 0,fe=i?i.toString:void 0;function pe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function a(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function o(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function me(e){var t=-1,r=e?e.length:0;for(this.__data__=new o;++t<r;)this.add(e[t])}function I(e){this.__data__=new a(e)}function ge(e,t){for(var r=e.length;r--;)if(Oe(e[r][0],t))return r;return-1}function ve(e,t){for(var r=0,n=(t=Ee(t,e)?[t]:_e(t)).length;null!=e&&r<n;)e=e[Me(t[r++])];return r&&r==n?e:void 0}function ye(e,t){return null!=e&&t in Object(e)}function be(e,t,r,n,i){return e===t||(null==e||null==t||!Ue(e)&&!Ve(t)?e!=e&&t!=t:function(e,t,d,l,h,r){var n=je(e),f=je(t),p=x,i=x,f=(n||(p=(p=P(e))==D?F:p),f||(i=(i=P(t))==D?F:i),p==F&&!J(e)),a=i==F&&!J(t),i=p==i;if(i&&!f)return r=r||new I,(n||He(e)?Se:function(e,t,r,n,i,a){switch(p){case z:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case H:return!(e.byteLength!=t.byteLength||!r(new ee(e),new ee(t)));case O:case L:case B:return Oe(+e,+t);case j:return e.name==t.name&&e.message==t.message;case U:case G:return e==t+"";case N:var o=q;case V:o=o||$;if(e.size!=t.size&&!(i&M))return!1;var s=a.get(e);if(s)return s==t;i|=A,a.set(e,t);s=Se(o(e),o(t),r,n,i,a);return a.delete(e),s;case W:if(he)return he.call(e)==he.call(t)}return!1})(e,t,d,l,h,r);if(!(h&M)){n=f&&E.call(e,"__wrapped__"),f=a&&E.call(t,"__wrapped__");if(n||f)return d(n?e.value():e,f?t.value():t,l,h,r=r||new I)}if(i){r=r||new I;var o=e,s=t,m=d,g=l,v=h,c=r,y=v&M,b=ze(o),k=b.length;if(k!=ze(s).length&&!y)return!1;for(var _=k;_--;){var u=b[_];if(!(y?u in s:E.call(s,u)))return!1}a=c.get(o);if(a&&c.get(s))return a==s;var w=!0;c.set(o,s),c.set(s,o);for(var S=y;++_<k;){var T,C=o[u=b[_]],R=s[u];if(!(void 0===(T=g?y?g(R,C,u,s,o,c):g(C,R,u,o,s,c):T)?C===R||m(C,R,g,v,c):T)){w=!1;break}S=S||"constructor"==u}return!w||S||(a=o.constructor)!=(n=s.constructor)&&"constructor"in o&&"constructor"in s&&!("function"==typeof a&&a instanceof a&&"function"==typeof n&&n instanceof n)&&(w=!1),c.delete(o),c.delete(s),w}return!1}(e,t,be,r,n,i))}function ke(e){return"function"==typeof e?e:null==e?Je:"object"==typeof e?je(e)?(i=e[0],a=e[1],Ee(i)&&Ie(a)?Pe(Me(i),a):function(e){var t=void 0===(t=null==e?void 0:ve(e,i))?void 0:t;return void 0===t&&t===a?null!=e&&function(e,t,r){for(var n,i=-1,a=(t=Ee(t,e)?[t]:_e(t)).length;++i<a;){var o=Me(t[i]);if(!(n=null!=e&&r(e,o)))break;e=e[o]}return n||!!(a=e?e.length:0)&&Fe(a)&&Re(o,a)&&(je(e)||Le(e))}(e,i,ye):be(a,t,void 0,A|M)}):1==(n=function(e){for(var t=ze(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Ie(i)]}return t}(r=e)).length&&n[0][2]?Pe(n[0][0],n[0][1]):function(d){return d===r||function(e,t,r){var n=t.length,i=n;if(null==d)return!i;for(e=Object(d);n--;){var a=t[n];if(a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++n<i;){var o=(a=t[n])[0],s=e[o],c=a[1];if(a[2]){if(void 0===s&&!(o in e))return!1}else{var u,o=new I;if(!(void 0===u?be(c,s,r,A|M,o):u))return!1}}return!0}(0,n)}:Ee(e=e)?(o=Me(e),function(e){return null==e?void 0:e[o]}):(t=e,function(e){return ve(e,t)});var t,r,n,i,a,o}function _e(e){return je(e)?e:Ae(e)}pe.prototype.clear=function(){this.__data__=oe?oe(null):{}},pe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},pe.prototype.get=function(e){var t,r=this.__data__;return oe?(t=r[e])===c?void 0:t:E.call(r,e)?r[e]:void 0},pe.prototype.has=function(e){var t=this.__data__;return oe?void 0!==t[e]:E.call(t,e)},pe.prototype.set=function(e,t){return this.__data__[e]=oe&&void 0===t?c:t,this},a.prototype.clear=function(){this.__data__=[]},a.prototype.delete=function(e){var t=this.__data__,e=ge(t,e);return!(e<0||(e==t.length-1?t.pop():re.call(t,e,1),0))},a.prototype.get=function(e){var t=this.__data__,e=ge(t,e);return e<0?void 0:t[e][1]},a.prototype.has=function(e){return-1<ge(this.__data__,e)},a.prototype.set=function(e,t){var r=this.__data__,n=ge(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},o.prototype.clear=function(){this.__data__={hash:new pe,map:new(ie||a),string:new pe}},o.prototype.delete=function(e){return Te(this,e).delete(e)},o.prototype.get=function(e){return Te(this,e).get(e)},o.prototype.has=function(e){return Te(this,e).has(e)},o.prototype.set=function(e,t){return Te(this,e).set(e,t),this},me.prototype.add=me.prototype.push=function(e){return this.__data__.set(e,c),this},me.prototype.has=function(e){return this.__data__.has(e)},I.prototype.clear=function(){this.__data__=new a},I.prototype.delete=function(e){return this.__data__.delete(e)},I.prototype.get=function(e){return this.__data__.get(e)},I.prototype.has=function(e){return this.__data__.has(e)},I.prototype.set=function(e,t){var r=this.__data__;if(r instanceof a){var n=r.__data__;if(!ie||n.length<199)return n.push([e,t]),this;r=this.__data__=new o(n)}return r.set(e,t),this};var we=ae&&1/$(new ae([,-0]))[1]==u?function(e){return new ae(e)}:function(){};function Se(e,t,d,r,n,i){var l=n&M,h=e.length,a=t.length;if(h!=a&&!(l&&h<a))return!1;a=i.get(e);if(a&&i.get(t))return a==t;var o=-1,s=!0,f=n&A?new me:void 0;for(i.set(e,t),i.set(t,e);++o<h;){var p,c=e[o],u=t[o];if(void 0!==(p=r?l?r(u,c,o,t,e,i):r(c,u,o,e,t,i):p)){if(p)continue;s=!1;break}if(f){if(!function(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return 1}(t,function(e,t){return!f.has(t)&&(c===e||d(c,e,r,n,i))&&f.add(t)})){s=!1;break}}else if(c!==u&&!d(c,u,r,n,i)){s=!1;break}}return i.delete(e),i.delete(t),s}function Te(e,t){var r,e=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map}function Ce(e,t){e=null==e?void 0:e[t];return!Ue(t=e)||K&&K in t||!(Be(t)||J(t)?Y:y).test(De(t))?void 0:e}var P=function(e){return Z.call(e)};function Re(e,t){return!!(t=null==t?d:t)&&("number"==typeof e||b.test(e))&&-1<e&&e%1==0&&e<t}function Ee(e,t){var r;if(!je(e))return r=typeof e,"number"==r||"symbol"==r||"boolean"==r||null==e||Ge(e)||p.test(e)||!f.test(e)||null!=t&&e in Object(t)}function Ie(e){return e==e&&!Ue(e)}function Pe(t,r){return function(e){return null!=e&&e[t]===r&&(void 0!==r||t in Object(e))}}(n&&P(new n(new ArrayBuffer(1)))!=z||ie&&P(new ie)!=N||k&&"[object Promise]"!=P(k.resolve())||ae&&P(new ae)!=V||r&&"[object WeakMap]"!=P(new r))&&(P=function(e){var t=Z.call(e),e=t==F?e.constructor:void 0,e=e?De(e):void 0;if(e)switch(e){case se:return z;case ce:return N;case ue:return"[object Promise]";case de:return V;case le:return"[object WeakMap]"}return t});var Ae=xe(function(e){e=null==e?"":function(e){if("string"==typeof e)return e;if(Ge(e))return fe?fe.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}(e);var i=[];return m.test(e)&&i.push(""),e.replace(g,function(e,t,r,n){i.push(r?n.replace(v,"$1"):t||e)}),i});function Me(e){if("string"==typeof e||Ge(e))return e;var t=e+"";return"0"==t&&1/e==-u?"-0":t}function De(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function xe(n,i){if("function"!=typeof n||i&&"function"!=typeof i)throw new TypeError("Expected a function");function a(){var e=arguments,t=i?i.apply(this,e):e[0],r=a.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),a.cache=r.set(t,e),e)}return a.cache=new(xe.Cache||o),a}function Oe(e,t){return e===t||e!=e&&t!=t}function Le(e){return Ve(e)&&Ne(e)&&E.call(e,"callee")&&(!te.call(e,"callee")||Z.call(e)==D)}xe.Cache=o;var je=Array.isArray;function Ne(e){return null!=e&&Fe(e.length)&&!Be(e)}function Be(e){e=Ue(e)?Z.call(e):"";return e==l||e==h}function Fe(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=d}function Ue(e){var t=typeof e;return e&&("object"==t||"function"==t)}function Ve(e){return!!e&&"object"==typeof e}function Ge(e){return"symbol"==typeof e||Ve(e)&&Z.call(e)==W}var We,He=e?(We=e,function(e){return We(e)}):function(e){return Ve(e)&&Fe(e.length)&&!!t[Z.call(e)]};function ze(e){return(Ne(e)?function(e,t){var r,n=je(e)||Le(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=n.length,a=!!i;for(r in e)!t&&!E.call(e,r)||a&&("length"==r||Re(r,i))||n.push(r);return n}:function(e){if(e!==("function"==typeof(t=e&&e.constructor)&&t.prototype||X))return ne(e);var t,r,n=[];for(r in Object(e))E.call(e,r)&&"constructor"!=r&&n.push(r);return n})(e)}function Je(e){return e}s.exports=function(e,d){if(e&&e.length){var t=e,r=ke(d),n=-1,i=w,a=t.length,l=!0,o=[],s=o;if(void 0,200<=a){e=r?null:we(t);if(e)return $(e);l=!1,i=T,s=new me}else s=r?[]:o;e:for(;++n<a;){var c=t[n],u=r?r(c):c,c=0!==c?c:0;if(l&&u==u){for(var h=s.length;h--;)if(s[h]===u)continue e;r&&s.push(u),o.push(c)}else i(s,u,void 0)||(s!==o&&s.push(u),o.push(c))}return o}return[]}});class wr{constructor(e,t){this.tracks=[],this.publishedTrackInfo=[],this.userID=e,this.userData=t}get published(){return 0<this.publishedTrackInfo.length}addTracks(t){this.tracks=this.tracks.concat(t),this.tracks=ze(this.tracks,"mediaTrack");for(const t of this.tracks)t.once("release",()=>{ie(this.tracks,e=>e===t)})}removeTracksByTrackId(t){ie(this.tracks,e=>!!e.info.trackID&&-1!==t.indexOf(e.info.trackID))}addPublishedTrackInfo(e){this.publishedTrackInfo=this.publishedTrackInfo.concat(e),this.publishedTrackInfo=ze(this.publishedTrackInfo,"trackID")}removePublishedTrackInfo(t){ie(this.publishedTrackInfo,e=>-1!==t.indexOf(e.trackID))}}function Je(e){const t=document.createElement("audio"),r=new MediaStream([e]);return t.style.visibility="hidden",t.className="qnrtc-audio-player qnrtc-stream-player",t.dataset.localid=e.id,t.srcObject=r,t.autoplay=!0,t}function qe(e){const t=document.createElement("video"),r=new MediaStream([e]);return t.style.width="100%",t.style.height="100%",t.style.objectFit="contain",t.muted=!0,t.className="qnrtc-video-player qnrtc-stream-player",t.dataset.localid=e.id,t.setAttribute("playsinline",!0),t.autoplay=!0,t.srcObject=r,Dt&&(t.setAttribute("controls",!0),Re(()=>{t&&t.srcObject&&t.removeAttribute("controls")})),t}class Sr extends e{safeEmit(e,...t){try{this.emit(e,...t)}catch(t){S.warning("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}safeEmitAsPromise(r,...n){return new Promise((e,t)=>{this.safeEmit(r,...n,e,e=>{S.warning("safeEmitAsPromise() | errback called [event:%s]:%o",r,e),t(e)})})}}class Tr extends Sr{constructor(e,t,r,n){super(),this.master=!1,this.stats=[],this.isReplacedByImageTrack=!1,this.direction="local",this.sourceType=w.TrackSourceType.NORMAL,this.onended=e=>{S.warning("track ended",this.mediaTrack,this.info.trackID),"local"===this.direction?this.emit("ended",e):this.emit("@ended",e)},this.mediaTrack=e,this.mediaTrack.addEventListener("ended",this.onended),this.userID=t,r&&(this.direction=r),this.info={kind:e.kind,muted:!e.enabled,userID:this.userID,versionid:0,profiles:n||[]},this.handleMediaPause=this.handleMediaPause.bind(this)}play(e,t){S.log(`track play: trackID: ${this.info.trackID}, kind: `+this.info.kind),this.removeMediaElement();const r="video"===this.info.kind?qe:Je;this.mediaElement=r(this.mediaTrack),this.mediaElement.addEventListener("pause",this.handleMediaPause),"audio"===this.info.kind&&t&&(this.mediaElement.muted=!0),e.appendChild(this.mediaElement),this.mediaElement.play().catch(Ae)}handleMediaPause(){setTimeout(()=>this.mediaElement.play().catch(Ae),900)}switchPlayingTrack(){if(this.mediaElement){if(this.isReplacedByImageTrack&&this.imageStreamTrack)this.mediaElement.srcObject=new MediaStream([this.imageStreamTrack.mediaTrack]);else{if(this.isReplacedByImageTrack||!this.mediaTrack)return;this.mediaElement.srcObject=new MediaStream([this.mediaTrack])}this.mediaElement.paused||this.mediaElement.play().catch(Ae)}}resume(e){var t;this.mediaTrack.removeEventListener("ended",this.onended),this.mediaTrack.stop(),this.mediaTrack=e,this.mediaTrack.addEventListener("ended",this.onended),this.mediaElement&&(t=new MediaStream([e]),this.mediaElement.dataset.localid=e.id,this.mediaElement.srcObject=t),this.removeEvent("@get-stats"),this.resetStats()}getStats(){return this.statsInterval||this.startGetStatsInterval(),this.stats}getCurrentFrameDataURL(){if(this.mediaElement&&this.mediaElement instanceof HTMLVideoElement){var e=this.mediaElement;const t=document.createElement("canvas"),r=(t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d"));return r?(r.drawImage(e,0,0,e.videoWidth,e.videoHeight),t.toDataURL()):"data:,"}return"data:,"}setMaster(e){this.master=e}setMute(e){this.info.muted=e,this.mediaTrack.enabled=!e,this.emit("mute",e)}setKbps(e){this.info.kbps=e}setInfo(e){this.info=W({},this.info,e)}removeMediaElement(){this.mediaElement&&(this.mediaElement.removeEventListener("pause",this.handleMediaPause),this.mediaElement.remove(),this.mediaElement=void 0)}release(){this.emit("release"),this.removeEvent(),this.statsInterval&&window.clearInterval(this.statsInterval),"local"!==this.direction&&b.unifiedPlan||this.mediaTrack.stop(),this.removeMediaElement(),this.imageStreamTrack&&(this.imageStreamTrack.release(),this.imageStreamTrack=void 0)}reset(){this.info.trackID=void 0,this.info.userID=void 0,this.info.versionid=0,this.userID=void 0,this.resetStats()}resetStats(){this.stats=[],this.lastStats=[]}async startGetStatsInterval(){this.statsInterval=window.setInterval(async()=>{var e=this.getListeners("@get-stats");if(!e||0===e.length)return[];this.stats=await this.safeEmitAsPromise("@get-stats",this.lastStats),this.lastStats=[...this.stats]},1e3)}setVolume(e){S.warning("not implement")}getCurrentTimeDomainData(){return S.warning("not implement"),new Uint8Array}getCurrentFrequencyData(){return S.warning("not implement"),new Uint8Array}getVolume(){return S.warning("not implement"),0}getCurrentVolumeLevel(){return S.warning("not implement"),0}setLoop(e){S.warning("not implement")}startAudioSource(){S.warning("not implement")}pauseAudioSource(){S.warning("not implement")}resumeAudioSource(){S.warning("not implement")}stopAudioSource(){S.warning("not implement")}getCurrentTime(){return S.warning("not implement"),0}setCurrentTime(e){S.warning("not implement")}getDuration(){return S.warning("not implement"),0}}function Xe(e){return{timestamp:e.msgts,data:e.text,userID:e.playerid,type:e.type}}function Ke(e){return{trackID:e.trackid,tag:e.tag,mid:e.mid||void 0,kind:e.kind,userID:e.playerid,muted:e.muted,versionid:e.versionid,profiles:e.profiles||[]}}function Qe(e,t){return{trackid:e.trackID,mid:e.mid||void 0,kind:e.kind,master:t,muted:!!e.muted,playerid:e.userID,tag:e.tag||"",versionid:e.versionid}}function Ze(e){if(!e.info.mid&&b.unifiedPlan)throw C("can not find track mid!");return{localid:e.mediaTrack.id,localmid:e.info.mid||void 0,master:e.master,kind:e.info.kind,kbps:e.info.kbps,tag:e.info.tag}}function Ye(e){return new wr(e.playerid,e.playerdata)}function et(e,t,r){let n;return"audio"===e.kind?(n=new Ur(e)).initAudioManager(!0):n=new Tr(e),r&&n.setKbps(r),n.setInfo({tag:t}),n}function tt(e){switch(e){case"window":return"application";case"screen":return["window","monitor"];default:return}}const Cr=e=>{e=function(t){return b.minMaxWithIdeal||["video","screen"].forEach(e=>{"object"==typeof t[e]&&"object"==typeof t[e].width&&t[e].width.ideal&&delete t[e].width.ideal,"object"==typeof t[e]&&"object"==typeof t[e].height&&t[e].height.ideal&&delete t[e].height.ideal}),t}(Ce(e));return 0===Object.keys(e.audio).length&&"boolean"!=typeof e.audio&&(e.audio=!0),0===Object.keys(e.video).length&&"boolean"!=typeof e.video&&(e.video=!0),e};function rt(e){if(e)return"number"==typeof e?e:e.exact||e.max||e.ideal||e.min||void 0}var nt,it=K(function(e){var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s",t=(t+=null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v");return null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return(t=(t=(t+=null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":""))+(null!=e.rateNumerator?" rate=%s":""))+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})}),r=(it.v,it.o,it.s,it.i,it.u,it.e,it.p,it.z,it.r,it.t,it.c,it.b,it.m,it.a,K(function(e,t){function p(e){return String(Number(e))===e?Number(e):e}function r(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=p(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e}var n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},h=[],f=t;return e.split(/(\r\n|\r|\n)/).filter(n).forEach(function(e){var t=e[0],d=e.slice(2);"m"===t&&(h.push({rtp:[],fmtp:[]}),f=h[h.length-1]);for(var r=0;r<(it[t]||[]).length;r+=1){var n=it[t][r];if(n.reg.test(d)){var i=f;var a=d;var o=n.name&&n.names,o=(n.push&&!i[n.push]?i[n.push]=[]:o&&!i[n.name]&&(i[n.name]={}),n.push?{}:o?i[n.name]:i),s=a.match(n.reg),l=o,c=n.names,a=n.name;if(a&&!c)l[a]=p(s[1]);else for(var u=0;u<c.length;u+=1)null!=s[u+1]&&(l[c[u]]=p(s[u+1]));n.push&&i[n.push].push(o);return}}}),t.media=h,t};t.parseParams=function(e){return e.split(/;\s?/).reduce(r,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(p),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(r,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=p(e):(t=p(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}})),at=(r.parse,r.parseParams,r.parseFmtpConfig,r.parsePayloads,r.parseRemoteCandidates,r.parseImageAttributes,r.parseSimulcastStreamList,/%[sdv%]/g),ot=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var a=t.names[i];t.name?n.push(r[t.name][a]):n.push(r[t.names[i]])}else n.push(r[t.name]);return function(e){var r=1,n=arguments,i=n.length;return e.replace(at,function(e){if(i<=r)return e;var t=n[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,n)},st=["v","o","s","i","u","e","p","c","b","t","r","z","a"],ct=["i","c","b","a"],ut={write:function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||st,n=t.innerOrder||ct,i=[];return r.forEach(function(r){it[r].forEach(function(t){t.name in e&&null!=e[t.name]?i.push(ot(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){i.push(ot(r,t,e))})})}),e.media.forEach(function(e){i.push(ot("m",it.m[0],e)),n.forEach(function(r){it[r].forEach(function(t){t.name in e&&null!=e[t.name]?i.push(ot(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){i.push(ot(r,t,e))})})})}),i.join("\r\n")+"\r\n"},parse:r.parse,parseParams:r.parseParams,parseFmtpConfig:r.parseFmtpConfig,parsePayloads:r.parsePayloads,parseRemoteCandidates:r.parseRemoteCandidates,parseImageAttributes:r.parseImageAttributes,parseSimulcastStreamList:r.parseSimulcastStreamList};const Rr="qiniu-rtc-client";function dt(e){return e.map(e=>{const t={component:1,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,transport:e.protocol,type:e.type};return e.tcpType&&(t.tcptype=e.tcpType),t})}class Er{constructor(e,t){this.lastSubMids=[],this.sessionVersion=0,this.direction=e,this.extendedRtpCapabilities=t}get transportRemoteParameters(){return this._transportRemoteParameters}async setTransportRemoteParameters(e){for(const t of e.iceCandidates)t.ip=await De(t.ip);this._transportRemoteParameters=e}createRemoteAnswer(e){if(!this.transportRemoteParameters)throw C("no transportRemoteParameters!");return(b.unifiedPlan?function(e,t,r){const n=ut.parse(r),i=(n.media||[]).filter(e=>e.hasOwnProperty("mid")).map(e=>String(e.mid)),a={version:0};a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344376",sessionVersion:2,username:Rr},a.name="-",a.timing={start:0,stop:0},a.icelite=t.iceParameters.iceLite?"ice-lite":void 0,a.msidSemantic={semantic:"WMS",token:"*"},0<i.length&&(a.groups=[{type:"BUNDLE",mids:i.join(" ")}]),a.media=[],a.fingerprint={type:t.dtlsParameters.fingerprints[0].algorithm,hash:t.dtlsParameters.fingerprints[0].value};for(const r of n.media){r.direction;const n=r.type,i="audio"===n?e.codecs[0]:e.codecs[1],o=e.headerExtensions.filter(e=>e.kind===n),s={type:r.type,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},mid:r.mid,iceUfrag:t.iceParameters.usernameFragment,icePwd:t.iceParameters.password,candidates:dt(t.iceCandidates),endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===t.dtlsParameters.role?"actpass":"active",direction:"sendonly"===r.direction||"sendrecv"===r.direction?"recvonly":"inactive",rtp:[{payload:i.sendPayloadType,codec:i.name,rate:i.clockRate,encoding:1<i.channels?i.channels:void 0}],rtcpFb:[],fmtp:[{payload:i.sendPayloadType,config:Object.keys(i.parameters).map(e=>`${e}=${i.parameters[e]};`).join("")}],payloads:i.sendPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ext:o.map(e=>({uri:e.uri,value:e.sendId}))};i.rtcpFeedback&&0<i.rtcpFeedback.length&&i.rtcpFeedback.forEach(e=>{s.rtcpFb.push({payload:i.sendPayloadType,type:e.type,subtype:e.parameter})}),i.sendRtxPayloadType&&(s.rtp.push({payload:i.sendRtxPayloadType,codec:"rtx",rate:i.clockRate,encoding:1<i.channels?i.channels:void 0}),s.fmtp.push({payload:i.sendRtxPayloadType,config:`apt=${i.sendPayloadType};`}),s.payloads=i.sendPayloadType+" "+i.sendRtxPayloadType),a.media.push(s)}return ut.write(a)}:function(e,t,r){const n=ut.parse(r),i=(n.version=0,n.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344376",sessionVersion:2,username:Rr},n.name="-",n.timing={start:0,stop:0},n.icelite=t.iceParameters.iceLite?"ice-lite":void 0,n.msidSemantic={semantic:"WMS",token:"*"},n.fingerprint={type:t.dtlsParameters.fingerprints[0].algorithm,hash:t.dtlsParameters.fingerprints[0].value},[]);for(const r of n.media){const n=r.type,a=e.codecs.find(e=>e.kind===n),o=(e.headerExtensions||[]).filter(e=>e.kind===n);if(!a)throw C("can not find codec"+n);const s={type:n,mid:n,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},iceUfrag:t.iceParameters.usernameFragment,icePwd:t.iceParameters.password,candidates:dt(t.iceCandidates),endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===t.dtlsParameters.role?"actpass":"active",direction:"recvonly",rtp:[{payload:a.sendPayloadType,codec:a.name,rate:a.clockRate,encoding:1<a.channels?a.channels:void 0}],rtcpFb:[],fmtp:[{payload:a.sendPayloadType,config:Object.keys(a.parameters).map(e=>`${e}=${a.parameters[e]};`).join("")}],payloads:a.sendPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ext:o.map(e=>({uri:e.uri,value:e.sendId}))};a.rtcpFeedback&&0<a.rtcpFeedback.length&&a.rtcpFeedback.forEach(e=>{s.rtcpFb.push({payload:a.sendPayloadType,type:e.type,subtype:e.parameter})}),a.sendRtxPayloadType&&(s.rtp.push({payload:a.sendRtxPayloadType,codec:"rtx",rate:a.clockRate,encoding:1<a.channels?a.channels:void 0}),s.fmtp.push({payload:a.sendRtxPayloadType,config:`apt=${a.sendPayloadType};`}),s.payloads=a.sendPayloadType+" "+a.sendRtxPayloadType),i.push(s)}return n.media=i,ut.write(n)})(this.extendedRtpCapabilities,this.transportRemoteParameters,e)}createRemoteOffer(d){if(!this.transportRemoteParameters)throw C("no transportRemoteParameters!");if(b.unifiedPlan){const p=function(e,t){let r=[];for(const n of t){const t=ie(e,e=>e.mid===n)[0];t&&r.push(t)}return t=(r=r.concat(e)).map(e=>e.mid),r}(d,this.lastSubMids);this.lastSubMids=p.map(e=>e.mid),this.sessionVersion+=1;{var t=p;var l=this.extendedRtpCapabilities;var e=this.transportRemoteParameters;var r=this.sessionVersion;S.debug("consumerInfos",t);const a={},m=t.map(e=>e.mid);a.version=0,a.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344377",sessionVersion:r,username:Rr},a.name="-",a.timing={start:0,stop:0},a.icelite=e.iceParameters.iceLite?"ice-lite":void 0,a.msidSemantic={semantic:"WMS",token:"*"},0<m.length&&(a.groups=[{type:"BUNDLE",mids:m.join(" ")}]),a.media=[],a.fingerprint={type:e.dtlsParameters.fingerprints[0].algorithm,hash:e.dtlsParameters.fingerprints[0].value};for(const r of t){const t="audio"===r.kind?l.codecs[0]:l.codecs[1],m=l.headerExtensions.filter(e=>e.kind===r.kind),o={type:r.kind,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},mid:r.mid,msid:r.streamId+" "+r.trackID,iceUfrag:e.iceParameters.usernameFragment,icePwd:e.iceParameters.password,candidates:dt(e.iceCandidates),endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===e.dtlsParameters.role?"actpass":"active",direction:r.closed?"inactive":"sendonly",rtp:[{payload:t.recvPayloadType,codec:t.name,rate:t.clockRate,encoding:1<t.channels?t.channels:void 0}],rtcpFb:[],fmtp:[{payload:t.recvPayloadType,config:Object.keys(t.parameters).map(e=>`${e}=${t.parameters[e]};`).join("")}],payloads:t.recvPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ext:r.closed?[]:m.map(e=>({uri:e.uri,value:e.recvId})),ssrcs:!r.closed&&r.ssrc?[{id:r.ssrc,attribute:"cname",value:r.cname}]:[],ssrcGroups:[]};t.rtcpFeedback&&0<t.rtcpFeedback.length&&t.rtcpFeedback.forEach(e=>{o.rtcpFb.push({payload:t.recvPayloadType,type:e.type,subtype:e.parameter})}),t.recvRtxPayloadType&&(o.rtp.push({payload:t.recvRtxPayloadType,codec:"rtx",rate:t.clockRate,encoding:1<t.channels?t.channels:void 0}),o.fmtp.push({payload:t.recvRtxPayloadType,config:`apt=${t.recvPayloadType};`}),o.payloads=t.recvPayloadType+" "+t.recvRtxPayloadType),r.rtxSsrc&&!r.closed&&(o.ssrcs=o.ssrcs.concat([{id:r.rtxSsrc,attribute:"cname",value:r.cname}]),o.ssrcGroups.push({semantics:"FID",ssrcs:r.ssrc+" "+r.rtxSsrc})),a.media.push(o)}return ut.write(a)}}{const g=new Set;d.forEach(e=>g.add(e.kind)),0===d.length&&(g.add("audio"),g.add("video"));{var h=Array.from(g);var n=d;var f=this.extendedRtpCapabilities;var i=this.transportRemoteParameters;h=["audio","video"];const s={version:0};s.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"5975129998295344377",sessionVersion:2,username:Rr},s.name="-",s.timing={start:0,stop:0},s.icelite=i.iceParameters.iceLite?"ice-lite":void 0,s.msidSemantic={semantic:"WMS",token:"*"},s.groups=[{type:"BUNDLE",mids:h.join(" ")}],s.media=[],s.fingerprint={type:i.dtlsParameters.fingerprints[0].algorithm,hash:i.dtlsParameters.fingerprints[0].value};for(const v of h){const h=n.filter(e=>e.kind===v),c=f.codecs.find(e=>e.kind===v),y=(f.headerExtensions||[]).filter(e=>e.kind===v);if(!c)throw C("no codec"+v);const u={type:v,port:7,protocol:"RTP/SAVPF",connection:{ip:"127.0.0.1",version:4},mid:v,iceUfrag:i.iceParameters.usernameFragment,icePwd:i.iceParameters.password,candidates:dt(i.iceCandidates),endOfCandidates:"end-of-candidates",iceOptions:"renomination",setup:"server"===i.dtlsParameters.role?"actpass":"active",direction:"sendonly",rtp:[{payload:c.recvPayloadType,codec:c.name,rate:c.clockRate,encoding:1<c.channels?c.channels:void 0}],rtcpFb:[],fmtp:[{payload:c.recvPayloadType,config:Object.keys(c.parameters).map(e=>`${e}=${c.parameters[e]};`).join("")}],payloads:c.recvPayloadType,rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",ssrcs:[],ssrcGroups:[],ext:y.map(e=>({uri:e.uri,value:e.recvId}))};c.rtcpFeedback&&0<c.rtcpFeedback.length&&c.rtcpFeedback.forEach(e=>{u.rtcpFb.push({payload:c.recvPayloadType,type:e.type,subtype:e.parameter})}),c.recvRtxPayloadType&&(u.rtp.push({payload:c.recvRtxPayloadType,codec:"rtx",rate:c.clockRate,encoding:1<c.channels?c.channels:void 0}),u.fmtp.push({payload:c.recvRtxPayloadType,config:`apt=${c.recvPayloadType};`}),u.payloads=c.recvPayloadType+" "+c.recvRtxPayloadType);for(const n of h)u.ssrcs.push({id:n.ssrc,attribute:"msid",value:n.streamId+" "+n.trackID}),u.ssrcs.push({id:n.ssrc,attribute:"mslabel",value:""+n.streamId}),u.ssrcs.push({id:n.ssrc,attribute:"label",value:""+n.trackID}),u.ssrcs.push({id:n.ssrc,attribute:"cname",value:""+n.cname}),n.rtxSsrc&&(u.ssrcGroups.push({semantics:"FID",ssrcs:n.ssrc+" "+n.rtxSsrc}),u.ssrcs.push({id:n.rtxSsrc,attribute:"msid",value:n.streamId+" "+n.trackID}),u.ssrcs.push({id:n.rtxSsrc,attribute:"mslabel",value:""+n.streamId}),u.ssrcs.push({id:n.rtxSsrc,attribute:"label",value:""+n.trackID}),u.ssrcs.push({id:n.rtxSsrc,attribute:"cname",value:""+n.cname}));s.media.push(u)}return ut.write(s);return}}}async updateICEData(e,t){if(this.transportRemoteParameters){for(const e of t)e.ip=await De(e.ip);this.transportRemoteParameters.iceCandidates=t,this.transportRemoteParameters.iceParameters=e}}}function lt(t,s){const e=ut.parse(t),r=(s&&"chrome"===l.name&&(e.media=e.media.map(e=>{if(!e.ssrcGroups||0===e.ssrcGroups.length||!e.ssrcs||0===e.ssrcs.length)return e;const t=e.ssrcGroups.find(e=>"FID"===e.semantics);if(!t)return e;var[r,n]=t.ssrcs.split(" ").map(e=>parseInt(e,10));let i,a;e.ssrcs.forEach(e=>{"cname"===e.attribute&&(i=e.value),"msid"===e.attribute&&(a=e.value)});const o=[];if(o.push(r),2<=s){const s=r+1,t=n+1;e.ssrcs.push({id:s,attribute:"cname",value:i}),e.ssrcs.push({id:s,attribute:"msid",value:a}),e.ssrcs.push({id:t,attribute:"cname",value:i}),e.ssrcs.push({id:t,attribute:"msid",value:a}),e.ssrcGroups.push({semantics:"FID",ssrcs:s+" "+t}),o.push(s)}if(3<=s){const s=r+2,t=n+2;e.ssrcs.push({id:s,attribute:"cname",value:i}),e.ssrcs.push({id:s,attribute:"msid",value:a}),e.ssrcs.push({id:t,attribute:"cname",value:i}),e.ssrcs.push({id:t,attribute:"msid",value:a}),e.ssrcGroups.push({semantics:"FID",ssrcs:s+" "+t}),o.push(s)}return e.ssrcGroups.push({semantics:"SIM",ssrcs:o.join(" ")}),e})),ut.write(e).split("\r\n"));let n=r.findIndex(e=>0===e.indexOf("a=ssrc-group:FID"));for(;-1!==n&&0===r[n].indexOf("a=ssrc-group:FID");){const t=r[n].split(" ")[2];for(let e=n-1;0<=e;e--)if(0<r[e].indexOf(t)){r.splice(e+1,0,r[n]),r.splice(n+1,1);break}n++}return r.join("\r\n")}(Ge=K(function(e){!function r(n,i,a){function o(t,e){if(!i[t]){if(!n[t]){if(!e&&X)return X();if(s)return s(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e=i[t]={exports:{}};n[t][0].call(e.exports,function(e){return o(n[t][1][e]||e)},e,e.exports,r,n,i,a)}return i[t].exports}for(var s=X,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,t,r){e=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});t.exports=e},{"./adapter_factory.js":2}],2:[function(e,n,t){Object.defineProperty(t,"__esModule",{value:!0}),t.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=a.log,n=a.detectBrowser(e),i={browserDetails:n,commonShim:d,extractVersion:a.extractVersion,disableLog:a.disableLog,disableWarnings:a.disableWarnings};switch(n.browser){case"chrome":if(!o||!o.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=o,d.shimAddIceCandidateNullOrEmpty(e,n),o.shimGetUserMedia(e,n),o.shimMediaStream(e,n),o.shimPeerConnection(e,n),o.shimOnTrack(e,n),o.shimAddTrackRemoveTrack(e,n),o.shimGetSendersWithDtmf(e,n),o.shimGetStats(e,n),o.shimSenderReceiverGetStats(e,n),o.fixNegotiationNeeded(e,n),d.shimRTCIceCandidate(e,n),d.shimConnectionState(e,n),d.shimMaxMessageSize(e,n),d.shimSendThrowTypeError(e,n),d.removeExtmapAllowMixed(e,n);break;case"firefox":if(!c||!c.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=c,d.shimAddIceCandidateNullOrEmpty(e,n),c.shimGetUserMedia(e,n),c.shimPeerConnection(e,n),c.shimOnTrack(e,n),c.shimRemoveStream(e,n),c.shimSenderGetStats(e,n),c.shimReceiverGetStats(e,n),c.shimRTCDataChannel(e,n),c.shimAddTransceiver(e,n),c.shimGetParameters(e,n),c.shimCreateOffer(e,n),c.shimCreateAnswer(e,n),d.shimRTCIceCandidate(e,n),d.shimConnectionState(e,n),d.shimMaxMessageSize(e,n),d.shimSendThrowTypeError(e,n);break;case"edge":if(!s||!s.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),i;r("adapter.js shimming edge."),(i.browserShim=s).shimGetUserMedia(e,n),s.shimGetDisplayMedia(e,n),s.shimPeerConnection(e,n),s.shimReplaceTrack(e,n),d.shimMaxMessageSize(e,n),d.shimSendThrowTypeError(e,n);break;case"safari":if(!u||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=u,d.shimAddIceCandidateNullOrEmpty(e,n),u.shimRTCIceServerUrls(e,n),u.shimCreateOfferLegacy(e,n),u.shimCallbacksAPI(e,n),u.shimLocalStreamsAPI(e,n),u.shimRemoteStreamsAPI(e,n),u.shimTrackEventTransceiver(e,n),u.shimGetUserMedia(e,n),u.shimAudioContext(e,n),d.shimRTCIceCandidate(e,n),d.shimMaxMessageSize(e,n),d.shimSendThrowTypeError(e,n),d.removeExtmapAllowMixed(e,n);break;default:r("Unsupported browser!")}return i};var a=r(e("./utils")),o=r(e("./chrome/chrome_shim")),s=r(e("./edge/edge_shim")),c=r(e("./firefox/firefox_shim")),u=r(e("./safari/safari_shim")),d=r(e("./common_shim"));function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":12,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11}],3:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=e("./getusermedia"),i=(Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}}),e("./getdisplaymedia")),o=(Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(a){var e;"object"!==(void 0===a?"undefined":s(a))||!a.RTCPeerConnection||"ontrack"in a.RTCPeerConnection.prototype?o.wrapPeerConnectionEvent(a,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}):(Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0}),e=a.RTCPeerConnection.prototype.setRemoteDescription,a.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(t){var e=a.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track},r=new Event("track");r.track=t.track,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)}),n.stream.getTracks().forEach(function(t){var e=a.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t},r=new Event("track");r.track=t,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)})},r.shimGetSendersWithDtmf=function(e){var n,i,t,r,a,o;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype?(n=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}},e.RTCPeerConnection.prototype.getSenders||(e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},i=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addTrack=function(e,t){var r=i.apply(this,arguments);return r||(r=n(this,e),this._senders.push(r)),r},t=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(e){t.apply(this,arguments);e=this._senders.indexOf(e);-1!==e&&this._senders.splice(e,1)}),r=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(function(e){t._senders.push(n(t,e))})},a=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){var r=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach(function(t){var e=r._senders.find(function(e){return e.track===t});e&&r._senders.splice(r._senders.indexOf(e),1)})}):"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&(o=e.RTCPeerConnection.prototype.getSenders,e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=o.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}}))},r.shimGetStats=function(e){var o;e.RTCPeerConnection&&(o=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){var r=this,e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],e=e[2];if(0<arguments.length&&"function"==typeof t)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof t))return o.apply(this,[]);function i(e){var n={};return e.result().forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){r[e]=t.stat(e)}),n[r.id]=r}),n}function a(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))}return 2<=arguments.length?o.apply(this,[function(e){n(a(i(e)))},t]):new Promise(function(t,e){o.apply(r,[function(e){t(a(i(e)))},e])}).then(n,e)})},r.shimSenderReceiverGetStats=function(e){var r,t,n,a;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver&&("getStats"in e.RTCRtpSender.prototype||((r=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return o.filterStats(e,t.track,!0)})}),"getStats"in e.RTCRtpReceiver.prototype||((n=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return o.filterStats(e,t.track,!1)})}),"getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype&&(a=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){var t,r,n,i;return 0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack?(t=arguments[0],i=n=r=void 0,this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))):a.apply(this,arguments)}))},r.shimAddTrackRemoveTrackWithNative=u,r.shimAddTrackRemoveTrack=function(i,e){if(i.RTCPeerConnection){if(i.RTCPeerConnection.prototype.addTrack&&65<=e.version)return u(i);var r=i.RTCPeerConnection.prototype.getLocalStreams,n=(i.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})},i.RTCPeerConnection.prototype.addStream),t=(i.RTCPeerConnection.prototype.addStream=function(e){var t,r=this;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[e.id]||(t=new i.MediaStream(e.getTracks()),this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t),n.apply(this,[e])},i.RTCPeerConnection.prototype.removeStream),a=(i.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[(this._streams[e.id]||e).id],delete this._streams[e.id]},i.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var n=this._streams[e.id];return n?(n.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})):(n=new i.MediaStream([t]),this._streams[e.id]=n,this._reverseStreams[n.id]=e,this.addStream(n)),this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var n=i.RTCPeerConnection.prototype[e],t=c({},e,function(){var t=this,r=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(e){e=s(t,e);r[0].apply(null,[e])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(e){return s(t,e)})});i.RTCPeerConnection.prototype[e]=t[e]}),i.RTCPeerConnection.prototype.setLocalDescription),o=(i.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=(r=this,n=(e=arguments[0]).sdp,Object.keys(r._reverseStreams||[]).forEach(function(e){var e=r._reverseStreams[e],t=r._streams[e.id];n=n.replace(new RegExp(e.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:n}))),a.apply(this,arguments);var r,e,n},Object.getOwnPropertyDescriptor(i.RTCPeerConnection.prototype,"localDescription"));Object.defineProperty(i.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=o.get.apply(this);return""===e.type?e:s(this,e)}}),i.RTCPeerConnection.prototype.removeTrack=function(t){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(e){r._streams[e].getTracks().find(function(e){return t.track===e})&&(n=r._streams[e])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(r,e){var n=e.sdp;return Object.keys(r._reverseStreams||[]).forEach(function(e){var e=r._reverseStreams[e],t=r._streams[e.id];n=n.replace(new RegExp(t.id,"g"),e.id)}),new RTCSessionDescription({type:e.type,sdp:n})}},r.shimPeerConnection=function(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=n.RTCPeerConnection.prototype[e],r=c({},e,function(){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});n.RTCPeerConnection.prototype[e]=r[e]})},r.fixNegotiationNeeded=function(e,r){o.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if(!(r.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")));function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var n=e.RTCPeerConnection.prototype.addTrack,i=(e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(r)&&this._shimmedLocalStreams[t.id].push(r):this._shimmedLocalStreams[t.id]=[t,r],r},e.RTCPeerConnection.prototype.addStream),t=(e.RTCPeerConnection.prototype.addStream=function(e){var r=this,t=(this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),this.getSenders()),n=(i.apply(this,arguments),this.getSenders().filter(function(e){return-1===t.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(n)},e.RTCPeerConnection.prototype.removeStream),a=(e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)},e.RTCPeerConnection.prototype.removeTrack);e.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=n._shimmedLocalStreams[e].indexOf(r);-1!==t&&n._shimmedLocalStreams[e].splice(t,1),1===n._shimmedLocalStreams[e].length&&delete n._shimmedLocalStreams[e]}),a.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(a,e){a.navigator.mediaDevices&&"getDisplayMedia"in a.navigator.mediaDevices||a.navigator.mediaDevices&&("function"==typeof e?a.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(function(e){var t=i.video&&i.video.width,r=i.video&&i.video.height,n=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:n||3}},t&&(i.video.mandatory.maxWidth=t),r&&(i.video.mandatory.maxHeight=r),a.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=(r.shimGetUserMedia=function(e,t){var o,n,i,r,s=e&&e.navigator;s.mediaDevices&&(o=function(i){if("object"!==(void 0===i?"undefined":c(i))||i.mandatory||i.optional)return i;var a={};return Object.keys(i).forEach(function(t){var r,n,e;"require"!==t&&"advanced"!==t&&"mediaSource"!==t&&(void 0!==(r="object"===c(i[t])?i[t]:{ideal:i[t]}).exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact),n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t},void 0!==r.ideal&&(a.optional=a.optional||[],e={},"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,a.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,a.optional.push(e)),void 0!==r.exact&&"number"!=typeof r.exact?(a.mandatory=a.mandatory||{},a.mandatory[n("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(a.mandatory=a.mandatory||{},a.mandatory[n(e,t)]=r[e])}))}),i.advanced&&(a.optional=(a.optional||[]).concat(i.advanced)),a},n=function(r,n){if(61<=t.version)return n(r);if((r=JSON.parse(JSON.stringify(r)))&&"object"===c(r.audio)&&((e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])})((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),e(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=o(r.audio)),r&&"object"===c(r.video)){var i=(i=r.video.facingMode)&&("object"===(void 0===i?"undefined":c(i))?i:{ideal:i}),e=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||e)){delete r.video.facingMode;var a=void 0;if("environment"===i.exact||"environment"===i.ideal?a=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(a=["front"]),a)return s.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return a.some(function(e){return t.label.toLowerCase().includes(e)})});return(t=!t&&e.length&&a.includes("back")?e[e.length-1]:t)&&(r.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}),r.video=o(r.video),u("chrome: "+JSON.stringify(r)),n(r)})}r.video=o(r.video)}return u("chrome: "+JSON.stringify(r)),n(r)},i=function(e){return 64<=t.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s.getUserMedia=function(e,t,r){n(e,function(e){s.webkitGetUserMedia(e,t,function(e){r&&r(i(e))})})}.bind(s),s.mediaDevices.getUserMedia&&(r=s.mediaDevices.getUserMedia.bind(s.mediaDevices),s.mediaDevices.getUserMedia=function(e){return n(e,function(t){return r(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(i(e))})})}))},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")).log)},{"../utils.js":11}],6:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(t){var i;!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype||(i=t.RTCIceCandidate,t.RTCIceCandidate=function(e){var t,r,n;return"object"===(void 0===e?"undefined":a(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length?(t=new i(e),r=s.default.parseCandidate(e.candidate),(n=Object.assign(t,r)).toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n):new i(e)},t.RTCIceCandidate.prototype=i.prototype,n.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e}))},r.shimMaxMessageSize=function(e,a){var o;e.RTCPeerConnection&&("sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}}),o=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,t,r,n,i;return this._sctp=null,"chrome"===a.browser&&76<=a.version&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(e&&e.sdp)return e=s.default.splitSections(e.sdp),e.shift(),e.some(function(e){e=s.default.parseMLine(e);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")})}(arguments[0])&&(r=function(e){e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;e=parseInt(e[1],10);return e!=e?-1:e}(arguments[0]),i=65536,i=i="firefox"===a.browser?a.version<57?-1===r?16384:2147483637:a.version<60?57===a.version?65535:65536:2147483637:i,t=arguments[0],r=r,n=65536,"firefox"===a.browser&&57===a.version&&(n=65535),0<(t=s.default.matchPrefix(t.sdp,"a=max-message-size:")).length?n=parseInt(t[0].substr(19),10):"firefox"===a.browser&&-1!==r&&(n=2147483637),t=n,e=void 0,e=0===i&&0===t?Number.POSITIVE_INFINITY:0===i||0===t?Math.max(i,t):Math.min(i,t),r={},Object.defineProperty(r,"maxMessageSize",{get:function(){return e}}),this._sctp=r),o.apply(this,arguments)})},r.shimSendThrowTypeError=function(e){var t;function r(t,r){var n=t.send;t.send=function(){var e=arguments[0],e=e.length||e.size||e.byteLength;if("open"===t.readyState&&r.sctp&&e>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype&&(t=e.RTCPeerConnection.prototype.createDataChannel,e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e}))},r.shimConnectionState=function(e){var r;!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype||(r=e.RTCPeerConnection.prototype,Object.defineProperty(r,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=r[e];r[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t,r=e.target;return r._lastConnectionState!==r.connectionState&&(r._lastConnectionState=r.connectionState,t=new Event("connectionstatechange",e),r.dispatchEvent(t)),e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}}))},r.removeExtmapAllowMixed=function(r,e){var n;r.RTCPeerConnection&&("chrome"===e.browser&&71<=e.version||"safari"===e.browser&&605<=e.version||(n=r.RTCPeerConnection.prototype.setRemoteDescription,r.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t;return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(t=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n"),r.RTCSessionDescription&&e instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:e.type,sdp:t}):e.sdp=t),n.apply(this,arguments)}))},r.shimAddIceCandidateNullOrEmpty=function(e,t){var r;e.RTCPeerConnection&&e.RTCPeerConnection.prototype&&((r=e.RTCPeerConnection.prototype.addIceCandidate)&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}))};var r=e("sdp"),s=r&&r.__esModule?r:{default:r},n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":11,sdp:13}],7:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia"),a=(Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),e("./getdisplaymedia")),o=(Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(a,i){var o,r;"object"===(void 0===a?"undefined":n(a))&&(a.RTCPeerConnection||a.mozRTCPeerConnection)&&(!a.RTCPeerConnection&&a.mozRTCPeerConnection&&(a.RTCPeerConnection=a.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t,r,n=a.RTCPeerConnection.prototype[e],i=(r=function(){return arguments[0]=new("addIceCandidate"===e?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)},(i=e)in(t={})?Object.defineProperty(t,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[i]=r,t);a.RTCPeerConnection.prototype[e]=i[e]}),o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=a.RTCPeerConnection.prototype.getStats,a.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],e=e[2];return r.apply(this,[t||null]).then(function(r){if(i.version<53&&!n)try{r.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return r}).then(n,e)})},r.shimSenderGetStats=function(e){var r,t;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype||((r=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}))},r.shimReceiverGetStats=function(e){var r;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype||((r=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}))},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var r=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&r.removeTrack(e)})})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function(e){var i;"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||(i=e.RTCPeerConnection.prototype.addTransceiver)&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e,t=arguments[1],r=t&&"sendEncodings"in t,n=(r&&t.sendEncodings.forEach(function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")}),i.apply(this,arguments));return r&&("encodings"in(r=(e=n.sender).getParameters())&&(1!==r.encodings.length||0!==Object.keys(r.encodings[0]).length)||(r.encodings=t.sendEncodings,e.sendEncodings=t.sendEncodings,this.setParametersPromises.push(e.setParameters(r).then(function(){delete e.sendEncodings}).catch(function(){delete e.sendEncodings})))),n})},r.shimGetParameters=function(e){var t;"object"!==(void 0===e?"undefined":n(e))||!e.RTCRtpSender||(t=e.RTCRtpSender.prototype.getParameters)&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},r.shimCreateOffer=function(e){var r;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&(r=e.RTCPeerConnection.prototype.createOffer,e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)})},r.shimCreateAnswer=function(e){var r;"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&(r=e.RTCPeerConnection.prototype.createAnswer,e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)})},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(e){return e&&e.video?(!0===e.video?e.video={mediaSource:r}:e.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(e)):((e=new DOMException("getDisplayMedia without video constraints is undefined")).name="NotFoundError",e.code=8,Promise.reject(e))})}},{}],9:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=(r.shimGetUserMedia=function(e,t){var r,n,i,a,o=e&&e.navigator,e=e&&e.MediaStreamTrack;o.getUserMedia=function(e,t,r){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(e).then(t,r)},55<t.version&&"autoGainControl"in o.mediaDevices.getSupportedConstraints()||(r=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},n=o.mediaDevices.getUserMedia.bind(o.mediaDevices),o.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":s(e))&&"object"===s(e.audio)&&(e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","mozAutoGainControl"),r(e.audio,"noiseSuppression","mozNoiseSuppression")),n(e)},e&&e.prototype.getSettings&&(i=e.prototype.getSettings,e.prototype.getSettings=function(){var e=i.apply(this,arguments);return r(e,"mozAutoGainControl","autoGainControl"),r(e,"mozNoiseSuppression","noiseSuppression"),e}),e&&e.prototype.applyConstraints&&(a=e.prototype.applyConstraints,e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":s(e))&&(e=JSON.parse(JSON.stringify(e)),r(e,"autoGainControl","mozAutoGainControl"),r(e,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[e])}))},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")))},{"../utils":11}],10:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=(r.shimLocalStreamsAPI=function(e){var a;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"addStream"in e.RTCPeerConnection.prototype||(a=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return a.call(r,e,t)}),t.getVideoTracks().forEach(function(e){return a.call(r,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n&&n.forEach(function(e){t._localStreams?t._localStreams.includes(e)||t._localStreams.push(e):t._localStreams=[e]}),a.apply(this,arguments)}),"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,r=this,n=(this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e));-1!==n&&(this._localStreams.splice(n,1),t=e.getTracks(),this.getSenders().forEach(function(e){t.includes(e.track)&&r.removeTrack(e)}))}))},r.shimRemoteStreamsAPI=function(e){var t;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams||[]}),"onaddstream"in e.RTCPeerConnection.prototype||(Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var r=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.includes(e)||(r._remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.dispatchEvent(t))})})}}),t=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;r._remoteStreams||(r._remoteStreams=[]),0<=r._remoteStreams.indexOf(e)||(r._remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.dispatchEvent(t))})}),t.apply(r,arguments)}))},r.shimCallbacksAPI=function(e){var n,i,a,o,s;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&(e=e.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,a=e.setLocalDescription,o=e.setRemoteDescription,s=e.addIceCandidate,e.createOffer=function(e,t){var r=n.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(r.then(e,t),Promise.resolve()):r},e.createAnswer=function(e,t){var r=i.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(r.then(e,t),Promise.resolve()):r},e.setLocalDescription=function(e,t,r){e=a.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},e.setRemoteDescription=function(e,t,r){e=o.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},e.addIceCandidate=function(e,t,r){e=s.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e})},r.shimGetUserMedia=function(e){var t,n=e&&e.navigator;n.mediaDevices&&n.mediaDevices.getUserMedia&&(e=n.mediaDevices,t=e.getUserMedia.bind(e),n.mediaDevices.getUserMedia=function(e){return t(i(e))}),!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n))},r.shimConstraints=i,r.shimRTCIceServerUrls=function(e){var a;e.RTCPeerConnection&&(a=e.RTCPeerConnection,e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,r.push(i)):r.push(e.iceServers[n])}e.iceServers=r}return new a(e,t)},e.RTCPeerConnection.prototype=a.prototype,"generateCertificate"in a&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return a.generateCertificate}}))},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":c(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t;return e&&(void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio),t=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind}),!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),t=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),!1===e.offerToReceiveVideo&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveVideo||t||this.addTransceiver("video")),r.apply(this,arguments)}},r.shimAudioContext=function(e){"object"!==(void 0===e?"undefined":c(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:o.compactObject(e.video)}):e}},{"../utils":11}],11:[function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(r.extractVersion=o,r.wrapPeerConnectionEvent=function(e,n,i){var a,o;e.RTCPeerConnection&&(e=e.RTCPeerConnection.prototype,a=e.addEventListener,e.addEventListener=function(e,t){if(e!==n)return a.apply(this,arguments);function r(e){(e=i(e))&&(t.handleEvent?t.handleEvent(e):t(e))}return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(t,r),a.apply(this,[e,r])},o=e.removeEventListener,e.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);if(!this._eventMap[n].has(t))return o.apply(this,arguments);var r=this._eventMap[n].get(t);return this._eventMap[n].delete(t),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(e,"on"+n,{get:function(){return this["_on"+n]},set:function(e){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),e&&this.addEventListener(n,this["_on"+n]=e)},enumerable:!0,configurable:!0}))},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=e)?"adapter.js logging disabled":"adapter.js logging enabled"},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){"object"===("undefined"==typeof window?"undefined":n(window))&&(i||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},r.deprecated=function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=o(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=o(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(r.mediaDevices&&r.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=o(r.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=o(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},r.compactObject=function i(a){return s(a)?Object.keys(a).reduce(function(e,t){var r=s(a[t]),n=r?i(a[t]):a[t],r=r&&!Object.keys(n).length;return void 0===n||r?e:Object.assign(e,(r=n,(e=t)in(n={})?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n))},{}):a},r.walkStats=c,r.filterStats=function(r,t,e){var n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var a=[];return r.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)}),a.forEach(function(t){r.forEach(function(e){e.type===n&&e.trackId===t.id&&c(r,e,i)})}),i},!0),a=!0;function o(e,t,r){e=e.match(t);return e&&e.length>=r&&parseInt(e[r],10)}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(e){e.endsWith("Id")?c(t,t.get(r[e]),n):e.endsWith("Ids")&&r[e].forEach(function(e){c(t,t.get(e),n)})}))}},{}],12:[function(e,t,r){},{}],13:[function(e,t,r){var u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},u.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},u.getDescription=function(e){e=u.splitSections(e);return e&&e[0]},u.getMediaSections=function(e){e=u.splitSections(e);return e.shift(),e},u.matchPrefix=function(e,t){return u.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},u.parseCandidate=function(e){for(var t,r={foundation:(t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},u.writeCandidate=function(e){var t=[],r=(t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port),e.type);return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},u.parseIceOptions=function(e){return e.substr(14).split(" ")},u.parseRtpMap=function(e){var e=e.substr(9).split(" "),t={payloadType:parseInt(e.shift(),10)},e=e[0].split("/");return t.name=e[0],t.clockRate=parseInt(e[1],10),t.channels=3===e.length?parseInt(e[2],10):1,t.numChannels=t.channels,t},u.writeRtpMap=function(e){var t=e.payloadType,r=(void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),e.channels||e.numChannels||1);return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},u.parseExtmap=function(e){e=e.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},u.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},u.writeFmtp=function(t){var r,e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length&&(r=[],Object.keys(t.parameters).forEach(function(e){t.parameters[e]?r.push(e+"="+t.parameters[e]):r.push(e)}),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"),e},u.parseRtcpFb=function(e){e=e.substr(e.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},u.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},u.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},u.parseSsrcGroup=function(e){e=e.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},u.getMid=function(e){e=u.matchPrefix(e,"a=mid:")[0];if(e)return e.substr(6)},u.parseFingerprint=function(e){e=e.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},u.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:u.matchPrefix(e+t,"a=fingerprint:").map(u.parseFingerprint)}},u.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},u.parseCryptoLine=function(e){e=e.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},u.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?u.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},u.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;e=e.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},u.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},u.getCryptoParameters=function(e,t){return u.matchPrefix(e+t,"a=crypto:").map(u.parseCryptoLine)},u.getIceParameters=function(e,t){var r=u.matchPrefix(e+t,"a=ice-ufrag:")[0],e=u.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&e?{usernameFragment:r.substr(12),password:e.substr(10)}:null},u.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},u.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=u.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],a=u.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){var o=u.parseRtpMap(a),a=u.matchPrefix(e,"a=fmtp:"+i+" ");switch(o.parameters=a.length?u.parseFmtp(a[0]):{},o.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(u.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return u.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(u.parseExtmap(e))}),t},u.writeRtpDescription=function(e,t){var r="",n=(r=(r=(r=(r+="m="+e+" ")+(0<t.codecs.length?"9":"0")+" UDP/TLS/RTP/SAVPF ")+(t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n"))+"c=IN IP4 0.0.0.0\r\n"+"a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r=(r=(r+=u.writeRtpMap(e))+u.writeFmtp(e))+u.writeRtcpFb(e)}),0);return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=u.writeExtmap(e)}),r},u.parseRtpEncodingParameters=function(e){var t,r=[],n=u.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),o=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),s=0<o.length&&o[0].ssrc,o=u.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})}),c=(0<o.length&&1<o[0].length&&o[0][0]===s&&(t=o[0][1]),n.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)},s&&t&&(e.rtx={ssrc:t}),r.push(e),i&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:s,mechanism:a?"red+ulpfec":"red"},r.push(e)))}),0===r.length&&s&&r.push({ssrc:s}),u.matchPrefix(e,"b="));return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=c})),r},u.parseRtcpParameters=function(e){var t={},r=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0],r=(r&&(t.cname=r.value,t.ssrc=r.ssrc),u.matchPrefix(e,"a=rtcp-rsize")),r=(t.reducedSize=0<r.length,t.compound=0===r.length,u.matchPrefix(e,"a=rtcp-mux"));return t.mux=0<r.length,t},u.parseMsid=function(e){var t,r=u.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};r=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<r.length?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},u.parseSctpDescription=function(e){var t,r=u.parseMLine(e),n=u.matchPrefix(e,"a=max-message-size:"),n=(0<n.length&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536),u.matchPrefix(e,"a=sctp-port:"));return 0<n.length?{port:parseInt(n[0].substr(12),10),protocol:r.fmt,maxMessageSize:t}:0<u.matchPrefix(e,"a=sctpmap:").length?(n=u.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" "),{port:parseInt(n[0],10),protocol:n[1],maxMessageSize:t}):void 0},u.writeSctpDescription=function(e,t){var r=[],r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"];return void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},u.generateSessionId=function(){return Math.random().toString().substr(2,21)},u.writeSessionBoilerplate=function(e,t,r){t=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||u.generateSessionId())+" "+t+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},u.writeMediaSection=function(e,t,r,n){t=u.writeRtpDescription(e.kind,t);return t=(t=(t+=u.writeIceParameters(e.iceGatherer.getLocalParameters()))+u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"))+("a=mid:"+e.mid)+"\r\n",e.direction?t+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(t=t+"a="+(r="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(t=(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r)+("a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"))),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),t},u.getDirection=function(e,t){for(var r=u.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?u.getDirection(t):"sendrecv"},u.getKind=function(e){return u.splitLines(e)[0].split(" ")[0].substr(2)},u.isRejected=function(e){return"0"===e.split(" ",2)[1]},u.parseMLine=function(e){e=u.splitLines(e)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},u.parseOLine=function(e){e=u.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},u.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=u.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=u)},{}]},{},[1])}))&&Ge.__esModule&&Object.prototype.hasOwnProperty.call(Ge,"default")&&Ge.default;async function ht(e,t){for(var{appId:e,roomName:r,userId:n}=e,i=`https://rtc.qiniuapi.com/v3/apps/${e}/rooms/${r}/auth?user=${n}&token=`+t;;){const e={auth_start_time:Date.now(),auth_dns_time:0,auth_server_ip:"",room_token:t};try{const t=await Me(i);return T.addEvent("MCSAuth",W({},e,{auth_take_time:Date.now()-e.auth_start_time,auth_error_code:0,auth_error_message:"",access_token:t.accessToken})),t}catch(t){if(T.addEvent("MCSAuth",W({},e,{auth_take_time:Date.now()-e.auth_start_time,auth_error_code:void 0===t.retry?-1:Number(t.message),auth_error_message:void 0===t.retry?t.toString():t.message,access_token:""})),!1===t.retry)throw $t(t.message);await Pe(1e3),S.warning("can not get accessToken, retry.",$t(t))}}}const Ir=t.JOIN_ROOM_ERROR;(r=nt=nt||{})[r.CONNECTING=0]="CONNECTING",r[r.OPEN=1]="OPEN",r[r.CLOSING=2]="CLOSING",r[r.CLOSED=3]="CLOSED";class Pr extends Sr{constructor(e,t,r,n,i){super(),this.rpcid=Ie(16),this.startInitTime=-1,this.startAuthTime=0,this.initWs=(n=!1)=>new Promise((t,r)=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.close(),this.ws.onclose=null),this.startInitTime=Date.now();try{this.ws=new WebSocket(this.url),this._state=nt.CONNECTING}catch(e){throw C(`init signaling websocket faild!
Error: `+e)}this.ws.onerror=this.onWsError,this.ws.onclose=this.onWsClose.bind(this,t,r),this.ws.onopen=()=>{this.emit("ws:onopen"),S.log("signaling: websocket open",this.url),T.addEvent("WebsocketConnect",{happy_dns_resolve_time:0,happy_dns_take_effect:!1,socket_node_info:this.url,socket_connect_time:Date.now()-this.startInitTime,socket_connect_success:!0}),this.startInitTime=-1,this.ws.onmessage=this.onWsMsg;const e={token:this.accessToken,reconntoken:this.reconnectToken,agent:""+l.name+l.version,sdkversion:Wt,capsdp:this.capsdp,msgsn:this.customMsgNumber,supportdomain:!0};this.playerdata&&(e.playerdata=this.playerdata),this.startAuthTime=Date.now(),this.request("auth",e).then(e=>{switch(0!==e.code&&(T.addEvent("SignalAuth",{auth_start_time:this.startAuthTime,auth_dns_time:0,auth_server_ip:this.url,auth_error_code:e.code,auth_error_message:e.error,auth_take_time:Date.now()-this.startAuthTime,access_token:this.accessToken}),this.startAuthTime=0),e.code){case 0:this.ws.onclose=this.onWsClose.bind(this,null,null),this.reconnectToken=e.reconntoken,S.log("signaling: websocket authed"),this.emit("@signalingauth",e),this._state=nt.OPEN,T.addEvent("SignalAuth",{auth_start_time:this.startAuthTime,auth_dns_time:0,auth_server_ip:this.url,auth_error_code:0,auth_error_message:"",auth_take_time:Date.now()-this.startAuthTime,access_token:this.accessToken}),this.startAuthTime=0,t(e);break;case 10001:case 10002:case 10011:case 10022:case 10004:this.emit("@error",e),r(Ir(e.code,e.error));break;case 10012:return void this.safeEmitAsPromise("@needupdateaccesstoken").then(()=>{this.reconnect().then(t).catch(r)}).catch(e=>{this.emit("@error",{code:10002}),r(e)});case 10052:if(S.debug("10052 auth, retry",n),this.reconnectToken=void 0,n){r(Ir(e.code,e.error));break}return void this.emit("@error",e);case 10054:r(Yt(e.error));break;default:r(C(e.error))}0!==e.code&&(this.reconnectToken=void 0,this._state=nt.CLOSED,this.release())})}}),this.onWsMsg=e=>{const t=e.data;this.emit("ws:onmessage",t);var r=t.indexOf("=");if(!(0<r))throw C("signaling model can not parse message: "+t);{const e=t.substring(0,r),n=JSON.parse(t.substring(r+1));this.receiveWsMsg(e,n)}},this.onWsError=e=>{S.warning("signaling: websocket error",e),this.emit("@ws:error",e),-1!==this.startInitTime&&(T.addEvent("WebsocketConnect",{happy_dns_resolve_time:0,happy_dns_take_effect:!1,socket_node_info:this.url,socket_connect_time:Date.now()-this.startInitTime,socket_connect_success:!1}),this.startInitTime=-1)},this.sendWsMsg=(e,t)=>{if(this.ws.readyState!==WebSocket.OPEN)throw hr();var r=JSON.stringify(t);try{this.ws.send(e+"="+r),this.emit("send",e,t)}catch(e){throw S.warning("signaling: websocket send error",e),this.reconnect().catch(e=>{S.warning("signaling: reconnect error",e)}),hr()}},this.handlePing=()=>{this.sendWsMsg("pong",{}),this.reconnectTimeoutID&&clearTimeout(this.reconnectTimeoutID),this.reconnectTimeoutID=setTimeout(()=>{S.debug("signaling: websocket heartbeat timeout"),this.reconnect().catch(e=>{S.warning("signaling: reconnect error",e)})},9e3)},this.receiveWsMsg=(e,t)=>{switch(this.emit("receive",e,t),e){case"ping":this.handlePing();break;case"auth-res":this.emit("@auth-res",t);case"pubpc-res":case"subpc-res":case"pub-tracks":case"webrtc-candidate":case"on-player-in":case"on-player-out":case"disconnect":case"mute-tracks":case"on-add-tracks":case"on-remove-tracks":case"on-player-reconnect":case"on-player-reconnect-in":this.emit(e,t);break;case"sub-res":case"unsub-res":this.emit(e,t),this.emit(e+"-"+t.streamid,t);break;case"control-res":this.emit(e,t),this.emit(`${e}-${t.command}-`+t.playerid,t);break;case"on-pubpc-connected":case"on-pubpc-disconnected":this.emit("on-pubpc-state",{pcid:t.pcid,connected:"on-pubpc-connected"===e}),this.emit(e+"-"+t.pcid,t);break;case"on-subpc-disconnected":case"on-subpc-connected":this.emit("on-subpc-state",{pcid:t.pcid,connected:"on-subpc-connected"===e}),this.emit(e,t);break;case"pub-tracks-res":this.emit(e,t);break;case"on-messages":case"on-qos-messages":t.messages=t.messages.sort((e,t)=>e.msgsn-t.msgsn),this.customMsgNumber=t.messages[t.messages.length-1].msgsn,this.emit(e,t);break;case"unpub-tracks-res":case"sub-tracks-res":case"unsub-tracks-res":case"on-pubpc-restart-notify":case"on-subpc-restart-notify":case"set-sub-profile-res":case"on-sub-profile-changed":case"pubpc-restart-res":case"subpc-restart-res":case"create-merge-job-res":this.emit(e,t)}},this.setUrl(e),this.accessToken=t,this.capsdp=r,this.reconnectTimes=n,this.playerdata=i}set _state(e){this.emit("@ws-state-change",this.__state,e),this.__state=e}get state(){return this.__state}set reconnectTimes(e){this._reconnectTimes=e,this.currentLeftReconnectTimes=e}get reconnectTimes(){return this._reconnectTimes}setUrl(e){this.url=e+("?rpcid="+this.rpcid)}onWsClose(e,t,r){this._state=nt.CLOSED,S.warning("signaling: websocket onclose",r),this.startAuthTime&&T.addEvent("SignalAuth",{auth_start_time:this.startAuthTime,auth_dns_time:0,auth_server_ip:this.url,auth_error_code:r.code,auth_error_message:r.toString(),auth_take_time:Date.now()-this.startAuthTime,access_token:this.accessToken});let n=this.reconnectPromise;switch(r.code){case 1e3:this.emit("@closed");break;case 1001:case 1005:case 1006:n=this.reconnect();break;case 1007:case 1008:case 1009:case 1010:break;case 1011:n=this.reconnect();break;case 1012:n=this.reconnect(5e3);break;case 1013:n=this.reconnect();break;case 1014:n=this.reconnect(5e3)}e&&t&&(n?n.then(e).catch(e=>{S.warning("signaling: reconnect error",e)}):t(r))}sendDisconnect(){if(this.state===nt.OPEN)try{this.sendWsMsg("disconnect",{})}catch(e){}}reconnect(e=1e3){return this.reconnectTimeoutID&&clearTimeout(this.reconnectTimeoutID),this.reconnectPromise&&this._state===nt.CONNECTING?this.reconnectPromise:this.currentLeftReconnectTimes<=0?(this.emit("@error",{code:10007}),Promise.reject("websocket reconnectTimes run out, reconnect stops.")):(--this.currentLeftReconnectTimes,this._state=nt.CONNECTING,S.debug("signaling: websocket reconnecting, currentLeftReconnectTimes remaining: ",this.currentLeftReconnectTimes),this.reconnectPromise=Pe(e).then(()=>this.initWs()).then(e=>(this.reconnectPromise=void 0,this.currentLeftReconnectTimes=this.reconnectTimes,e)).catch(e=>(this._state=nt.CLOSED,this.emit("error",e),Promise.reject(e))),this.reconnectPromise)}request(n,e){const i=Ie(8);return e.rpcid=i,S.log("ws request",i,n,e),this.sendWsMsg(n,e),new Promise(t=>{const r=e=>{e.rpcid===i&&(S.log("ws response",i,n,e),this.off(n+"-res",r),t(e))};this.on(n+"-res",r)})}release(){this.reconnectTimeoutID&&clearTimeout(this.reconnectTimeoutID),this.removeEvent(),this.ws.onclose=null,this.ws.onerror=null,this.ws.close()}}class Ar{}class Mr{constructor(e,t,r,n){this.videoTrackInfo=[],this.audioTrackInfo=[],this.layoutLevel=0,this.width=e,this.height=t,this.jobID=n,this.controller=r,this.controller.getCurrentTracks().forEach(e=>{("audio"===e.kind?this.audioTrackInfo:this.videoTrackInfo).push(e)}),this.controller.addMergeTrack(this.audioTrackInfo.map(e=>({trackID:e.trackID})),this.jobID),this.initLayout(),this.controller.onAddTracks=e=>{const t=e.filter(e=>"audio"===e.kind),r=e.filter(e=>"video"===e.kind);this.controller.addMergeTrack(t.map(e=>({trackID:e.trackID})),this.jobID),r.forEach(this.handleAddVideoTrack.bind(this))},this.controller.onRemoveTracks=e=>{e.filter(e=>"video"===e.kind).forEach(this.handleRemoveVideoTrack.bind(this))},S.log("init default merger, init layout: ",this.layout)}initLayout(){var e=this.videoTrackInfo.length;this.layoutLevel=0,this.layout={"level-0":{items:{"item-0":{x:0,y:0,isExpand:!1,isExpanded:!1,index:0}},itemWidth:this.width,itemHeight:this.height,maxItems:1,currentItems:0,splitWidthFlag:this.width<this.height}};let t=this.width>=this.height;if(0!==e){for(;Math.pow(2,this.layoutLevel)<e;)this.updateLayoutLevel(t),t=!t;this.setLevelLayoutStream()}}updateLayoutLevel(r){const n=this.layout["level-"+this.layoutLevel],e=n.itemWidth,t=n.itemHeight,i=(this.layoutLevel+=1,Math.pow(2,this.layoutLevel)),a=r?e/2:e,o=r?t:t/2;if(1===this.layoutLevel)this.layout["level-"+this.layoutLevel]={items:{"item-0":{x:0,y:0,isExpand:!1,isExpanded:!1,index:0},"item-1":{x:this.width>=this.height?a:0,y:this.width<this.height?o:0,isExpand:!1,isExpanded:!1,index:1}},maxItems:i,currentItems:0,itemWidth:a,itemHeight:o,splitWidthFlag:r};else{this.layout["level-"+this.layoutLevel]={items:{},maxItems:i,currentItems:0,itemWidth:a,itemHeight:o,splitWidthFlag:r};const n=this.layout["level-"+this.layoutLevel].items;Object.keys(this.layout["level-"+(this.layoutLevel-1)].items).forEach(e=>{var e=this.layout["level-"+(this.layoutLevel-1)].items[e],t=2*e.index;n["item-"+t]={x:e.x,y:e.y,isExpand:!1,isExpanded:!1,index:t},n["item-"+(1+t)]=r?{x:e.x+a,y:e.y,isExpand:!1,isExpanded:!1,index:1+t}:{x:e.x,y:e.y+o,isExpand:!1,isExpanded:!1,index:1+t}})}S.log("merger: increase layout level, current level: "+this.layoutLevel,this.layout)}setLevelLayoutStream(){const e=this.videoTrackInfo.length,t=this.layout["level-"+this.layoutLevel];let r=t.maxItems-e,n=0;for(let e=0;e<t.maxItems;e+=1)0<r?e%2==0?(t.items["item-"+e].isExpand=!0,t.items["item-"+e].trackID=this.videoTrackInfo[n].trackID,this.sendMergeOpt(this.layoutLevel,e),n+=1):(t.items["item-"+e].isExpanded=!0,--r):(t.items["item-"+e].trackID=this.videoTrackInfo[n].trackID,this.sendMergeOpt(this.layoutLevel,e),n+=1);t.currentItems=e}sendMergeOpt(r,n){r=this.layout["level-"+r],n=r.items["item-"+n];if(n.trackID&&!n.isExpanded){let e=r.itemWidth,t=r.itemHeight;n.isExpand&&(r.splitWidthFlag?e*=2:t*=2);r={x:n.x,y:n.y,w:e,h:t,z:0,trackID:n.trackID};this.controller.addMergeTrack([r],this.jobID)}}handleRemoveVideoTrack(t){ie(this.videoTrackInfo,e=>e.trackID===t.trackID);const e=this.layout["level-"+this.layoutLevel];if(0<this.layoutLevel&&this.videoTrackInfo.length<=this.layout["level-"+(this.layoutLevel-1)].maxItems)--this.layoutLevel,S.log("merger: reduce layout level, current level: "+this.layoutLevel,this.layout),this.setLevelLayoutStream();else for(const r in e.items){const n=e.items[r];if(n.trackID===t.trackID){n.index%2==0?(e.items["item-"+(n.index+1)]?(n.isExpand=!0,n.trackID=e.items["item-"+(n.index+1)].trackID,e.items["item-"+(n.index+1)].isExpanded=!0,e.items["item-"+(n.index+1)].trackID=void 0):n.trackID=void 0,this.sendMergeOpt(this.layoutLevel,n.index)):(n.isExpanded=!0,n.trackID=void 0,e.items["item-"+(n.index-1)].isExpand=!0,this.sendMergeOpt(this.layoutLevel,n.index-1));break}}}handleAddVideoTrack(e){const t=this.videoTrackInfo.length;if(this.videoTrackInfo.push(e),this.videoTrackInfo=ze(this.videoTrackInfo,"trackID"),this.videoTrackInfo.length!==t){const r=this.layout["level-"+this.layoutLevel];if(this.videoTrackInfo.length<=r.maxItems){for(const t in r.items){const n=r.items[t];if(!n.trackID){n.trackID=e.trackID,n.isExpanded&&(n.isExpanded=!1,r.items["item-"+(n.index-1)].isExpand=!1,this.sendMergeOpt(this.layoutLevel,n.index-1)),this.sendMergeOpt(this.layoutLevel,n.index);break}}r.currentItems=this.videoTrackInfo.length}else this.updateLayoutLevel(!r.splitWidthFlag),this.setLevelLayoutStream()}else S.log("handle add video track ignore",e)}release(){this.controller.release()}}class Dr{constructor(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}async setSource(e){e!==this.source&&(this.source=e,await this.createImageStreamTrack(e))}get id(){if(this.mediaTrack)return this.mediaTrack.id}loadImageFromUrl(n){return new Promise((e,t)=>{var r=new Image;r.crossOrigin="Anonymous",r.src=n,r.onload=function(){e(r)},r.onerror=function(e){t(e)}})}loadImageFromFile(e){return new Promise((t,r)=>{const n=new FileReader;n.onload=e=>{n.result&&t(this.loadImageFromUrl(n.result))},n.onerror=e=>{r(e)},n.readAsDataURL(e)})}loadImageFromArrayBuffer(n){return new Promise((e,t)=>{var r=new Blob([n]),r=URL.createObjectURL(r);e(this.loadImageFromUrl(r))})}async createImageStreamTrack(e){let t;t=e instanceof File?await this.loadImageFromFile(e):e instanceof ArrayBuffer?await this.loadImageFromArrayBuffer(e):await this.loadImageFromUrl(e),this.canvas.width=t.width,this.canvas.height=t.height,this.drawIntervalId&&clearInterval(this.drawIntervalId),this.drawIntervalId=setInterval(()=>{this.ctx.drawImage(t,0,0)},900);const r=this.canvas.captureStream(1);this.mediaTrack=r.getTracks()[0]}release(){this.drawIntervalId&&clearInterval(this.drawIntervalId)}}class xr{constructor(){this.recordedChunks=[]}releaseMediaElement(){S.log("Recorder release Media Element",this.mediaElement),this.mediaElement&&this.mediaElement.parentElement&&this.mediaElement.parentElement.removeChild(this.mediaElement)}release(){this.recorder&&"inactive"!==this.recorder.state&&this.recorder.stop(),this.recorder=void 0,this.recordedChunks=[],this.recordedBlob=void 0,this.recordedUrl&&(window.URL.revokeObjectURL(this.recordedUrl),this.recordedUrl=void 0),this.releaseMediaElement()}setMimeType(e){if(S.log("Recorder setMimeType, ",e),!("MediaRecorder"in window))throw rr("MediaRecorder is not supported.");return!!window.MediaRecorder.isTypeSupported(e)&&(this.mimeType=e,!0)}start(t){if(S.log("Recorder start, ",t),!("MediaRecorder"in window))throw rr("MediaRecorder is not supported.");if(void 0===t||!t.audioTrack&&!t.videoTrack)throw C("Invalid parameters.");if(this.recorder&&"inactive"!==this.recorder.state)throw C("MediaRecorder is active, cannot start again.");this.release();try{let e=[];t.audioTrack&&e.push(t.audioTrack.track.mediaTrack),t.videoTrack&&e.push(t.videoTrack.track.mediaTrack);const r=new MediaStream(e),n=window;if(this.mimeType){const t={mimeType:this.mimeType};this.recorder=new n.MediaRecorder(r,t)}else this.recorder=new n.MediaRecorder(r);this.recorder.ondataavailable=e=>{S.debug("Recorder data, ",e.data),this.recordedChunks.push(e.data)},this.recorder.start(xr.recorderTimeslice)}catch(t){throw C("MediaRecoder start error: "+t.message)}}pause(){if(S.log("Recorder pause"),!this.recorder)throw C("No MediaRecorder, please try to start first.");if("recording"!==this.recorder.state)throw C("MediaRecorder is not in recording state, cannot do pause.");this.recorder.pause()}resume(){if(S.log("Recorder resume"),!this.recorder)throw C("No MediaRecorder, please try to start first.");if("paused"!==this.recorder.state)throw C("MediaRecorder is not in paused state, cannot do resume.");this.recorder.resume()}stop(){if(S.log("Recorder stop, ",this.recordedChunks),!this.recorder)throw C("No MediaRecorder, please try to start first.");if("inactive"===this.recorder.state)throw C("MediaRecorder is in inactive state, cannot do stop.");try{var e;return this.recorder.stop(),this.mimeType?(e={type:this.mimeType},this.recordedBlob=new Blob(this.recordedChunks,e)):this.recordedBlob=new Blob(this.recordedChunks),this.recordedUrl=window.URL.createObjectURL(this.recordedBlob),this.recordedBlob}catch(e){throw C("MediaRecorder stop error: "+e.message)}}play(e,t=!0){if(S.log("Recorder play, ",e,t),!this.recordedUrl)throw C("No recorded data, please start record first.");this.releaseMediaElement();const n=document.createElement("video");return n.style.width="100%",n.style.height="100%",n.style.objectFit="contain",n.controls=!0,n.muted=t,n.className="qnrtc-recorder-video-player",n.setAttribute("playsinline",!0),n.autoplay=!0,n.src=this.recordedUrl,e.appendChild(n),this.mediaElement=n,new Promise((e,t)=>{let r;try{r=n.play()}catch(e){t(e)}r?r.then(e).catch(e=>{t(e);try{throw C("MediaRecoder play error: "+e.message)}catch(e){}}):e()})}download(e){if(S.log("Recorder download, "+e),!this.recordedUrl)throw C("No recorded data, please start record first.");const t=document.createElement("a");t.style.display="none",t.href=this.recordedUrl,t.download=e,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t)},100)}}xr.recorderTimeslice=1e3;class Or{constructor(e,t,r,n){this.id=e,this.mid=t,this.kind=r,this.rtpParameters=n,this.track=null}}class Lr{constructor(e,t,r,n,i){this._connectStatus=w.TrackConnectStatus.Idle,this.track=r,this.trackID=n,this.mid=i,this.transport=e,this.direction=t}get connectStatus(){return this._connectStatus}set connectStatus(e){if(e!==this._connectStatus){const t=this._connectStatus;this._connectStatus=e,Re(()=>{this.onConnectStatusChange&&this.onConnectStatusChange(t,this._connectStatus)})}}startConnect(){return this.connectStatus=w.TrackConnectStatus.Connecting,new Promise((r,n)=>{this.onConnectStatusChange=(e,t)=>{t===w.TrackConnectStatus.Connect&&r(),t===w.TrackConnectStatus.Idle&&n()}})}appendConsumner(e,t){this.consumer=new Or(this.trackID,this.mid,t,e),this.transport.appendConsumer(this.consumer)}setMute(e){this.track&&this.track.setMute(e)}addTrackId(e){this.track&&(this.trackID=e,this.track.setInfo({trackID:e}))}release(){this.consumer&&this.transport?(this.transport.recvHandler.isPcReady&&this.transport.removeConsumers([this.consumer]),this.track&&this.track.release()):this.track&&this.track.reset()}}const jr=window.AudioContext||window.webkitAudioContext||window.Object,Nr=b.audioContextOptions?new jr({latencyHint:"interactive"}):new jr;if(window.audioContext=Nr,window.Promise){const w=()=>{var n;n=Nr,new Promise((e,t)=>{if("suspended"===n.state){S.log("audio context state is suspended");const r=()=>{n.resume().then(()=>{document.body.removeEventListener("touchstart",r),document.body.removeEventListener("touchend",r),document.body.removeEventListener("mousedown",r),document.body.removeEventListener("mouseup",r),e(!0)}).catch(t)};document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("touchend",r,!0),document.body.addEventListener("mousedown",r,!0),document.body.addEventListener("mouseup",r,!0),r()}else e(!1)}).then(e=>{S.debug("web audio context unlocked",e)}).catch(e=>{S.warning("can not unlock web audio context",e)}),window.removeEventListener("load",w)};document.body?w():window.addEventListener("load",w),Nr.onstatechange=()=>{w()}}const Br=["play","playing","pause","ended","waiting","seeking"];class Fr extends Sr{constructor(){super(),this.audioSource=null,this._audioSourceState=w.AudioSourceState.IDLE,this.bufferSourceDuration={startTime:0,pauseTime:0,lastPauseTime:0,offsetTime:0,stopTime:0},this.handleMediaElementEvents=e=>{switch(e.type){case"playing":case"play":this.audioSourceState=w.AudioSourceState.PLAY;break;case"pause":if(this.audioSourceState===w.AudioSourceState.END)break;this.audioSourceState=w.AudioSourceState.PAUSE;break;case"waiting":case"seeking":this.audioSourceState=w.AudioSourceState.LOADING;break;case"ended":this.audioSourceState=w.AudioSourceState.END}}}get audioSourceState(){return this._audioSourceState}set audioSourceState(e){e!==this._audioSourceState&&(this.emit("@audio-source-state-change",e,this._audioSourceState),this._audioSourceState=e)}initAudioContext(){S.log("init audio context",Nr.state),"suspended"===Nr.state&&(S.log("audio context suspended"),Nr.resume().catch(e=>{S.warning("resume audiocontext failed! see: http://s.qnsdk.com/s/Txsdz",e)})),S.log("init audio finish",Nr.state),this.analyserNode=Nr.createAnalyser(),this.analyserNode.fftSize=2048,this.gainNode=Nr.createGain();var n=this.gainNode;if(!b.disconnectAudioNode){const i=n.connect,a=n.disconnect;n.connect=(e,t,r)=>(n._inputNodes||(n._inputNodes=[]),e instanceof AudioNode?(n._inputNodes.push(e),n._inputNodes=ze(n._inputNodes,e=>e),i.call(n,e,t,r)):i.call(n,e,t),n),n.disconnect=(t,e,r)=>{if(!t)return a.call(n),void(n._inputNodes=[]);a.call(n,t,e,r),ie(n._inputNodes,e=>e===t);for(const t of n._inputNodes)n.connect(t)}}b.mediaStreamDest&&(this.audioStream=Nr.createMediaStreamDestination())}setMediaStreamSource(e){this.audioSource=Nr.createMediaStreamSource(e),this.connect()}setAudioBufferSource(){this.audioSource=Nr.createBufferSource(),this.audioSource.onended=()=>this.stopAudioSource(),this.connect()}setMediaElementSource(e){this.audioSource=Nr.createMediaElementSource(e),this.audioSourceElement=e;for(const e of Br)this.audioSourceElement.addEventListener(e,this.handleMediaElementEvents);this.connect()}setAudioSourceLoop(e){this.audioSourceLoop=e,this.audioSource instanceof AudioBufferSourceNode?this.audioSource.loop=!!e:this.audioSourceElement&&(this.audioSourceElement.loop=!!e)}setAudioBuffer(e){this.audioSource instanceof AudioBufferSourceNode&&(this.audioSource.buffer=e,this.audioSourceBuffer=e)}playAudioSource(t=0){if(this.audioSource instanceof AudioBufferSourceNode){this.resetBufferSourceDuration();try{this.audioSource.start(0,t),this.bufferSourceDuration.startTime=Nr.currentTime,this.bufferSourceDuration.offsetTime=t,this.audioSourceState=w.AudioSourceState.PLAY}catch(e){this.stopAudioSource(),this.playAudioSource(t)}}else this.audioSourceElement?(this.audioSourceElement.currentTime=0,this.audioSourceElement.play().catch(Ae)):null===this.audioSource&&this.audioSourceBuffer&&(this.resetBufferSourceDuration(),this.setAudioBufferSource(),this.setAudioBuffer(this.audioSourceBuffer),this.setAudioSourceLoop(!!this.audioSourceLoop),this.audioSource.start(0,t),this.bufferSourceDuration.startTime=Nr.currentTime,this.bufferSourceDuration.offsetTime=t,this.audioSourceState=w.AudioSourceState.PLAY)}resumeAudioSource(){this.audioSource instanceof AudioBufferSourceNode?this.audioSourceState===w.AudioSourceState.PAUSE&&(this.audioSource.playbackRate.value=1,this.bufferSourceDuration.pauseTime+=Nr.currentTime-this.bufferSourceDuration.lastPauseTime,this.bufferSourceDuration.lastPauseTime=0,this.audioSourceState=w.AudioSourceState.PLAY):this.audioSourceElement&&this.audioSourceElement.play().catch(Ae)}pauseAudioSource(){this.audioSource instanceof AudioBufferSourceNode?(this.audioSource.playbackRate.value=At?1e-7:Number.MIN_VALUE,this.bufferSourceDuration.lastPauseTime||(this.bufferSourceDuration.lastPauseTime=Nr.currentTime),this.audioSourceState=w.AudioSourceState.PAUSE):this.audioSourceElement&&this.audioSourceElement.pause()}stopAudioSource(e=!1){this.audioSource instanceof AudioBufferSourceNode?(this.audioSource.onended=null,this.audioSource.stop(),this.audioSource.disconnect(),this.audioSource=null,this.bufferSourceDuration.stopTime=Nr.currentTime,e||(this.audioSourceState=w.AudioSourceState.END)):this.audioSourceElement&&(this.audioSourceState=w.AudioSourceState.END,this.audioSourceElement.pause(),this.audioSourceElement.currentTime=0)}getAudioSourceCurrentTime(){if(this.audioSourceElement)return this.audioSourceElement.currentTime;if(this.audioSource instanceof AudioBufferSourceNode){let e=Nr.currentTime;var t=this.getAudioSourceDuration(),r=(this.bufferSourceDuration.lastPauseTime&&(e=this.bufferSourceDuration.lastPauseTime),this.bufferSourceDuration.stopTime&&(e=this.bufferSourceDuration.stopTime),this.bufferSourceDuration.offsetTime+e-this.bufferSourceDuration.startTime-this.bufferSourceDuration.pauseTime);return Math.max(0,r%t)}return 0}setAudioSourceCurrentTime(e){this.audioSourceElement?this.audioSourceElement.currentTime=e:this.audioSource instanceof AudioBufferSourceNode&&(this.stopAudioSource(!0),this.playAudioSource(e))}getAudioSourceDuration(){return this.audioSourceElement?this.audioSourceElement.duration:this.audioSourceBuffer?this.audioSourceBuffer.duration:0}release(){if(this.audioSource instanceof MediaStreamAudioSourceNode&&this.audioSource.mediaStream&&this.audioSource.mediaStream.getTracks().map(e=>e.stop()),this.audioSource&&this.audioSource.disconnect(),this.gainNode.disconnect(),this.audioSourceElement){for(const e of Br)this.audioSourceElement.removeEventListener(e,this.handleMediaElementEvents);this.audioSourceElement.src="",this.audioSourceElement.load(),this.audioSourceElement.remove(),this.audioSourceElement=void 0}this.scriptNode&&this.scriptNode.disconnect()}connect(){this.audioSource?(this.audioSource.connect(this.analyserNode),this.audioSource.connect(this.gainNode),this.audioStream&&(this.gainNode.connect(this.audioStream),this.onAudioBuffer())):S.warning("no audio source, can not connect")}handleAudioBuffer(e){e=e.inputBuffer;this.emit("audioBuffer",e),this.audioBufferCallback&&this.audioBufferCallback(e)}onAudioBuffer(e,t=4096){this.audioBufferCallback=e,this.audioBufferSize=t,this.audioStream&&this.audioSource&&(this.scriptNode||(this.scriptNode=Nr.createScriptProcessor(t),this.audioSource.connect(this.scriptNode),this.scriptNode.connect(this.audioStream),this.scriptNode.onaudioprocess=this.handleAudioBuffer.bind(this)))}resetBufferSourceDuration(){this.bufferSourceDuration={offsetTime:0,startTime:0,lastPauseTime:0,pauseTime:0,stopTime:0}}}class Ur extends Tr{constructor(e,t,r){if("audio"!==e.kind)throw new Error("audio track only!");super(e,t,r),this.mediaStream=new MediaStream,this.mediaStream.addTrack(e)}resume(e){this.mediaTrack=e,this.removeEvent("@get-stats"),this.resetStats();var t=new MediaStream([e]);this.mediaStream=t,this.mediaElement&&(this.mediaElement.dataset.localid=e.id,this.mediaElement.srcObject=t),this.audioManager&&(this.audioManager.release(),this.initAudioManager())}initAudioManager(e){this.audioManager=new Fr,this.audioManager.initAudioContext(),this.audioManager.setMediaStreamSource(this.mediaStream),this.audioManager.on("audioBuffer",e=>{this.emit("audioBuffer",e)}),e&&b.mediaStreamDest&&(this.mediaStream=this.audioManager.audioStream.stream,this.mediaTrack=this.mediaStream.getTracks()[0])}setVolume(e){this.audioManager.gainNode.gain.setValueAtTime(e,Nr.currentTime)}getCurrentTimeDomainData(){var e=new Uint8Array(2048);return this.audioManager.analyserNode.getByteTimeDomainData(e),e}getCurrentFrequencyData(){var e=new Uint8Array(this.audioManager.analyserNode.frequencyBinCount);return this.audioManager.analyserNode.getByteFrequencyData(e),e}getVolume(){return this.audioManager.gainNode.gain.value}getCurrentVolumeLevel(){const r=this.getCurrentFrequencyData();let n=0,i=r.length;return r.forEach((e,t)=>{var t=t*(Nr.sampleRate||44100)/r.length;22050<t||(t=1.2588966*14884e4*(t=t*t)*t/((424.36+t)*Math.sqrt((11599.29+t)*(544496.41+t))*(14884e4+t))*e/255)<=0?--i:n+=t*t}),0===i?0:Math.sqrt(n/i)}release(){this.emit("release"),this.removeEvent(),this.statsInterval&&window.clearInterval(this.statsInterval),this.audioManager&&this.audioManager.release(),this.removeMediaElement(),this.mediaTrack.stop()}}var ft,pt=function(e,t){if(null==e)return{};for(var r,n={},i=Object.keys(e),a=0;a<i.length;a++)r=i[a],0<=t.indexOf(r)||(n[r]=e[r]);return n},mt=function(e,t){if(null==e)return{};var r,n=pt(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),a=0;a<i.length;a++)r=i[a],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r]);return n};class Vr extends Sr{constructor(e,t,r){super(),this._isRestartingICE=!1,this.isPcReady=!1,this.lastMediaStatistics=[],this.intervalId=-1,this._direction=e,this._pc=Fe(),this._extendedRtpCapabilities=t,this._remoteSdp=new Er(e,t),this._simulcast=!!r&&r.simulcast,this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected"),this.registerMediaStatisticStatsReport();break;case"failed":this.emit("@connectionstatechange","failed"),this.unregisterMediaStatisticStatsReport();break;case"disconnected":this.emit("@connectionstatechange","disconnected"),this.unregisterMediaStatisticStatsReport();break;case"closed":this.emit("@connectionstatechange","closed"),this.unregisterMediaStatisticStatsReport()}})}async getStats(e,t){return Ve(this._pc,e,this._direction,t)}registerMediaStatisticStatsReport(){this.unregisterMediaStatisticStatsReport(),this.intervalId=window.setInterval(async()=>{var e=await Le(this._pc);e&&0<e.length&&(this.addMediaStatistics(e,this.lastMediaStatistics),this.lastMediaStatistics=e)},3e3)}unregisterMediaStatisticStatsReport(){-1!==this.intervalId&&(window.clearInterval(this.intervalId),this.lastMediaStatistics=[],this.intervalId=-1)}addMediaStatistics(e,n){const t=e.map(t=>{var e=vr(t.id,t.kind),r=n.find(e=>e.id===t.id);if(!r)return t;var i=r.calculation_stats,a=t["calculation_stats"],r=mt(t,["calculation_stats"]);return W({},r,function(e){if(!a||!i)return{framerate:0,kbps:0,packet_lost_rate:0};var t=(a.timestamp-i.timestamp)/1e3,r=0==t?0:(a.frames_sent-i.frames_sent+(a.frames_received-i.frames_received))/t,t=0==t?0:(a.bytes_sent-i.bytes_sent+(a.bytes_received-i.bytes_received))/(1024*t/8),n=Be(i.packets_lost,a.packets_lost,i.packets_received+i.packets_sent,a.packets_received+a.packets_sent),n=(e.Apply(n),e.Filtered()<0?0:100*e.Filtered());return{framerate:Math.ceil(r),kbps:Math.ceil(t),packet_lost_rate:Math.ceil(n)}}(e))});S.log("media statistics",t),T.addEvent("MediaStatistics",{cpu_loading:0,track_stats:t});var e=Oe(t.sort((e,t)=>t.packet_lost_rate-e.packet_lost_rate)[0].packet_lost_rate,t.sort((e,t)=>t.rtt-e.rtt)[0].rtt),r=(Jt(e),t.map(e=>({kind:e.kind,lostRate:e.packet_lost_rate,rtt:e.rtt,track:e.track_id})));this.emit("@send-qos-message",{qos:JSON.stringify({networkGrade:e,tracks_qos:r})})}getCurrentIceConnectionState(){return this._pc.iceConnectionState}close(){S.log("handle",this._direction,"close"),this.removeEvent(),this.unregisterMediaStatisticStatsReport(),this._pc.close(),this.isPcReady=!1}}class Gr extends Vr{constructor(e,t,r){super("send",e,r),S.log("init send handler"),this._transportReady=!1,this._stream=new MediaStream,(this._signaling=t).on("on-pubpc-state",e=>{this._remoteSdp.transportRemoteParameters&&e.pcid===this._remoteSdp.transportRemoteParameters.pcid&&(e.connected||this.emit("@connectionstatechange","remote-disconnected"))})}getReady(n){return new Promise((t,e)=>{const r=e=>{e.pcid===n.pcid&&(this._signaling.off("on-pubpc-state",r),e.connected&&(this.isPcReady=!0,t()))};this._signaling.on("on-pubpc-state",r)})}addProducerTracks(r){S.debug("add producer",r);const t=r.map(e=>e.mediaTrack).filter(e=>!this._stream.getTrackById(e.id));if(0===t.length)return Promise.reject(new Error("track already added"));let n;const i=[];let a,o=!0;return Promise.resolve().then(async()=>{if(t.forEach(this._stream.addTrack,this._stream),b.unifiedPlan&&b.supportTransceivers)for(const e of t){const t=await Ue(e,this._pc);S.debug("add transceiver",t,t.mid),i.push(t)}else S.debug("add tracks",t),n=t.map(e=>this._pc.addTrack(e,this._stream));return this._simulcast&&l.name,gt(this._pc,this._simulcast)}).then(e=>{return b.needH264FmtpLine&&(e.sdp+=`a=fmtp:107 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f
`),e={type:"offer",sdp:e.sdp},a=e.sdp,S.log("publish: set local offer",e),this._pc.setLocalDescription(e)}).then(()=>{for(const t of i)if(t.sender.track){const e=r.find(e=>e.mediaTrack===t.sender.track);if(!e||!t.mid)throw C("can not get transceiver mid!");e.setInfo({mid:t.mid})}if(!this._transportReady)return o=!1,this._setupTransport(r)}).then(()=>this._remoteSdp.createRemoteAnswer(a)).then(e=>{e={type:"answer",sdp:e};return S.debug("addProducer answer",e),this._pc.setRemoteDescription(e)}).then(()=>this._pcReady).then(()=>o?this.safeEmitAsPromise("@needpubtracks",r,a):Promise.resolve(this._remoteSdp.transportRemoteParameters)).catch(e=>{S.log("add producer error",e);try{for(const e of n)this._pc.removeTrack(e);for(const e of i)e.direction="inactive"}catch(e){}for(const e of t)this._stream.removeTrack(e);throw e instanceof qt?e:C(e)})}removeProducerTracks(e){S.debug("removeProducerTracks",e);const t=e.filter(e=>void 0!==e.track&&!!this._stream.getTrackById(e.track.mediaTrack.id)).map(e=>(e.track.isReplacedByImageTrack?e.track.imageStreamTrack:e.track).mediaTrack);let r;return Promise.resolve().then(()=>{const e=this._pc.getSenders().filter(e=>e.track&&t.includes(e.track));if(0===e.length)return S.warning("removeProducerTracks [nothing to remove]"),Promise.reject("removeProducerTracks: nothing to remote");for(const t of e)this._pc.removeTrack(t);for(const e of t)this._stream.removeTrack(e);return this._simulcast&&l.name,gt(this._pc,this._simulcast)}).then(e=>{e=new RTCSessionDescription(e);return r=e.sdp,S.log("unpublish: set local offer",e),this._pc.setLocalDescription(e)}).then(()=>{var e={type:"answer",sdp:this._remoteSdp.createRemoteAnswer(r)};return S.log("unpublish: set remote answer",e),this._pc.setRemoteDescription(e)}).catch(e=>{if(0!==this._stream.getTracks().length)throw e instanceof qt?e:C(e);S.debug("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(()=>{this.safeEmitAsPromise("@needunpubtracks",e)})}async replaceProducerTrack(t,e){if(!this._pc.getSenders)throw C("getSenders is not supported.");const r=this._pc.getSenders().find(e=>{if(!e.track)return!1;if(!t.track)return!1;e=e.track.id;return!(!t.track.mediaTrack||e!==t.track.mediaTrack.id)||!(!t.track.imageStreamTrack||e!==t.track.imageStreamTrack.id)});if(!r)throw C("sender not found when replaceProducerTrack: "+t.trackID);if(!r.replaceTrack)throw C("replaceTrack is not supported.");"image"===e?(S.debug("replaceTrack",t.track.imageStreamTrack.mediaTrack),await r.replaceTrack(t.track.imageStreamTrack.mediaTrack)):"video"===e&&(S.debug("replaceTrack",t.track.mediaTrack),await r.replaceTrack(t.track.mediaTrack))}restartICE(e,t){return S.log("restart send ice"),this._isRestartingICE=!0,Promise.resolve().then(()=>this._remoteSdp.updateICEData(e,t)).then(()=>gt(this._pc,this._simulcast,{iceRestart:!0})).then(e=>this._pc.setLocalDescription(e)).then(()=>{var e={type:"answer",sdp:this._remoteSdp.createRemoteAnswer(this._pc.localDescription.sdp)};return this._pc.setRemoteDescription(e)})}_setupTransport(r){const t=Date.now();return Promise.resolve().then(()=>this._pc.localDescription||gt(this._pc,this._simulcast)).then(e=>this.safeEmitAsPromise("@needpubpc",e.sdp,r)).then(e=>(T.addEvent("PublisherPC",{signal_take_time:Date.now()-t,result_code:e.code,up_stream_ip:(e.iceCandidates||[]).map(({ip:e})=>e).join(","),tracks:e.tracks.map(t=>{var e=r.find(e=>e.mediaTrack.id===t.localid);if(e)return{local_id:t.localid,track_id:t.trackid,source_type:e.sourceType,kind:e.info.kind,tag:e.info.tag||"",muted:!!e.info.muted,master:!!e.master,kbps:e.info.kbps||-1,encode_video_width:0,encode_video_height:0}}).filter(e=>void 0!==e)}),this.pcid=e.pcid,this._transportReady=!0,this._pcReady=this.getReady(e),this._remoteSdp.setTransportRemoteParameters(e)))}}class Wr extends Vr{constructor(e,t,r){super("recv",e,r),this._transportCreated=!1,this._consumerInfos=new Map,(this._signaling=t).on("on-subpc-state",e=>{this._remoteSdp.transportRemoteParameters&&e.pcid===this._remoteSdp.transportRemoteParameters.pcid&&(e.connected||this.emit("@connectionstatechange","remote-disconnected"))}),S.log("init recvhandler",this)}getReady(n){return new Promise((t,e)=>{const r=e=>{e.pcid===n.pcid&&(this._signaling.off("on-subpc-state",r),e.connected&&(this.isPcReady=!0,t()))};this._signaling.on("on-subpc-state",r)})}async addConsumerTracks(n){if(b.unifiedPlan&&At){const i=[];for(const e of n){const n=await this.addConsumerTrack(e);i.push(n)}return i}S.log("add consumers",n);const i=[],e=Array.from(this._consumerInfos.values());for(const t of n){const n=e.find(e=>e.consumerId===t.id);if(n&&!n.closed)i.push(n);else{const n=this.genNewConsumerInfo(t);if(b.unifiedPlan){const i=t.mid;n.mid=i,this._consumerInfos.set(i,n)}else this._consumerInfos.set(t.id,n);i.push(n)}}return Promise.resolve().then(()=>{var e={type:"offer",sdp:this._remoteSdp.createRemoteOffer(Array.from(this._consumerInfos.values()))};return S.debug("subscribe: set remote offer",e),this._pc.setRemoteDescription(e)}).then(()=>(b.unifiedPlan,this._pc.createAnswer())).then(e=>(S.debug("subscribe, set local answer",e),this._pc.setLocalDescription(e))).then(()=>this._pcReady).then(()=>{for(let e=0;e<i.length;e+=1){const t=i[e],r=n[e];if(!r.track){if(b.unifiedPlan){const n=this._pc.getTransceivers().find(e=>!!e.receiver.track&&(e.receiver.track.id===t.trackID||e.mid===t.mid));n&&(r.track=n.receiver.track)}else if(b.getReceivers){const n=this._pc.getReceivers().find(e=>{e=e.track;return!!e&&t.trackID===e.id});n&&(r.track=n.track)}else{const n=this._pc.getRemoteStreams().find(e=>e.id===t.streamId);n&&(r.track=n.getTrackById(t.trackID))}if(!r.track)throw C("remote track not found");S.log("subscribe: get new track",r.track)}}return n.map(e=>e.track)})}genNewConsumerInfo(e){var t=e.rtpParameters.encodings[0],r=e.rtpParameters.rtcp.cname,n=e.mid;return{kind:e.kind,streamId:b.unifiedPlan?"recv-stream-"+n:"recv-stream-"+t.ssrc,trackID:b.unifiedPlan?`consumer-${e.kind}-`+n:`consumer-${e.kind}-`+t.ssrc,ssrc:t.ssrc,rtxSsrc:t.rtx?t.rtx.ssrc:void 0,cname:r,consumerId:e.id,closed:!1}}async addConsumerTrack(r){S.log("add consumer",r);let n=null;const e=Array.from(this._consumerInfos.values()).find(e=>e.consumerId===r.id);if(e&&!e.closed)n=e;else{const e=this.genNewConsumerInfo(r);if(b.unifiedPlan){const n=r.mid;e.mid=n,this._consumerInfos.set(n,e)}else this._consumerInfos.set(r.id,e);n=e}return Promise.resolve().then(()=>{var e={type:"offer",sdp:this._remoteSdp.createRemoteOffer(Array.from(this._consumerInfos.values()))};return S.log("set ontrack"),this._pc.ontrack=e=>{S.log("ontrack",e.receiver.track)},S.debug("subscribe: set remote offer",e),this._pc.setRemoteDescription(e)}).then(()=>this._pc.createAnswer()).then(e=>(S.debug("subscribe, set local answer",e),this._pc.setLocalDescription(e))).then(()=>this._pcReady).then(()=>{let e=null;var t;if(b.unifiedPlan&&b.supportTransceivers&&r&&n?(t=this._pc.getTransceivers().find(e=>!(!e.receiver.track||e.receiver.track.id!==n.trackID&&e.mid!==n.mid||(r.track=e.receiver.track,0))))&&(e=t.receiver.track):r&&n&&((t=this._pc.getReceivers().find(e=>{e=e.track;return!!e&&n.trackID===e.id&&(r.track=e,!0)}))&&(e=t.track)),!e&&r)throw C("remote track not found");return S.log("subscribe: get new track",e,e.readyState),e})}removeConsumerTracks(e){S.log("remove consumer",e);let t=!1;for(const r of e){const e=Array.from(this._consumerInfos.values()).find(e=>e.consumerId===r.id&&!e.closed);e?(t=!0,b.unifiedPlan?(r.track=null,e.closed=!0):this._consumerInfos.delete(r.id)):S.log("can not find unpublish track target, ignore")}return t?Promise.resolve().then(()=>{var e={type:"offer",sdp:this._remoteSdp.createRemoteOffer(Array.from(this._consumerInfos.values()))};return S.log("unsubscribe set remote offer",e),this._pc.setRemoteDescription(e)}).then(()=>this._pc.createAnswer()).then(e=>(S.log("unsubscribe set local answer",e),this._pc.setLocalDescription(e))):Promise.resolve()}restartICE(e,t){return S.log("recv restart ice"),this._isRestartingICE=!0,Promise.resolve().then(()=>this._remoteSdp.updateICEData(e,t)).then(()=>{var e={type:"offer",sdp:this._remoteSdp.createRemoteOffer(Array.from(this._consumerInfos.values()))};return this._pc.setRemoteDescription(e)}).then(()=>this._pc.createAnswer()).then(e=>{this._pc.setLocalDescription(e)})}async setupTransport(e){if(this._transportCreated)return this._pcReady;const t=Date.now(),r=await this.safeEmitAsPromise("@needsubpc",e);return T.addEvent("SubscriberPC",{signal_take_time:Date.now()-t,result_code:r.code,down_stream_ip:(r.iceCandidates||[]).map(({ip:e})=>e).join(","),tracks:r.tracks.map(e=>({track_id:e.trackid,status:e.status}))}),this.pcid=r.pcid,this._transportCreated=!0,this._pcReady=this.getReady(r),S.log("init subscribe, get transport remote",r),await this._remoteSdp.setTransportRemoteParameters(r),r}}function gt(e,t,r){return t&&"chrome"===l.name?e.createOffer(r).then(e=>{var{type:t,sdp:r}=e;return r?{type:t,sdp:lt(r,3)}:e}):e.createOffer(r)}function vt(e,t,r,n){switch(e){case"send":return new Gr(t,r,n);case"recv":return new Wr(t,r,n)}}(Ge=ft=ft||{}).SEND_TRACKS="@transport:send-tracks",Ge.RESTART_SEND_ICE="@transport:send-restart-ice",Ge.REMOVE_TRACKS="@transport:remove-tracks",Ge.INIT_RECV="@transport:init-recv",Ge.RESTART_RECV_ICE="@transport:recv-restart-ice",Ge.ADD_CONUMERS="@transport:add-consumers",Ge.REMOVE_CONSUMERS="@transport:remove-consumers";class Hr extends Sr{constructor(e,t,r){super(),this.sendCommandQueue=new Ht("SendQueue"),this.recvCommandQueue=new Ht("RecvQueue"),this.simulcast=!1,this.recvInitCommandQueue=new Ht("RecvInitQueue"),this.sendTrackQueue=[],this.consumerQueue=[],this._publishTracks=new Map,this.extendedRtpCapabilities=e,this.signaling=t,this.simulcast=!!r,this.sendHandler=vt("send",e,t,{simulcast:this.simulcast}),this.recvHandler=vt("recv",e,t,{simulcast:this.simulcast}),this.handleSendHandler(),this.handleRecvHandler(),this.sendCommandQueue.on("exec",this.handleSendCommandTask.bind(this)),this.recvCommandQueue.on("exec",this.handleRecvCommandTask.bind(this)),this.recvInitCommandQueue.on("exec",this.handleRecvInitCommandTask.bind(this)),this.initSubPcPromise=new Promise(e=>{this.initSubPcPromiseResolve=e})}get publishTracks(){return Array.from(this._publishTracks.values())}resolveInitSubPcPromise(){this.initSubPcPromiseResolve&&(this.initSubPcPromiseResolve(),this.initSubPcPromiseResolve=void 0)}handleSendHandler(){this.sendHandler.on("@needpubpc",(e,t,r,n)=>{this.safeEmitAsPromise("@needpubpc",e,t).then(r).catch(n)}).on("@connectionstatechange",e=>{switch(S.log("pubpc connectionstatechange",e),T.addEvent("ICEConnectionState",{pc_type:0,state:e,id:this.sendHandler.pcid}),e){case"remote-disconnected":case"closed":case"failed":this.signaling.state===nt.OPEN?this.reconnectProducer():this.sendHandler.close();break;case"disconnected":if(this.sendHandler._isRestartingICE||!this.sendHandler.pcid)return;this.signaling.state===nt.OPEN?this.restartSendICE(this.sendHandler.pcid):this.signaling.once("@signalingauth",e=>{"disconnected"===this.sendHandler.getCurrentIceConnectionState()&&(this.extendedRtpCapabilities=e.rtpcaps,this.restartSendICE(this.sendHandler.pcid))})}}).on("@needpubtracks",(r,e,t,n)=>{const i=r.map(Ze),a=Date.now();this.signaling.request("pub-tracks",{tracks:i,sdp:e}).then(e=>{switch(T.addEvent("PublishTracks",{signal_take_time:Date.now()-a,result_code:e.code,tracks:e.tracks.map(t=>{var e=r.find(e=>e.mediaTrack.id===t.localid);if(e)return{local_id:t.localid,track_id:t.trackid,source_type:e.sourceType,kind:e.info.kind,tag:e.info.tag||"",muted:!!e.info.muted,master:!!e.master,kbps:e.info.kbps||-1,encode_video_width:0,encode_video_height:0}}).filter(e=>void 0!==e)}),e.code){case 0:break;case 10052:return n(nr());case 10061:return this.reconnectProducer(),n(Xt(10061,e.error));default:return n(Xt(e.code,e.error))}for(const r of e.tracks)if(!r.status)return void n(Xt(e.code,e.error));t(e)},n)}).on("@needunpubtracks",(e,t,r)=>{T.addEvent("UnPublishTracks",{tracks:e.map(e=>({track_id:e.trackID}))}),this.signaling.request("unpub-tracks",{tracks:e.map(e=>({trackid:e.trackID}))}).then(e=>{t(e)})}).on("@send-qos-message",e=>{this.signaling.request("send-qos-message",e)})}async sendTracks(e){return 0===e.length?Promise.resolve():this.sendCommandQueue.push(ft.SEND_TRACKS,e)}removeTracks(e){return 0===e.length?Promise.resolve():this.sendCommandQueue.push(ft.REMOVE_TRACKS,e)}async restartSendICE(e){return b.supportRestartICE?this.sendCommandQueue.push(ft.RESTART_SEND_ICE,e):Promise.resolve(this.reconnectProducer())}handleSendCommandTask(e,t){switch(e.method){case ft.SEND_TRACKS:return void(t.promise=this._execAddProducerTracks(e.data));case ft.REMOVE_TRACKS:return void(t.promise=this._execRemoveTracks(e.data));case ft.RESTART_SEND_ICE:return void(t.promise=this._execRestartSendICE(e.data))}}addTrackToPublishTracks(e){var t=e.map(e=>new Lr(this,"send",e));for(const e of t)this._publishTracks.set(e.track.mediaTrack.id,e);return t}removeTrackFromPublishTracks(e){for(const t of e)this._publishTracks.delete(t.mediaTrack.id)}async _execAddProducerTracks(e){var t=await this.sendHandler.addProducerTracks(e.map(e=>e.track));for(const w of e){const e=Se(t.tracks,"localid",w.track.mediaTrack.id);e&&(w.addTrackId(e.trackid),w.track.setInfo({versionid:e.versionid}),w.track.resetStats())}return e.map(e=>e.connectStatus=w.TrackConnectStatus.Connect),t}_execRemoveTracks(e){return this.removeTrackFromPublishTracks(e.map(e=>e.track)),e.map(e=>e.release()),this.sendHandler.removeProducerTracks(e)}async _execRestartSendICE(e){this.sendHandler._isRestartingICE=!0;var t=await this.signaling.request("pubpc-restart",{pcid:e});if(0!==t.code)return this.sendHandler._isRestartingICE=!1,S.debug("restart ice faild",t.code,t.error),void this.reconnectProducer();try{await this.sendHandler.restartICE(t.iceParameters,t.iceCandidates),this.sendHandler._isRestartingICE=!1}catch(e){S.debug("restart ice faild",t.code,t.error),this.sendHandler._isRestartingICE=!1,this.reconnectProducer()}}reconnectProducer(){this.resetSendCommandQueue(),this.sendHandler.close();const e=this.publishTracks;this.sendHandler=vt("send",this.extendedRtpCapabilities,this.signaling,{simulcast:this.simulcast}),this.handleSendHandler(),e.forEach(e=>{e.connectStatus=w.TrackConnectStatus.Connecting}),this.emit("@needrepub",e)}handleRecvHandler(){this.recvHandler.on("@needsubpc",(e,t,r)=>{this.safeEmitAsPromise("@needsubpc",e).then(t,r)}).on("@connectionstatechange",e=>{switch(S.log("sub pc connection state change",e),T.addEvent("ICEConnectionState",{pc_type:1,state:e,id:this.recvHandler.pcid}),e){case"remote-disconnected":case"closed":case"failed":this.signaling.state===nt.OPEN?this.resetRecvHandler():this.recvHandler.close();break;case"disconnected":if(this.recvHandler._isRestartingICE||!this.recvHandler.pcid)return;this.signaling.state===nt.OPEN?this.restartRecvICE(this.recvHandler.pcid):this.signaling.once("@signalingauth",e=>{"disconnected"===this.recvHandler.getCurrentIceConnectionState()&&(this.extendedRtpCapabilities=e.rtpcaps,this.restartRecvICE(this.recvHandler.pcid))})}})}appendConsumer(e){this.consumerQueue.push(e)}async addConsumers(){var e=this.consumerQueue;return this.consumerQueue=[],this.recvCommandQueue.push(ft.ADD_CONUMERS,e)}initRecvHandler(e){return this.recvInitCommandQueue.push(ft.INIT_RECV,e)}async removeConsumers(e){await this.recvCommandQueue.push(ft.REMOVE_CONSUMERS,e)}async restartRecvICE(e){return b.supportRestartICE?this.recvCommandQueue.push(ft.RESTART_RECV_ICE,e):this.resetRecvHandler()}async _removeConsumers(e){await this.recvHandler.removeConsumerTracks(e)}async _initRecvHandler(e){return this.recvHandler.isPcReady?(await this.initSubPcPromise,null):await this.recvHandler.setupTransport(e)}async _addConsumers(e){return 0===e.length?Promise.resolve([]):this.recvHandler.addConsumerTracks(e)}async _execRestartRecvICE(e){this.recvHandler._isRestartingICE=!0;var t=await this.signaling.request("subpc-restart",{pcid:e});if(0!==t.code)return this.recvHandler._isRestartingICE=!1,S.debug("restart ice faild",t.code,t.error),void this.resetRecvHandler();try{await this.recvHandler.restartICE(t.iceParameters,t.iceCandidates),this.recvHandler._isRestartingICE=!1}catch(e){this.recvHandler._isRestartingICE=!1,S.debug("restart ice faild",t.code,t.error),this.resetRecvHandler()}}handleRecvCommandTask(e,t){switch(e.method){case ft.ADD_CONUMERS:return void(t.promise=this._addConsumers(e.data));case ft.REMOVE_CONSUMERS:return void(t.promise=this._removeConsumers(e.data));case ft.RESTART_RECV_ICE:return void(t.promise=this._execRestartRecvICE(e.data))}}handleRecvInitCommandTask(e,t){if(e.method===ft.INIT_RECV)t.promise=this._initRecvHandler(e.data)}resetSendCommandQueue(){S.log("reset send queue"),this.sendCommandQueue=new Ht("SendQueue"),this.sendCommandQueue.on("exec",this.handleSendCommandTask.bind(this))}resetRecvCommandQueue(){S.log("reset recv queue"),this.recvCommandQueue=new Ht("RecvQueue"),this.recvInitCommandQueue=new Ht("RecvInitQueue"),this.recvCommandQueue.on("exec",this.handleRecvCommandTask.bind(this)),this.recvInitCommandQueue.on("exec",this.handleRecvInitCommandTask.bind(this))}resetRecvHandler(){this.resetRecvCommandQueue(),this.emit("@needresetrecv"),this.recvHandler.close(),this.recvHandler=vt("recv",this.extendedRtpCapabilities,this.signaling,{simulcast:this.simulcast}),this.initSubPcPromise=new Promise(e=>{this.initSubPcPromiseResolve=e}),this.handleRecvHandler(),this.emit("@needresub")}release(){this.recvHandler.close(),this.sendHandler.close(),this.publishTracks.forEach(e=>e.release())}}(t=w.RoomState||(w.RoomState={}))[t.Idle=0]="Idle",t[t.Connecting=1]="Connecting",t[t.Connected=2]="Connected";const zr={transportPolicy:"preferUdp",simulcast:!(t[t.Reconnecting=3]="Reconnecting"),reconnectTimes:3};class Jr extends e{constructor(e=zr){super(),this._trackInfo=[],this.recorder=new xr,this.subscribeTracks=[],this._users=new Map,this._roomState=w.RoomState.Idle,this.mergeJobMerger={},this.defaultMergeJobTracks=[],this.mergeJobTracks={},this._publish=(a,o)=>new Promise(async(t,r)=>{if(this.roomState===w.RoomState.Connected){0===a.length&&t(),a.forEach(e=>e.userID=this.userID);const n=this.connectionTransport,i=this.signaling;let e;if(o){const w=a.map(e=>e.mediaTrack.id);e=n.publishTracks.filter(e=>-1!==w.indexOf(e.track.mediaTrack.id))}else{const w=n.publishTracks.map(e=>e.track.mediaTrack.id);if(a.filter(e=>-1===w.indexOf(e.mediaTrack.id)).length!==a.length)return void r(C("there are already published tracks in the provided tracks"));e=n.addTrackToPublishTracks(a)}if(S.debug("start publish",e,o),!o){const w=e.map(e=>e.startConnect());Promise.all(w).then(()=>t()).catch(()=>{r(cr())})}try{await n.sendTracks(e),i.sendWsMsg("mute-tracks",{tracks:e.map(e=>({trackid:e.trackID,muted:!!e.track.info.muted}))});const w=Se(this.users,"userID",this.userID);if(w){w.addTracks(e.map(e=>e.track));let t=[];!0===this.config.simulcast&&(t=["high","medium","low"]),w.addPublishedTrackInfo(e.map(e=>({trackID:e.trackID,muted:!!e.track.info.muted,kind:e.track.info.kind,tag:e.track.info.tag,userID:this.userID,versionid:e.track.info.versionid,profiles:t})))}a.forEach(i=>{i.on("@get-stats",(e,t,r)=>{if(!this.connectionTransport)return t([]);var n=(i.isReplacedByImageTrack?i.imageStreamTrack:i).mediaTrack;this.connectionTransport.sendHandler.getStats(n,e).then(t,r)})}),this.getAllMerger().forEach(e=>e.controller.onAddTracks(a.map(e=>e.info)))}catch(e){if(e instanceof qt)switch(e.code){case 10061:case 30001:return;case 10052:return S.warning(e,"republish"),void setTimeout(()=>this._publish(a,!0),1e3);default:n.removeTrackFromPublishTracks(a),r(e)}else S.warning(e,"republish"),setTimeout(()=>this._publish(a,!0),1e3)}}else r(C("not connected to the room, please run joinRoom first"))}),this._subscribe=(d,l,h=!1,f)=>new Promise(async(r,n)=>{if(this.roomState===w.RoomState.Connected)if(0!==d.length){S.debug("subscribe",d,l);const a=this._trackInfo.filter(e=>d.includes(e.trackid));if(a.length===d.length){let t;const o=this.connectionTransport,s=this.signaling;if(l)t=this.subscribeTracks.filter(e=>-1!==d.indexOf(e.trackID));else{const w=this.subscribeTracks.map(e=>e.trackID),d=a.filter(e=>!w.includes(e.trackid));t=d.map(e=>new Lr(o,"recv",void 0,e.trackid,e.mid)),this.subscribeTracks=this.subscribeTracks.concat(t)}S.log("sub tracks",t,f);try{if(!l){const w=t.map(e=>e.startConnect());Promise.all(w).then(()=>r(t.map(e=>e.track))).catch(()=>{n(cr())})}let e=await o.initRecvHandler(t.map(e=>e.trackID));if(!e){const w=Date.now();e=await s.request("sub-tracks",{tracks:t.map(e=>{var t=f&&f[e.trackID];return t?{trackid:e.trackID,profile:t}:{trackid:e.trackID}})}),T.addEvent("SubscribeTracks",{result_code:e.code,signal_take_time:Date.now()-w,tracks:e.tracks.map(e=>({track_id:e.trackid,status:e.status}))})}switch(S.log("get sub res data",e),e.code){case 0:break;case 10052:throw nr();case 10062:throw o.resetRecvHandler(),er(10062,e.error);default:throw er(e.code,e.error)}const c=e.tracks.filter(e=>!!e.status),u=e.tracks.filter(e=>!e.status).map(e=>e.trackid);if(c.length<e.tracks.length&&h)throw er(10041,"can not find target track id: "+u.join(" "));if(c&&!h){S.debug(`can not find target track id: ${u.join("")}, continue`);const w=ie(t,e=>-1!==u.indexOf(e.trackID));ie(this.subscribeTracks,e=>-1!==u.indexOf(e.trackID)),w.map(e=>e.release())}e.tracks=c;for(const w of e.tracks||[]){const d=t.find(e=>e.trackID===w.trackid),l=a.find(e=>e.trackid===w.trackid);if(d&&l){const h=w.rtpparams;d.appendConsumner(h,l.kind)}}await o.addConsumers(),o.resolveInitSubPcPromise();for(const w of t){const d=w["consumer"];if(d&&d.track){const l=d.track;let n=w.track;const f=a.find(e=>e.trackid===d.id);if(f){n?n.resume(l):"audio"===l.kind?(n=new Ur(l,f.playerid,"remote")).initAudioManager():n=new Tr(l,f.playerid,"remote",f.profiles||[]),n.setInfo({trackID:f.trackid,userID:f.playerid,tag:f.tag,kind:f.kind,muted:f.muted,versionid:f.versionid}),n.setMaster(f.master),n.removeAllListeners("@get-stats"),n.removeAllListeners("@ended"),n.on("@get-stats",(e,t,r)=>{if(!this.connectionTransport)return t([]);this.connectionTransport.recvHandler.getStats(n.mediaTrack,e).then(t,r)}),n.once("@ended",async()=>{if(n&&n.info.trackID){S.warning("remote track ended, try to resubscribe");try{await this._unsubscribe([n.info.trackID],!0)}catch(e){}await this._subscribe([n.info.trackID],!0)}}),w.track=n;const r=this.users.find(e=>e.userID===f.playerid);r&&r.addTracks([n])}}}t.forEach(e=>e.connectStatus=w.TrackConnectStatus.Connect);var i=e.tracks.map(t=>{if(void 0===t.muted)for(let e=0;e<this._trackInfo.length;e++)t.trackid===this._trackInfo[e].trackid&&(t.muted=this._trackInfo[e].muted);return t});this.handleMute({tracks:i})}catch(e){S.log(e);const l=[];if(t.forEach(e=>{e.consumer&&l.push(e.consumer)}),await o.removeConsumers(l),!(e instanceof qt))return S.warning(e,"resubscribe"),void setTimeout(()=>this._subscribe(d,!0),1e3);switch(e.code){case 10062:case 30001:return;case 10052:return S.warning(e,"resubscribe"),void setTimeout(()=>this._subscribe(d,!0),1e3);default:ie(this.subscribeTracks,e=>-1!==d.indexOf(e.trackID)),n(e)}}r(t.map(e=>e.track))}else n(er(10041,"can not find track in room "+d))}else r([]);else n(C("can not connected to the room, please joinRoom first"))}),e=W({},zr,e),this.config=e,S.log("config",e),S.log("version",Wt),S.log("browser report",b,l)}get users(){return Array.from(this._users.values())}get trackInfoList(){return this._trackInfo.map(Ke)}get roomState(){return this._roomState}set roomState(e){this._roomState!==e&&(this._roomState=e,S.debug("roomState change",this._roomState),this.emit("room-state-change",this._roomState),T.addEvent("RoomStateChanged",{room_state:e}))}_setReconnectTimes(e){this.config.reconnectTimes=e,this.signaling&&(this.signaling.reconnectTimes=e)}_getReconnectTimes(){return this.config.reconnectTimes||zr.reconnectTimes}_setProfile(t,e){this.profile=e,this.subscribeTracks.some(e=>e.trackID===t)&&this.signaling.sendWsMsg("set-sub-profile",{tracks:[{trackid:t,profile:this.profile}]})}async joinRoomWithToken(e,t){if(this.roomState!==w.RoomState.Idle)throw C("roomState is not idle! Do not repeat join room, please run leaveRoom first");this.roomState=w.RoomState.Connecting,T.addEvent("JoinRoom",{room_token:e,user_data:t});try{this.roomToken=e,this.userData=t;var r=we(e);if(this.userID=r.userId,this.roomName=r.roomName,this.appId=r.appId,S.log("join room, token:",e),S.debug(`join room, roomName: ${this.roomName}, userID: `+this.userID),!this.roomName.match(/^[a-zA-Z0-9_-]{3,64}$/))throw this.roomState=w.RoomState.Idle,C("invalid roomname. roomname must match /^[a-zA-Z0-9_-]{3,64}$/");if(!this.userID.match(/^[a-zA-Z0-9_-]{3,50}$/))throw this.roomState=w.RoomState.Idle,C("invalid userID. userID must match /^[a-zA-Z0-9_-]{3,50}$/");try{const w=await ht(r,e);this.accessToken=w.accessToken,T.setSessionId(w.sessionId),T.setUserBase(this.userID,this.roomName,this.appId)}catch(e){throw e}return await this.joinRoomWithAccess(this.accessToken)}catch(e){throw this.roomState=w.RoomState.Idle,e}}async joinRoomWithAccess(e){var t=_e(e),r=(await async function(){const e=Fe(),t=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});b.needH264FmtpLine&&(t.sdp+=`a=fmtp:107 level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f
`);var r={capsdp:t.sdp,agent:navigator.userAgent};return e.close(),r}())["capsdp"];if(this._roomState===w.RoomState.Idle)throw C("roomState is idle, maybe because you left the room.");const n=new Pr(t.signalingurl2,e,r,this._getReconnectTimes(),this.userData);n.on("@error",this.handleDisconnect.bind(this)).on("@ws-state-change",(e,t)=>{t===nt.CONNECTING&&(this.roomState===w.RoomState.Connected?this.roomState=w.RoomState.Reconnecting:this.roomState!==w.RoomState.Reconnecting&&(this.roomState=w.RoomState.Connecting))}).on("@needupdateaccesstoken",(e,t)=>{this.updateAccessToken().then(e).catch(t)}).on("on-player-in",this.handlePlayerIn.bind(this)).on("on-player-out",this.handlePlayerOut.bind(this)).on("on-add-tracks",e=>{this.filterSignalTracks(e),this.handleAddTracks(e)}).on("on-remove-tracks",e=>{this.filterSignalTracks(e),this.handleRemoveTracks(e)}).on("mute-tracks",e=>{this.filterSignalTracks(e),this.handleMute(e)}).on("on-messages",this.handleCustomMessages.bind(this)).on("on-qos-messages",this.handleQosMessages.bind(this)).on("on-pubpc-restart-notify",e=>{const t=this.connectionTransport;T.addEvent("AbnormalDisconnect",{event_reason:"on-pubpc-restart-notify",event_description:e.error}),t&&b.supportRestartICE&&t.restartSendICE(e.pcid).catch(S.debug)}).on("on-subpc-restart-notify",e=>{const t=this.connectionTransport;T.addEvent("AbnormalDisconnect",{event_reason:"on-subpc-restart-notify",event_description:e.error}),t&&b.supportRestartICE&&t.restartRecvICE(e.pcid).catch(S.debug)}).on("on-sub-profile-changed",e=>{this.emit("on-sub-profile-changed",e)}).on("disconnect",this.handleDisconnect.bind(this)).on("on-player-reconnect",this.handleRemoteUserReconnecting.bind(this)).on("on-player-reconnect-in",this.handleRemoteUserReconnected.bind(this)),S.log("init signaling websocket"),this.signaling=n;try{const w=await n.initWs(!0);n.on("@signalingauth",this.handleAuth.bind(this)),await this.handleAuth(w)}catch(e){if(this.signaling&&(this.signaling.release(),this.signaling=void 0),10052===e.code)return await Pe(1e3),this.joinRoomWithToken(this.roomToken,this.userData);throw e}return 0<this.trackInfoList.length&&this.emit("user-published",this.trackInfoList),this.users}async _unpublish(t){if(this.roomState!==w.RoomState.Connected)throw C("not connected to the room");if(0!==t.length){S.debug("unpublish",t);const e=this.connectionTransport,r=e.publishTracks.filter(e=>-1!==t.indexOf(e.trackID));if(r.length!==t.length)throw C("can not find target trackid to unpublish");await e.removeTracks(r),this.getAllMerger().forEach(e=>e.controller.onRemoveTracks(r.map(e=>e.track.info)));const n=Se(this.users,"userID",this.userID);n&&(n.removeTracksByTrackId(t),n.removePublishedTrackInfo(t)),this.cleanTrackIdsFromMergeJobs(t)}}async createMergeJob(e,t){if(this.roomState!==w.RoomState.Connected)throw C("can not createMergeJob, room state is not connected");var t=W({},Vt,t,{id:e}),r=(S.debug("send create merge job",t,e),Date.now()),t=await this.signaling.request("create-merge-job",t);if(T.addEvent("CreateMergeJob",{signal_take_time:Date.now()-r,id:e,result_code:t.code}),0!==t.code)throw Kt(t.code,t.error);this.mergeJobTracks[e]?S.warning("merge job id already exist",e):this.mergeJobTracks[e]=[]}setDefaultMergeStream(e,t,r){if(r&&!this.mergeJobTracks[r])throw or(r);this.merger&&!r&&(this.merger.release(),this.merger=void 0),r&&this.mergeJobMerger[r]&&(this.mergeJobMerger[r].release(),delete this.mergeJobMerger[r]);var n=this.CreateMergerSessionController();r?this.mergeJobMerger[r]=new Mr(e,t,n,r):this.merger=new Mr(e,t,n,r)}_stopMerge(e){if(this.roomState!==w.RoomState.Connected)throw C("can not addMergeTracks, room state is not connected");if(e&&!this.mergeJobTracks[e])throw or(e);T.addEvent("StopMerge",{id:e||""}),this.signaling.sendWsMsg("stop-merge",{id:e}),e?(delete this.mergeJobTracks[e],this.mergeJobMerger[e]&&(this.mergeJobMerger[e].release(),delete this.mergeJobMerger[e])):(this.defaultMergeJobTracks=[],this.merger&&(this.merger.release(),this.merger=void 0))}async _addMergeTracks(e,t){if(this.roomState!==w.RoomState.Connected)throw C("can not addMergeTracks, room state is not connected");if(t&&!this.mergeJobTracks[t])throw or(t);const r=e.map(e=>({trackid:e.trackID,x:e.x,y:e.y,w:e.w,h:e.h,z:e.z,stretchMode:e.stretchMode})),n={id:t,add:r};S.debug("addMergeTracks",n),t?(this.mergeJobTracks[t]=this.mergeJobTracks[t].concat(e.map(e=>e.trackID)),this.mergeJobTracks[t]=ze(this.mergeJobTracks[t],e=>e)):(this.defaultMergeJobTracks=this.defaultMergeJobTracks.concat(e.map(e=>e.trackID)),this.defaultMergeJobTracks=ze(this.defaultMergeJobTracks,e=>e)),T.addEvent("UpdateMergeTracks",{id:t||"",add:r.map(e=>({track_id:e.trackid,x:e.x||0,y:e.y||0,w:e.w||0,h:e.h||0,z:e.z||0}))}),await this.signaling.request("update-merge-tracks",n)}async _removeMergeTracks(t,e){if(this.roomState!==w.RoomState.Connected)throw C("can not addMergeTracks, room state is not connected");if(e&&!this.mergeJobTracks[e])throw or(e);const r={id:e,remove:t.map(e=>({trackid:e}))};S.debug("removeMergeTracks",r),ie(e?this.mergeJobTracks[e]:this.defaultMergeJobTracks,e=>-1!==t.indexOf(e)),T.addEvent("UpdateMergeTracks",{id:e||"",remove:r.remove.map(e=>({track_id:e.trackid}))}),await this.signaling.request("update-merge-tracks",r)}async _unsubscribe(t,e){if(this.roomState!==w.RoomState.Connected)throw C("no signaling model, please run joinRoomWithToken first");const r=this.subscribeTracks.filter(e=>-1!==t.indexOf(e.trackID));S.debug("unsubscribe",r),0!==r.length&&(T.addEvent("UnSubscribeTracks",{tracks:t.map(e=>({track_id:e}))}),this.signaling.request("unsub-tracks",{tracks:r.map(e=>({trackid:e.trackID}))}),e||(r.forEach(e=>e.release()),ie(this.subscribeTracks,e=>-1!==t.indexOf(e.trackID))),await this.connectionTransport.removeConsumers(r.map(e=>e.consumer)))}_muteTracks(e){if(this.roomState!==w.RoomState.Connected)throw C("no signaling model, please run joinRoomWithToken first");const t=this.connectionTransport,r={},n=(e.forEach(e=>{r[e.trackID]=e.muted}),t.publishTracks.filter(e=>void 0!==r[e.trackID]));n.forEach(e=>{e.setMute(r[e.trackID])}),T.addEvent("MuteTracks",{tracks:n.map(e=>({track_id:e.trackID,muted:e.track.info.muted,kind:e.track.info.kind}))}),this.signaling.sendWsMsg("mute-tracks",{tracks:e.map(e=>({trackid:e.trackID,muted:e.muted}))})}async kickoutUser(e){S.log("kickoutUser",e),await this.control("kickplayer",e)}sendCustomMessage(e,t,r){if(this.roomState!==w.RoomState.Connected)throw C("room state is not connected, can not send message");r=r||Ie(8),t=t&&0!==t.length?t:void 0;this.signaling.sendWsMsg("send-message",{msgid:r,target:t,type:"normal",text:e}),S.debug("send custom message",e,t,r)}async pushCameraTrackWithImage(t,e){if(this.roomState!==w.RoomState.Connected)throw C("no signaling model, please run joinRoomWithToken first");S.log("pushCameraTrackWithImage",{trackID:t,source:e});const r=this.connectionTransport.publishTracks.find(e=>e.trackID===t);if(void 0===r||void 0===r.track)throw C("track not exist: "+t);if("video"!==r.track.info.kind)throw C("track kind is not video: "+t);return r.track.imageStreamTrack||(r.track.imageStreamTrack=new Dr),void 0===e&&r.track.isReplacedByImageTrack?(await this.connectionTransport.sendHandler.replaceProducerTrack(r,"video"),r.track.isReplacedByImageTrack=!1,void r.track.switchPlayingTrack()):void 0!==e&&r.track&&!r.track.isReplacedByImageTrack?(await r.track.imageStreamTrack.setSource(e),await this.connectionTransport.sendHandler.replaceProducerTrack(r,"image"),r.track.isReplacedByImageTrack=!0,void r.track.switchPlayingTrack()):void 0}leaveRoom(){this.roomState!==w.RoomState.Idle?(S.log("leave room"),T.addEvent("LeaveRoom",{leave_reason_code:0}),this.signaling&&this.signaling.sendDisconnect(),this.releaseRoom()):S.log("can not leave room, please join room first")}_releasePublishTracks(){}async control(e,t){if(this.roomState!==w.RoomState.Connected)throw C("can not connected to the room, please run joinRoom first");var r=Date.now(),n=await this.signaling.request("control",{command:e,playerid:t});if("kickplayer"===e&&T.addEvent("KickoutUser",{signal_take_time:Date.now()-r,user_id:t,result_code:n.code}),n.error)throw tr(n.code,n.error)}handlePlayerOut(t){const r=this._users.get(t.playerid);r&&(this._users.delete(t.playerid),ie(this._trackInfo,e=>e.playerid===t.playerid),ie(this.subscribeTracks,e=>e.track.userID===r.userID).forEach(e=>e.release()),Re(()=>{S.debug("user-leave",r),this.emit("user-leave",r)}))}handlePlayerIn(e){const t=Ye(e);this._users.set(t.userID,t),Re(()=>{S.debug("user-join",t),this.emit("user-join",t)})}handleAddTracks({tracks:e}){S.log("receive track-add",e,W({},this._trackInfo));const t=new Set;for(const W of e){const e=Se(this.users,"userID",W.playerid);if(e)if(e.published&&!t.has(e.userID)&&"stream"===this.sessionMode){const t=e.publishedTrackInfo.map(e=>Qe(e,!0));this.handleRemoveTracks({tracks:t}),t.push(W),this.handleAddTracks({tracks:t})}else this._trackInfo.push(W),e.addPublishedTrackInfo([Ke(W)]),t.add(e.userID)}if("stream"===this.sessionMode)for(const e of Array.from(t))Re(()=>{S.debug("user-publish",this._users.get(e)),this.emit("user-publish",this._users.get(e))});Re(()=>{S.debug("track-add",e.map(Ke)),this.emit("track-add",e.map(Ke))})}handleRemoveTracks({tracks:t}){S.log("receive track-remove",t,W({},this._trackInfo));const e=ie(this._trackInfo,e=>t.map(e=>e.trackid).includes(e.trackid)),r=new Set;for(const t of e){const e=this._users.get(t.playerid);if(e){e.removePublishedTrackInfo([t.trackid]),e.removeTracksByTrackId([t.trackid]),r.add(e.userID);const W=ie(this.subscribeTracks,e=>e.trackID===t.trackid)[0];W&&W.release()}}if(this.cleanTrackIdsFromMergeJobs(t.map(e=>e.trackid)),"stream"===this.sessionMode)for(const t of Array.from(r)){const e=this._users.get(t);if(e.published){const t=e.publishedTrackInfo.map(e=>Qe(e,!0));this.handleRemoveTracks({tracks:t}),this.handleAddTracks({tracks:t})}else Re(()=>{S.debug("user-unpublish",e),this.emit("user-unpublish",e)})}Re(()=>{S.debug("track-remove",e.map(Ke)),this.emit("track-remove",e.map(Ke))})}handleMute({tracks:r}){for(const e of r){const r=e.trackid,n=e.muted,i=Se(this._trackInfo,"trackid",r);if(!i)return;const a=this._users.get(i.playerid);if(!a)return;const o=a.publishedTrackInfo.find(e=>e.trackID===r),s=(o&&(o.muted=n),a.tracks.find(e=>e.info.trackID===r)),c=(s&&(s.info.muted=n,s.setMute(n)),i.muted=n,this.subscribeTracks.filter(e=>e.trackID===r)[0]);c&&c.setMute(n);let t=void 0;for(let e=0;e<this._trackInfo.length;e+=1)this._trackInfo[e].playerid===i.playerid&&this._trackInfo[e].kind!==i.kind&&(t=this._trackInfo[e]);const u={userID:i.playerid,muteAudio:!1,muteVideo:!1};"audio"===i.kind?(u.muteAudio=n,u.muteVideo=!!t&&t.muted):(u.muteVideo=n,u.muteAudio=!!t&&t.muted),"stream"===this.sessionMode&&Re(()=>{S.log("user-mute",u),this.emit("user-mute",u)})}Re(()=>{S.log("mute-tracks",r.map(e=>({trackID:e.trackid,muted:e.muted}))),this.emit("mute-tracks",r.map(e=>({trackID:e.trackid,muted:e.muted})))})}handleCustomMessages({messages:e}){this.emit("messages-received",e.map(Xe))}handleQosMessages({messages:e}){const n=[];e.forEach(t=>{try{const r=JSON.parse(t.qos);r.tracks_qos.forEach(e=>{n.push({userID:t.playerid,networkGrade:r.networkGrade,kind:e.kind,trackID:e.track,packetLossRate:e.lostRate,rtt:e.rtt})})}catch(t){S.warning("parse SignalingQosMessage error: ",t)}}),this.emit("remote-track-stats",n)}handleDisconnect(e){if(S.log("handle disconnect",e.code,e),-1===[0,10005,10006].indexOf(e.code)&&T.addEvent("AbnormalDisconnect",{event_reason:"websocket_error",event_description:e.error}),T.addEvent("LeaveRoom",{leave_reason_code:e.code}),10052===e.code&&this.roomToken)return this.roomState=w.RoomState.Reconnecting,void setTimeout(()=>this.signaling.initWs(),1e3);10006===(this.releaseRoom(),e.code)?this.emit("disconnect",{code:e.code,data:{userID:e.kickedid}}):this.emit("disconnect",{code:e.code})}handleRemoteUserReconnecting(t){var e=this.users.find(e=>e.userID===t.playerid);e&&(S.debug("remote-user-reconnecting",e),this.emit("remote-user-reconnecting",e))}handleRemoteUserReconnected(t){var e=this.users.find(e=>e.userID===t.playerid);e&&(S.debug("remote-user-reconnected",e),this.emit("remote-user-reconnected",e))}async updateAccessToken(){var e=await ht(we(this.roomToken),this.roomToken),e=(T.setSessionId(e.sessionId),this.accessToken=e.accessToken,_e(e.accessToken));if(!this.signaling)throw C("room state is idle when updateAccessToken");this.signaling.accessToken=this.accessToken,this.signaling.setUrl(e.signalingurl2)}async handleAuth(t){if(this.filterSignalTracks(t),S.debug("handleAuth",t),t.error)await this.joinRoomWithToken(this.roomToken,this.userData);else{t.tracks=t.tracks||[],t.tracks=t.tracks.filter(e=>e.playerid!==this.userID),t.players=t.players||[];const i=this.roomState===w.RoomState.Reconnecting;let e={join:[],leave:[],add:[],remove:[],mute:[]};var r=Array.from(this._users.keys()),n=t.players.map(e=>e.playerid);if(e=function(n,i,a,t,r){const o={join:[],leave:[],add:[],remove:[],mute:[]},s=i.map(e=>e.trackid),c=a.map(e=>e.trackid);return s.forEach((t,e)=>{if(i[e].playerid!==n)if(-1===c.indexOf(t))o.remove.push(i[e]);else{const n=a.find(e=>e.trackid===t),r=i[e];n.versionid!==r.versionid&&(o.remove.push(r),o.add.push(n))}}),c.forEach((e,t)=>{var r;a[t].playerid!==n&&(-1===(r=s.indexOf(e))?(o.add.push(a[t]),o.mute.push({trackid:e,muted:a[t].muted})):a[t].muted!==i[r].muted&&o.mute.push({trackid:e,muted:a[t].muted}))}),t.forEach(e=>{e!==n&&-1===r.indexOf(e)&&o.leave.push({playerid:e})}),r.forEach(e=>{e!==n&&-1===t.indexOf(e)&&o.join.push({playerid:e})}),o}(this.userID,this._trackInfo,t.tracks,r,n),this.roomState=w.RoomState.Connected,i)S.debug("get missing events",e),0<e.remove.length&&this.handleRemoveTracks({tracks:e.remove}),0<e.leave.length&&e.leave.forEach(this.handlePlayerOut.bind(this)),0<e.join.length&&e.join.forEach(this.handlePlayerIn.bind(this)),0<e.add.length&&this.handleAddTracks({tracks:e.add}),0<e.mute.length&&this.handleMute({tracks:e.mute});else{this._trackInfo=t.tracks,this._users.clear();for(const w of t.players||[]){const t=Ye(w),i=this._trackInfo.filter(e=>e.playerid===t.userID);t.addPublishedTrackInfo(i.map(Ke)),this._users.set(t.userID,t)}}if(this.connectionTransport){const i=this.connectionTransport.publishTracks.filter(e=>e.connectStatus===w.TrackConnectStatus.Connecting),e=this.subscribeTracks.filter(e=>e.connectStatus===w.TrackConnectStatus.Connecting);this.connectionTransport.extendedRtpCapabilities=t.rtpcaps,(!this.connectionTransport.sendHandler.isPcReady||this.connectionTransport.sendHandler._isRestartingICE||0<i.length)&&this.connectionTransport.reconnectProducer(),(!this.connectionTransport.recvHandler.isPcReady||this.connectionTransport.recvHandler._isRestartingICE||0<e.length)&&this.connectionTransport.resetRecvHandler()}else this.connectionTransport=this.createConnectionTransport(t.rtpcaps)}}createConnectionTransport(e){const i=this.signaling,t=new Hr(e,i,this.config.simulcast);return t.on("@needpubpc",(e,t,r,n)=>{i.request("pubpc",{sdp:e,tracks:t.map(Ze),policy:this.config.transportPolicy}).then(e=>{switch(e.code){case 0:return void r(e);case 10052:throw nr();default:throw Zt(e.error)}}).catch(n)}),t.on("@needsubpc",(e,t,r)=>{i.request("subpc",{tracks:e.map(e=>this.profile?{trackid:e,profile:this.profile}:{trackid:e}),policy:this.config.transportPolicy}).then(e=>{switch(e.code){case 0:return void t(e);case 10052:throw nr();default:throw Qt(e.error)}}).catch(r)}).on("@needresub",()=>{var e=this.subscribeTracks.map(e=>e.trackID);this.subscribeTracks.forEach(e=>e.connectStatus=w.TrackConnectStatus.Connecting),this._subscribe(e,!0)}).on("@needrepub",e=>{this._publish(e.map(e=>e.track),!0)}).on("@needresetrecv",()=>{this.subscribeTracks.filter(e=>!!e.track).forEach(e=>{e.track.removeAllListeners("@ended")})}),t}cleanTrackIdsFromMergeJobs(t){ie(this.defaultMergeJobTracks,e=>-1!==t.indexOf(e));for(const e in this.mergeJobTracks)ie(e,e=>-1!==t.indexOf(e))}CreateMergerSessionController(){const t=new Ar,e=e=>{t.onAddTracks(e)},r=e=>{t.onRemoveTracks(e)};return this.on("track-add",e),this.on("track-remove",r),t.getCurrentTracks=()=>{if(!this.connectionTransport)return[];const e=this._trackInfo.map(Ke),t=this.connectionTransport.publishTracks.map(e=>e.track.info);return e.concat(t)},t.addMergeTrack=(e,t)=>{this._addMergeTracks(e,t)},t.release=()=>{this.off("track-add",e),this.off("track-remove",r)},t}getAllMerger(){const e=[];this.merger&&e.push(this.merger);for(const t in this.mergeJobMerger)e.push(this.mergeJobMerger[t]);return e}releaseRoom(){this.releaseSession(),this.signaling&&(this.signaling.release(),this.signaling=void 0),T.addEvent("UnInit",{id:this.sessionMode+"_"+Date.now()},!0),this.connectionTransport&&(this.connectionTransport.release(),this.connectionTransport=void 0),this.getAllMerger().map(e=>{e.release()}),this.defaultMergeJobTracks=[],this.mergeJobTracks={},this.merger=void 0,this.mergeJobMerger={},this.roomState=w.RoomState.Idle,this._trackInfo=[],this._users.clear(),this.userID=void 0,this.subscribeTracks.forEach(e=>{e.release()}),this.subscribeTracks=[]}}class qr extends Jr{get publishedTracks(){return this.connectionTransport?this.connectionTransport.publishTracks.filter(e=>e.connectStatus===w.TrackConnectStatus.Connect).map(e=>e.track):[]}get subscribedTracks(){return this.subscribeTracks.filter(e=>e.connectStatus===w.TrackConnectStatus.Connect).map(e=>e.track)}get mergeStreamTracks(){return this.defaultMergeJobTracks}get mergeStreamJobTracks(){return this.mergeJobTracks}constructor(e){super(e),this.sessionMode="track",T.addEvent("Init",{id:this.sessionMode+"_"+Date.now()})}async join(e,t){return this.joinRoomWithToken(e,t)}leave(){this.leaveRoom()}async publish(e){return this._publish(e)}async unpublish(e){return this._unpublish(e)}async subscribe(e,t=!1,r){return this._subscribe(e,!1,t,r)}async unsubscribe(e){return this._unsubscribe(e)}setProfile(e,t){this._setProfile(e,t)}setReconnectTimes(e){this._setReconnectTimes(e)}getReconnectTimes(){return this._getReconnectTimes()}muteTracks(e){this._muteTracks(e)}async addMergeStreamTracks(e,t){await this._addMergeTracks(e,t)}async removeMergeStreamTracks(e,t){await this._removeMergeTracks(e,t)}stopMergeStream(e){this._stopMerge(e)}filterSignalTracks(){}releaseSession(){}}const $r=(e,t,r)=>`/rtc/token/app/${r}/room/${e}/user/`+t;async function yt(){S.log("start checkSystemRequirements");var r=Date.now();let t=!1,n="";const i=new qr,a=new qr,h=await async function(){let e="unknow";try{e=await me()}catch(e){}return e+"_"+Ie(8)}();let f,o,e,p=-1,m=-1,g=-1,v=-1,y=-1;try{const _=await on.getLocalTracks({video:{enabled:!0},audio:{enabled:!0}});if(e=_.find(e=>"video"===e.info.kind),o=_.find(e=>"audio"===e.info.kind),void 0===e||void 0===o)throw C("getLocalTracks failed.");var b=(r,n)=>new Promise((e,t)=>{!async function(e,t){var r="https://api-demo.qnsdk.com/v1"+$r(e,t,"fk6fk2rnb");try{let e;if("AbortController"in window){const t=new AbortController;setTimeout(()=>t.abort(),5e3),e=await fetch(r,{signal:t.signal,headers:{"Content-Type":"application/json"}})}else e=await fetch(r,{headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(e.statusText);return e.text()}catch(e){throw e}}(h,r).then(e=>n.joinRoomWithToken(e)).then(e).catch(t)}),k=(await Promise.all([b("userA",i),b("userB",a)]),n=>new Promise((t,r)=>{0<n.trackInfoList.length?n.subscribe(n.trackInfoList.map(e=>e.trackID)).then(t).catch(r):n.on("track-add",e=>{n.subscribe(e.map(e=>e.trackID)).then(t).catch(r)})}));await Promise.all([i.publish([e]),a.publish([o]),k(i),k(a)]);const s=[],c=[],u=[],d=[],l=[];let n=0;await new Promise(r=>{f=setInterval(()=>{var e=i.publishedTracks[0].getStats(),t=a.publishedTracks[0].getStats();0<e.length&&0<t.length&&o&&(s.push(e[0].rtt),c.push(e[0].packetLossRate),u.push(t[0].bitrate),d.push(e[0].bitrate),l.push(o.getCurrentVolumeLevel())),15<s.length&&(clearInterval(f),r()),30<n&&(S.warning("abnormal track stats: less than 15 valid stats in 30s"),clearInterval(f),r()),n+=1},1e3)}),S.log(JSON.stringify({detailTestResult:{rtts:s,packetLossRates:c,audioBitrates:u,videoBitrates:d,volumnLevels:l}})),0<s.length&&(p=Math.ceil(s.reduce((e,t)=>e+t,0)/s.length),m=c.reduce((e,t)=>e+t,0)/c.length,g=u.reduce((e,t)=>e+t,0)/u.length,v=d.reduce((e,t)=>e+t,0)/d.length,y=l.reduce((e,t)=>e+t,0)/l.length),t=!0}catch(e){t=!1,n="string"==typeof e?e:e instanceof qt?JSON.stringify(e):e.message}finally{return i.roomState===w.RoomState.Connected&&(await i.unpublish(i.publishedTracks.map(e=>e.info.trackID)),i.leaveRoom()),a.roomState===w.RoomState.Connected&&(await a.unpublish(a.publishedTracks.map(e=>e.info.trackID)),a.leaveRoom()),e&&e.release(),o&&o.release(),clearTimeout(void 0),clearInterval(f),T.addEvent("SystemRequirementsTest",{room_name:h,ok:t,reason:n,avg_rtt:p,avg_packet_loss_rate:m,avg_volumn_level:y,avg_audio_bitrate:g,avg_video_bitrate:v,test_take_time:Date.now()-r},!0),{roomName:h,ok:t,reason:n,avgRTT:p,avgPacketLossRate:m,avgVolumnLevel:y,avgAudioBitrate:g,avgVideoBitrate:v}}}class Xr extends Ur{constructor(e,t){if(!b.mediaStreamDest)throw rr("your browser does not support audio buffer input!");const r=new Fr;r.initAudioContext(),e instanceof AudioBuffer?(r.setAudioBufferSource(),r.setAudioBuffer(e)):e instanceof HTMLAudioElement&&r.setMediaElementSource(e),super(r.audioStream.stream.getTracks()[0],t,"local"),this.sourceType=w.TrackSourceType.EXTERNAL,this.isLoop=!1,this.originSource=e,this.audioManager=r,this.handleAudioManagerEvents()}setLoop(e){this.isLoop=e,this.audioManager.setAudioSourceLoop(e)}startAudioSource(){this.audioManager.playAudioSource()}pauseAudioSource(){this.audioManager.pauseAudioSource()}resumeAudioSource(){this.audioManager.resumeAudioSource()}stopAudioSource(){this.audioManager.stopAudioSource()}getCurrentTime(){return this.audioManager.getAudioSourceCurrentTime()||0}setCurrentTime(e){this.audioManager.setAudioSourceCurrentTime(e)}getDuration(){return this.audioManager.getAudioSourceDuration()||0}handleAudioManagerEvents(){this.audioManager.on("@audio-source-state-change",(e,t)=>{this.emit("audio-state-change",e,t)})}}class Kr extends e{constructor(e,t="send",r){super(),this.trackList=[],this.isDestroyed=!1,this.enableAudio=!0,this.enableVideo=!0,this.muteAudio=!1,this.muteVideo=!1,this.onAudioEnded=e=>{this.emit("audio-ended",e)},this.onVideoEnded=e=>{this.emit("video-ended",e)},this.onAudioSourceStateChange=(e,t)=>{this.emit("audio-source-state-change",e,t)},this.direction=t,this.userID=r,e.forEach(t=>{t.setMaster(!0),t.on("mute",()=>{this.updateTrackState()}),t.on("release",()=>{ie(this.trackList,e=>e===t),this.updateTrackState(),0===this.trackList.length&&this.release()}),this.trackList.push(t)}),this.updateTrackState()}get audioSourceIsLoop(){return this._audioTrack instanceof Xr&&this._audioTrack.isLoop}setVolume(e){this._audioTrack&&this._audioTrack.setVolume(e)}play(t,r){this.trackList.forEach(e=>e.play(t,r)),this._audioTrack&&(this.audio=this._audioTrack.mediaElement),this._videoTrack&&(this.video=this._videoTrack.mediaElement)}getCurrentTimeDomainData(){return this._audioTrack?this._audioTrack.getCurrentTimeDomainData():new Uint8Array(0)}getCurrentFrequencyData(){return this._audioTrack?this._audioTrack.getCurrentFrequencyData():new Uint8Array(0)}getCurrentVolumeLevel(){return this._audioTrack?this._audioTrack.getCurrentVolumeLevel():0}getStats(){let e=yr();if(this._audioTrack){const t=this._audioTrack.getStats();0<t.length&&(e=t[0])}let t=yr();if(this._videoTrack){const e=this._videoTrack.getStats();0<e.length&&(t=e[0])}return{timestamp:Date.now(),videoBitrate:t.bitrate,audioBitrate:e.bitrate,videoPacketLoss:t.packetLoss,audioPacketLoss:e.packetLoss,videoPackets:t.packets,audioPackets:e.packets,videoPacketLossRate:t.packetLossRate,audioPacketLossRate:e.packetLossRate,videoBytes:t.bytes,audioBytes:e.bytes,pctype:this.direction}}getCurrentFrameDataURL(){return this._videoTrack?this._videoTrack.getCurrentFrameDataURL():"data:,"}setAudioSourceLoop(e){this._audioTrack instanceof Xr&&this._audioTrack.setLoop(e)}startAudioSource(){this._audioTrack instanceof Xr&&this._audioTrack.startAudioSource()}pauseAudioSource(){this._audioTrack instanceof Xr&&this._audioTrack.pauseAudioSource()}resumeAudioSource(){this._audioTrack instanceof Xr&&this._audioTrack.resumeAudioSource()}stopAudioSource(){this._audioTrack instanceof Xr&&this._audioTrack.stopAudioSource()}getAudioSourceCurrentTime(){return this._audioTrack instanceof Xr?this._audioTrack.getCurrentTime():0}getAudioSourceDuration(){return this._audioTrack instanceof Xr?this._audioTrack.getDuration():0}setAudioSourceCurrentTime(e){if(this._audioTrack instanceof Xr)return this._audioTrack.setCurrentTime(e)}setKbps(e,t){e&&this._videoTrack&&this._videoTrack.setKbps(e),t&&this._audioTrack&&this._audioTrack.setKbps(t)}updateTrackState(){this.trackList.forEach(e=>{"audio"===e.info.kind?(this._audioTrack&&(this._audioTrack.off("ended",this.onAudioEnded),this._audioTrack.off("audio-state-change",this.onAudioSourceStateChange)),this.audioTrack=e.mediaTrack,this._audioTrack=e,this._audioTrack.on("ended",this.onAudioEnded),this._audioTrack instanceof Xr&&this._audioTrack.on("audio-state-change",this.onAudioSourceStateChange)):(this._videoTrack&&this._videoTrack.off("ended",this.onVideoEnded),this.videoTrack=e.mediaTrack,this._videoTrack=e,this._videoTrack.on("ended",this.onVideoEnded))}),this.audioTrack?(this.enableAudio=!0,this.muteAudio=!this.audioTrack.enabled):this.enableAudio=!1,this.videoTrack?(this.enableVideo=!0,this.muteVideo=!this.videoTrack.enabled):this.enableVideo=!1}release(){if(!this.isDestroyed){for(let e=0;e<this.trackList.length;e+=1){const t=this.trackList[e];t.removeAllListeners("release"),t.release()}this.trackList=[],this.isDestroyed=!0,this.emit("release"),this.removeEvent()}}releaseTrack(e){var{removeElement:t,newArray:r}=function(t,r){const n=[];let i=null;for(let e=0;e<t.length;e+=1)t[e].mediaTrack!==r?n.push(t[e]):i=t[e];return{removeElement:i,newArray:n}}(this.trackList,e.mediaTrack);t&&(e.release(),this.trackList=r,0===this.trackList.length&&(this.isDestroyed=!0))}}class Qr extends Ur{constructor(e){const t=Nr.createMediaStreamDestination();super(t.stream.getAudioTracks()[0],e,"local"),this.sourceType=w.TrackSourceType.MIXING,this.initAudioManager(!0),this.destination=t,this.inputList=[]}appendAudioSource(t){this.inputList.find(e=>e.track===t)?S.warning("track is already in the track list"):(this.inputList.push({track:t}),t.audioManager.gainNode.connect(this.destination))}removeAudioSource(t){const r=this.inputList.find(e=>e.track===t);r&&(r.track.audioManager.gainNode.disconnect(this.destination),ie(this.inputList,e=>e===r))}release(){for(const e of this.inputList)this.removeAudioSource(e.track);super.release()}}class Zr{constructor(e,t){this.effectSourceMap=new Map,this.playback=!0,this.output=e,this.playbackEngine=t}get effectList(){return Array.from(this.effectSourceMap.keys())}getEffectTrack(e){return this.effectSourceMap.get(e)}playEffect(e,t){const r=this.effectSourceMap.get(e);r?(t&&r.setVolume(t),this.playback&&r.audioManager.audioSource&&this.playbackEngine.addAudioNode(r.audioManager.gainNode),r.startAudioSource()):S.warning("can not find target effect",e)}async addEffectSource(e,t){this.effectSourceMap.has(t)?S.warning("duplicate effect key!",t):(e=await w.AudioUtils.createAudioTrackFromSource(e),this.effectSourceMap.set(t,e),this.output.appendAudioSource(e))}removeEffectSource(e){let t=[];t=e?[e]:Array.from(this.effectSourceMap.keys());for(const e of t){const t=this.effectSourceMap.get(e);if(!t)return;this.output.removeAudioSource(t),t.release(),this.effectSourceMap.delete(e)}}}class Yr extends e{constructor(e,t){super(),this.musicOption={loop:!1,volume:1},this.playback=!0,this.output=e,this.playbackEngine=t}get audioNode(){return this.musicTrack?this.musicTrack.audioManager.gainNode:null}setMusicOption(e){this.musicOption=Object.assign(this.musicOption,e),this.musicTrack&&(this.musicTrack.setVolume(this.musicOption.volume),this.musicTrack.setLoop(this.musicOption.loop))}async startMusicMixing(e){if(this.musicTrack)return this.stopMusicMixing(),this.startMusicMixing(e);if(this.musicTrack=await w.AudioUtils.createAudioTrackFromSource(e),this.output.appendAudioSource(this.musicTrack),this.setMusicOption({}),!this.musicTrack.audioManager.audioSource)throw C("can not find audio source");this.playback&&this.audioNode&&this.playbackEngine.addAudioNode(this.audioNode),this.musicTrack.on("audio-state-change",(e,t)=>{this.emit("music-state-change",e,t)}),this.musicTrack.startAudioSource()}pauseMusicMixing(){this.musicTrack?this.musicTrack.pauseAudioSource():S.warning("can not find target music, please run startAudioMixing")}resumeMusicMixing(){this.musicTrack?this.musicTrack.resumeAudioSource():S.warning("can not find target music, please run startAudioMixing")}stopMusicMixing(){this.musicTrack&&(this.musicTrack.stopAudioSource(),this.output.removeAudioSource(this.musicTrack),this.musicTrack.release(),this.musicTrack=void 0)}getMusicDuration(){return this.musicTrack?this.musicTrack.getDuration():0}getMusicCurrentTime(){return this.musicTrack?this.musicTrack.getCurrentTime():0}setMusicCurrentTime(e){if(this.musicTrack&&(this.musicTrack.setCurrentTime(e),!this.musicTrack.audioManager.audioSource))throw C("can not find audio source")}}class en{constructor(){this.volume=1,this.gainNode=Nr.createGain(),this.gainNode.connect(Nr.destination)}addAudioNode(e){e.connect(this.gainNode)}removeAudioNode(e){e.disconnect(this.gainNode)}release(){this.gainNode.disconnect()}}class tn{constructor(e){if(this.playbackEngine=new en,this.sourcePlayebackState=!1,!(e instanceof Ur))throw C("audio mixing manager: origin track is not audio track");this.outputTrack=new Qr,this.outputTrack.appendAudioSource(e),this.source=e,this.effectManager=new Zr(this.outputTrack,this.playbackEngine),this.musicManager=new Yr(this.outputTrack,this.playbackEngine)}getMusicPlaybackState(){return this.musicManager.playback}setMusicPlaybackState(e){this.musicManager.playback!==e&&(this.musicManager.playback=e,this.musicManager.audioNode&&(e?this.playbackEngine.addAudioNode(this.musicManager.audioNode):this.playbackEngine.removeAudioNode(this.musicManager.audioNode)))}getSourcePlaybackState(){return this.sourcePlayebackState}setSourcePlaybackState(e){this.sourcePlayebackState!==e&&(this.sourcePlayebackState=e,this.source.audioManager.audioSource&&(e?this.playbackEngine.addAudioNode(this.source.audioManager.gainNode):this.playbackEngine.removeAudioNode(this.source.audioManager.gainNode)))}getEffectPlaybackState(){return this.effectManager.playback}setEffectPlaybackState(r){this.effectManager.playback!==r&&(this.effectManager.playback=r,this.effectManager.effectSourceMap.forEach((e,t)=>{e.audioManager.audioSource&&(r?this.playbackEngine.addAudioNode(e.audioManager.gainNode):this.playbackEngine.removeAudioNode(e.audioManager.gainNode))}))}setBitrate(e){this.outputTrack.setInfo({kbps:e})}setTag(e){this.outputTrack.setInfo({tag:e})}release(){this.effectManager.removeEffectSource(),this.musicManager.stopMusicMixing(),this.outputTrack.removeAudioSource(this.source),this.outputTrack.release(),this.playbackEngine.release()}}class rn extends tn{constructor(e){if(!e._audioTrack)throw C("input stream do not have audio track");super(e._audioTrack),this.input=e;const t=[this.outputTrack];this.input._videoTrack&&t.push(this.input._videoTrack),this.outputStream=new Kr(t,"send",this.input.userID)}setBitrate(e,t){e&&this.outputStream._audioTrack&&this.outputStream._audioTrack.setKbps(e),t&&this.outputStream._videoTrack&&this.outputStream._videoTrack.setKbps(t)}}function bt(e,t="anonymous",r,n){const i=document.createElement("audio"),a=(i.preload="auto",i.src=e,i.crossOrigin=t,new Xr(i));return n&&a.setKbps(n),a.setInfo({tag:r}),a}function kt(n,i,a){return new Promise((r,t)=>{const e=new FileReader;e.onload=e=>{wt(e.target.result).then(e=>{const t=new Xr(e);a&&t.setKbps(a),t.setInfo({tag:i}),r(t)}).catch(t)},e.readAsArrayBuffer(n)})}function _t(e,t,r){const n=new Xr(e);return r&&n.setKbps(r),n.setInfo({tag:t}),n}async function wt(e){return"suspended"===Nr.state&&await Nr.resume(),new Promise((t,r)=>{Nr.decodeAudioData(e,e=>{t(e)},e=>{r(ur(e))})})}(r=w.AudioUtils||(w.AudioUtils={})).createAudioTrackFromURL=bt,r.createAudioTrackFromFile=kt,r.createAudioTrackFromBuffer=_t,r.createAudioTrackFromSource=async function(e,t,r){return e instanceof File?await kt(e,t,r):e instanceof AudioBuffer?_t(e,t,r):bt(e,"anonymous",t,r)},r.decodeAudioData=wt,r.createAudioMixingManagerFromTrack=function(e){return new tn(e)},r.createAudioMixingManagerFromStream=function(e){return new rn(e)};const nn={audio:{enabled:!0},video:{enabled:!0,bitrate:600}};class an extends e{constructor(){super(),this.deviceMap={},b.support&&(this.updateDeivceInfo(),window.setInterval(this.updateDeivceInfo.bind(this),1e3))}async getDeviceInfo(e,t){if(!e){const e={audio:!1,video:!1};switch(t){case"all":e.audio=!0,e.video=!0;break;case"cameras":e.video=!0;break;case"microphones":case"playback":e.audio=!0}try{const t=await navigator.mediaDevices.getUserMedia(e),r=(this.updateDeivceInfo(),t.getTracks());for(let e=0;e<r.length;e++)r[e].stop()}catch(e){throw"NotAllowedError"===e.name?ar(""):e}}if(!this.deviceInfo)return[];switch(t){case"all":return this.deviceInfo;case"cameras":return this.deviceInfo.filter(e=>"videoinput"===e.kind);case"microphones":return this.deviceInfo.filter(e=>"audioinput"===e.kind);case"playback":return this.deviceInfo.filter(e=>"audiooutput"===e.kind)}}async getLocalTracks(e=nn){if(S.debug("get local tracks",e),Lt(e)&&Ot(e)){const w={screen:e.screen},t={video:e.video,audio:e.audio},r=await Promise.all([this.getLocalTracks(w),this.getLocalTracks(t)]);return r[0].concat(r[1])}const t=await async function(e){if(!e)return{audio:!0,video:!0};if(Lt(e)){if(Ot(e))throw C("can not get mediaStream with video and screen are all enabled");if(!b.screenSharing)throw rr("your browser can not share screen");const t=e.screen;if(Mt&&(t.forceChromePlugin||!b.getDisplayMedia)&&!await We())throw ir("")}const t=!(!e.audio||!e.audio.enabled||e.audio.source)&&{deviceId:e.audio.deviceId,sampleRate:e.audio.sampleRate,sampleSize:e.audio.sampleSize,channelCount:e.audio.channelCount,autoGainControl:e.audio.autoGainControl,echoCancellation:e.audio.echoCancellation,noiseSuppression:e.audio.noiseSuppression},r=!(!e.video||!e.video.enabled)&&{frameRate:e.video.frameRate,height:e.video.height,width:e.video.width,deviceId:e.video.deviceId,facingMode:e.video.facingMode};if(Lt(e)&&e.screen){if(b.getDisplayMedia&&!e.screen.forceChromePlugin)return Cr({audio:t,video:{displaySurface:tt(e.screen.source),width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}});const r=await He(!1,e.screen);return Cr({audio:t,video:r})}return Cr({audio:t,video:r})}(e);let r;t.video&&"object"==typeof t.video&&t.video.deviceId&&T.addEvent("DeviceChanged",{type:0,desc:t.video.deviceId}),t.audio&&"object"==typeof t.audio&&t.audio.deviceId&&T.addEvent("DeviceChanged",{type:1,desc:t.audio.deviceId});try{r=await this.getUserMedia(e,t,!0)}catch(e){throw"NotAllowedError"===e.name?ar(""):e}let n=void 0,i=void 0,a=void 0,o=void 0;xt(e)&&(i=e.audio.bitrate,o=e.audio.tag),Lt(e)&&(n=e.screen.bitrate,a=e.screen.tag),Ot(e)&&(n=e.video.bitrate,a=e.video.tag);const s=r?r.getTracks():[],c=[];for(const w of s){var u="audio"===w.kind?et(w,o,i):et(w,a,n);c.push(u)}if(e.audio&&e.audio.source){const t=await w.AudioUtils.createAudioTrackFromSource(e.audio.source,o,i);c.push(t)}return this.updateDeivceInfo(),c}async getLocalStream(e){if(e&&Lt(e)&&Ot(e))throw C("can not get local stream with video and screen");e=await this.getLocalTracks(e);return new Kr(e,"send")}async getUserMedia(e,t,r=!0){if(S.debug("request to get user media, config",e),S.debug("request to get user media, constraints",t),!t.audio&&!t.video)return null;let n;if(Lt(e))n=await this.getDisplayMedia(t,e);else if(n=await navigator.mediaDevices.getUserMedia(t),r){const r=t.video;if(r&&"boolean"!=typeof r){var i=r.width,a=r.height;if("number"==typeof i&&"number"==typeof a){const s=n.getVideoTracks(),d=s&&s[0],{height:c=a,width:u=i}=d.getSettings();if(u&&c){var o=(a-c)*(i-u);if(10<o*o)return c/u<(o=a/i)?(r.height=c,r.width=c/o):(r.width=u,r.height=u*o),S.debug("justified constraint constraintHeight, contraintWidth, constraintRatio, screenHeight, screenWidth:",a,i,o,c,u,r),n.getTracks().forEach(e=>e.stop()),this.getUserMedia(e,W({},t,{video:r}),!1)}}}}return n}async getDisplayMedia(e,t){let r,n;e.audio&&(r=await navigator.mediaDevices.getUserMedia({audio:e.audio}));e=t.screen&&t.screen.audio&&!e.audio?{video:e.video,audio:t.screen.audio}:{video:e.video};return n=b.getDisplayMedia&&t.screen&&!t.screen.forceChromePlugin?await navigator.mediaDevices.getDisplayMedia(e):await navigator.mediaDevices.getUserMedia(e),r&&n.addTrack(r.getAudioTracks()[0]),n}async updateDeivceInfo(){this.deviceInfo=await navigator.mediaDevices.enumerateDevices();const t=this.deviceInfo.map(e=>e.deviceId),r=Object.keys(this.deviceMap);let n=!1;r.forEach(e=>{if(-1===t.indexOf(e)&&"@default"!==e){this.emit("device-remove",this.deviceMap[e].device);const t=this.deviceMap[e].device;this.emit("device-changed",{device:t,state:w.DeviceState.INACTIVE}),T.addEvent("audioinput"===t.kind||"audiooutput"===t.kind?"AudioDeviceInOut":"VideoDeviceInOut",{device_type:"audiooutput"===t.kind?1:0,device_state:0,device_label:t.label,device_id:t.deviceId,device_info:t.label}),delete this.deviceMap[e],n=!0}else this.deviceMap[e].tick+=1}),t.forEach((e,t)=>{if(-1===r.indexOf(e)&&"@default"!==e){this.deviceMap[e]={device:this.deviceInfo[t],tick:0};const r=this.deviceMap[e].device;this.emit("device-changed",{device:r,state:w.DeviceState.ACTIVE}),this.emit("device-add",r),T.addEvent("audioinput"===r.kind||"audiooutput"===r.kind?"AudioDeviceInOut":"VideoDeviceInOut",{device_type:"audiooutput"===r.kind?1:0,device_state:1,device_label:r.label,device_id:r.deviceId}),n=!0}}),n&&this.emit("device-update",this.deviceInfo)}}const on=new an;class sn extends e{get track(){return this._track}set track(e){e&&(this._track=e,this._track.on("ended",()=>this.emit("ended")))}release(){this.track&&this.track.release()}play(e){this.track&&this.track.play(e)}setVolume(e){this.track&&this.track.setVolume(e)}getCurrentVolumeLevel(){this.track&&this.track.getCurrentVolumeLevel()}startAudioSource(){this.track&&this.track.startAudioSource()}}function St(e){const t=new sn;return t.track=e,t.trackID=e.info.trackID,t.kind=e.info.kind,t.tag=e.info.tag,t.userID=e.userID,t}function Tt(e){const t=new sn;return t.trackID=e.trackID,t.kind=e.kind,t.tag=e.tag,t.userID=e.userID,t}class cn{constructor(e,t,r){this.userID=e,this.userData=r,this.publishedTracks=t.map(e=>Tt(e))}}function Ct(e){return new cn(e.userID,e.publishedTrackInfo,e.userData)}Ge={Idle:0,0:"Idle",Connecting:1,1:"Connecting",Connected:2,2:"Connected",Reconnecting:3,3:"Reconnecting"};class un extends e{constructor(){super(),this.session=new qr,this.session.on("user-join",e=>{this.emit("user-joined",Ct(e))}),this.session.on("user-leave",e=>{this.emit("user-left",Ct(e))}),this.session.on("track-add",e=>{var t=e[0].userID,e=e.map(e=>Tt(e));this.emit("user-published",t,e)}),this.session.on("user-published",e=>{var t=e[0].userID,e=e.map(e=>Tt(e));this.emit("user-published",t,e)}),this.session.on("track-remove",e=>{var t=e[0].userID,e=e.map(e=>Tt(e));this.emit("user-unpublished",t,e)}),this.session.on("room-state-change",e=>{this.emit("connection-state-change",e)}),this.session.on("messages-received",e=>{this.emit("messages-received",e)}),this.session.on("remote-user-reconnecting",e=>{this.emit("user-reconnecting",Ct(e))}),this.session.on("remote-user-reconnected",e=>{this.emit("user-reconnected",Ct(e))}),this.session.on("disconnect",e=>{this.emit("disconnected",e)})}get userID(){return this.session.userID}get roomName(){return this.session.roomName}get connectionState(){return this.session.roomState}get publishedTracks(){return this.session.publishedTracks.map(e=>St(e))}get subscribedTracks(){return this.session.subscribedTracks.map(e=>St(e))}get users(){return this.session.users.map(e=>Ct(e))}get trackList(){return this.session.trackInfoList.map(e=>Tt(e))}async join(e,t){return(await this.session.joinRoomWithToken(e,t)).map(e=>Ct(e))}async leave(){await Promise.resolve().then(()=>this.session.leaveRoom())}async publish(e){await this.session.publish(e.map(e=>e.track));for(const t of e)t.trackID=t.track.info.trackID,t.userID=this.userID}async unpublish(e){await this.session.unpublish(e.map(e=>e.trackID))}async subscribe(t){var r=await this.session.subscribe(t.map(e=>e.trackID));for(let e=0;e<t.length;e++)t[e].track=r[e]}async unsubscribe(e){await this.session.unsubscribe(e.map(e=>e.trackID))}async sendMessage(e,t,r){await Promise.resolve().then(()=>this.session.sendCustomMessage(e,t,r))}}class dn{static get VERSION(){return Wt}static get browserSupportReport(){return b}static async checkSystemRequirements(){return yt()}static setLogLevel(e){S.setLevel(e)}static async isExtensionAvailable(){return We()}static createClient(){return new un}static async getCameras(e=!1){return on.getDeviceInfo(e,"cameras")}static async getMicrophones(e=!1){return on.getDeviceInfo(e,"microphones")}static async getPlaybackDevices(e=!1){return on.getDeviceInfo(e,"playback")}static async getDevices(e=!1){return on.getDeviceInfo(e,"all")}static async createCameraVideoTrack(e){let t;if(S.log("createCameraVideoTrack start",e),e&&e.encoderConfig)if("string"==typeof e.encoderConfig){if(!(t=jt[e.encoderConfig]))throw dr()}else t=W({},Nt,e.encoderConfig);else t=Nt;e=St((await on.getLocalTracks({video:Ce({enabled:!0,width:t.width,height:t.height,frameRate:t.frameRate,bitrate:t.bitrate,tag:e&&e.tag,facingMode:e&&e.facingMode,deviceId:e&&e.cameraId})}))[0]);return S.log("createCameraVideoTrack end",e),e}static async createMicrophoneAudioTrack(e){let t;if(S.log("createMicrophoneAudioTrack start",e),e&&e.encoderConfig)if("string"==typeof e.encoderConfig){if(!(t=Bt[e.encoderConfig]))throw dr()}else t=W({},e.encoderConfig);else t={};e=St((await on.getLocalTracks({audio:Ce({enabled:!0,bitrate:t.bitrate,sampleRate:t.sampleRate,sampleSize:t.sampleSize,channelCount:void 0===t.stereo?void 0:t.stereo?2:1,autoGainControl:e&&e.AGC,noiseSuppression:e&&e.ANS,echoCancellation:e&&e.AEC,deviceId:e&&e.microphoneId,tag:e&&e.tag})}))[0]);return S.log("createMicrophoneAudioTrack end",e),e}static async createScreenVideoTrack(e,t){let r;if(S.log("createScreenVideoTrack start",e,t),e&&e.encoderConfig)if("string"==typeof e.encoderConfig){if(!(r=Ft[e.encoderConfig]))throw dr()}else r=W({},Ut,e.encoderConfig);else r=Ut;const n=await on.getLocalTracks({screen:Ce({enabled:!0,width:r.width,height:r.height,bitrate:r.bitrate,tag:e&&e.screenVideoTag,audio:!(!t||!["enable","auto"].includes(t))||void 0})});if(1===n.length&&"enable"===t)throw lr();for(const t of n)"audio"===t.info.kind&&e&&(t.info.tag=e.screenAudioTag);t=n.map(e=>St(e));return S.log("createScreenVideoTrack end",t),t}static async createMicrophoneAndCameraTracks(e,t){let r,n;if(S.log("createMicrophoneAndCameraTracks start",e,t),e&&e.encoderConfig)if("string"==typeof e.encoderConfig){if(!(r=Bt[e.encoderConfig]))throw dr()}else r=W({},e.encoderConfig);else r={};if(t&&t.encoderConfig)if("string"==typeof t.encoderConfig){if(!(n=jt[t.encoderConfig]))throw dr()}else n=W({},Nt,t.encoderConfig);else n=Nt;e=(await on.getLocalTracks({audio:Ce({enabled:!0,bitrate:r.bitrate,sampleRate:r.sampleRate,sampleSize:r.sampleSize,channelCount:void 0===r.stereo?void 0:r.stereo?2:1,autoGainControl:e&&e.AGC,noiseSuppression:e&&e.ANS,echoCancellation:e&&e.AEC,deviceId:e&&e.microphoneId,tag:e&&e.tag}),video:Ce({enabled:!0,width:n.width,height:n.height,frameRate:n.frameRate,bitrate:n.bitrate,tag:t&&t.tag,facingMode:t&&t.facingMode,deviceId:t&&t.cameraId})})).map(e=>St(e));return S.log("createMicrophoneAndCameraTracks end",e),e}static async createBufferSourceAudioTrack(e){let t;if(S.log("createBufferSourceAudioTrack start",e),e&&e.encoderConfig)if("string"==typeof e.encoderConfig){if(!(t=Bt[e.encoderConfig]))throw dr()}else t=W({},e.encoderConfig);else t={};e=St((await on.getLocalTracks({audio:Ce({enabled:!0,source:e.source,bitrate:t.bitrate,sampleRate:t.sampleRate,sampleSize:t.sampleSize,channelCount:void 0===t.stereo?void 0:t.stereo?2:1,tag:e&&e.tag})}))[0]);return S.log("createBufferSourceAudioTrack end",e),e}static createCustomAudioTrack(e){return St(et(e.mediaStreamTrack,e.tag,e.bitrate))}static createCustomVideoTrack(e){return St(et(e.mediaStreamTrack,e.tag,e.bitrate))}static createAudioMixingManager(e){return new tn(e)}static createMediaRecorder(){return new xr}}on.on("device-changed",e=>{switch(e.device.kind){case"audioinput":dn.onMicrophoneChanged&&dn.onMicrophoneChanged(e);break;case"audiooutput":dn.onPlaybackDeviceChanged&&dn.onPlaybackDeviceChanged(e);break;case"videoinput":dn.onCameraChanged&&dn.onCameraChanged(e)}}),w.default=dn,w.StreamModeSession=class extends Jr{constructor(e){super(e),this.subscribedUsers={},this.sessionMode="stream",T.addEvent("Init",{id:this.sessionMode+"_"+Date.now()})}async publish(e){if(!this.stream)return e.userID=this.userID,this.stream=e,this._publish(e.trackList);S.warning("repeat publish, please unpublish first!")}async unpublish(){var e;this.connectionTransport&&(e=this.connectionTransport.publishTracks.map(e=>e.trackID),await this._unpublish(e),this.stream=void 0)}async setMergeStreamLayout(e,t){if(!(t.id?this.mergeJobTracks[t.id]:this.defaultMergeJobTracks))throw or(t.id);var r=Se(this.users,"userID",e);if(r&&r.published){const a=t;!1===t.visible&&(a.hidden=!0);var t=a.id,n=!!a.hidden,i=!!a.muted;delete a.id,delete a.hidden,delete a.muted;const o=[],s=[];for(const e of r.publishedTrackInfo)"audio"===e.kind&&i?s.push(e.trackID):"audio"===e.kind&&o.push({trackID:e.trackID}),"video"===e.kind&&n?s.push(e.trackID):"video"===e.kind&&o.push(W({},a,{trackID:e.trackID}));await this._addMergeTracks(o,t),await this._removeMergeTracks(s,t)}else S.warning(`can not setMergeOption, user ${e} is published ?`)}stopMergeStream(e){this._stopMerge(e)}async subscribe(t){if(t===this.userID)throw er(10044,"can not subscribe yourself");const e=this._trackInfo.filter(e=>e.playerid===t&&e.master);if(0===e.length)throw er(10041,`subscribe user ${t} is not published`);var r=e.map(e=>e.trackid),r=await this._subscribe(r,!1,!0);return this.subscribedUsers[t]=new Kr(r,"recv",t),this.subscribedUsers[t].once("release",()=>{delete this.subscribedUsers[t]}),this.subscribedUsers[t]}async unsubscribe(e){this.subscribedUsers[e]?(await this._unsubscribe(this.subscribedUsers[e].trackList.map(e=>e.info.trackID)),delete this.subscribedUsers[e]):S.warning("user",e,"is not in subscribedUsers")}mute(e,t=!1){if(this.stream){const r=[];this.stream._audioTrack&&this.stream._audioTrack.info.muted!==e&&r.push({trackID:this.stream._audioTrack.info.trackID,muted:e}),this.stream._videoTrack&&this.stream._videoTrack.info.muted!==t&&r.push({trackID:this.stream._videoTrack.info.trackID,muted:t}),this._muteTracks(r)}else S.warning("can not mute, please run publish first")}filterSignalTracks(e){e.tracks&&(e.tracks=e.tracks.filter(t=>{if(void 0!==t.master&&null!==t.master)return t.master;var e=this._trackInfo.find(e=>e.trackid===t.trackid);return!!e&&e.master}))}releaseSession(){this.stream&&(this.stream.release(),this.stream=void 0);for(const e in this.subscribedUsers)this.subscribedUsers[e].release();this.subscribedUsers={}}},w.TrackModeSession=qr,w.version=Wt,w.log=S,w.User=wr,w.Stream=Kr,w.Track=Tr,w.AudioTrack=Ur,w.browserReport=b,w.isChromeExtensionAvailable=We,w.createCustomTrack=et,w.REC_AUDIO_ENABLE=xt,w.REC_VIDEO_ENABLE=Ot,w.REC_SCREEN_ENABLE=Lt,w.SUPPORT_VIDEO_ENCODER_CONFIG_LIST=jt,w.defaultVideoEncoderConfiguration=Nt,w.AUDIO_ENCODER_CONFIG_SETTINGS=Bt,w.SUPPORT_SCREEN_ENCODER_CONFIG_LIST=Ft,w.defaultScreenEncoderConfiguration=Ut,w.defaultMergeJob=Vt,w.QosEventType=Gt,w.DeviceManager=an,w.deviceManager=on,w.AudioSourceTrack=Xr,w.AudioMixingManager=tn,w.StreamMixingManager=rn,w.AudioEffectManager=Zr,w.AudioMusicManager=Yr,Object.defineProperty(w,"__esModule",{value:!0})}a.ActionType=void 0,(r=a.ActionType||(a.ActionType={})).Nod="nod",r.Shake="shake",r.Blink="blink",r.Mouth="mouth",a.VideoType=void 0,(Ge=a.VideoType||(a.VideoType={}))[Ge.Mp4=1]="Mp4",Ge[Ge.H264=2]="H264";Et.start=function(e,t){var r,n=new Et,i=QNRTC.default.createMediaRecorder();(r={})[a.VideoType.Mp4]="video/mp4",r[a.VideoType.H264]="video/webm;codecs=h264";return i.constructor.recorderTimeslice=200,i.setMimeType(r[n.video_type]),n.recorder=i,n.recorder.start({videoTrack:e}),n.params=t,n},Et.prototype.commit=function(){return s(this,void 0,void 0,function(){var t,r;return c(this,function(e){switch(e.label){case 0:return t=this.recorder.stop(),[4,(i=t,new Promise(function(t,r){var n=new FileReader;n.onload=function(e){t(e.target.result+"")},n.onerror=function(e){r("Failed to read file!\n\n"+n.error)},n.readAsDataURL(i)}))];case 1:return t=e.sent(),r=t.indexOf("base64,")+"base64,".length,r=t.slice(r),[2,v("/face-actlive",o({video_b64:r},this.params))]}var i})})};var Rt=Et;function Et(){}It.run=function(e){return v("/general-ocr",{"data.uri":"data:application/octet-stream;base64,"+e._track.getCurrentFrameDataURL().split(",")[1]})};e=It;function It(){}Pt.start=function(e,t,r){var n=new this;return n.faceActionLiveDetector=Rt.start(e,t),n.authoritativeFaceParams=r,n.videoTrack=e,n},Pt.prototype.commit=function(){return Promise.all([this.faceActionLiveDetector.commit(),x.run(this.videoTrack,this.authoritativeFaceParams)]).then(function(e){return{faceActionResult:e[0],authoritativeFaceResult:e[1]}})};r=Pt;function Pt(){}a.Speaker=void 0,(Ge=a.Speaker||(a.Speaker={})).Male1="male1",Ge.Male2="male2",Ge.Female3="female3",Ge.Male4="male4",Ge.Female5="female5",Ge.Female6="female6",Ge.Kefu1="kefu1",Ge.Girl1="girl1",a.AudioEncoding=void 0,(Ge=a.AudioEncoding||(a.AudioEncoding={})).Wav="wav",Ge.Pcm="pcm",Ge.Mp3="mp3",a.AudioToTextAnalyzer=U,a.FaceActionLiveDetector=Rt,a.FaceFlashLiveDetector=L,a.IDCardDetector=N,a.QNAuthoritativeFaceComparer=x,a.QNAuthorityActionFaceComparer=r,a.QNOCRDetector=e,a.defaultAudioToTextParams=F,a.faceComparer=function(e,r,n){var i=e._track;return s(this,void 0,void 0,function(){var t;return c(this,function(e){return t=i.getCurrentFrameDataURL(),[2,v("/face-compare",o({data_uri_a:t,data_uri_b:r},n))]})})},a.faceDetector=function(e,t){return e=e._track.getCurrentFrameDataURL(),v("/face-detect",o({image_b64:e.replace("data:image/png;base64,","")},t))},a.init=function(e,t){g.set("token",e),g.set("signCallback",t)},a.textToSpeak=function(e){return v("/voice-tts",o({speaker:a.Speaker.Kefu1,audio_encoding:a.AudioEncoding.Wav,sample_rate:16e3,volume:50,speed:0},e))},a.version="1.1.1",Object.defineProperty(a,"__esModule",{value:!0})});
